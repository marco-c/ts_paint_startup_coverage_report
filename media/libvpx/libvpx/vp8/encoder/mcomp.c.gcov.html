<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - output.info - media/libvpx/libvpx/vp8/encoder/mcomp.c</title>
  <link rel="stylesheet" type="text/css" href="../../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../../../index.html">top level</a> - <a href="index.html">media/libvpx/libvpx/vp8/encoder</a> - mcomp.c<span style="font-size: 80%;"> (source / <a href="mcomp.c.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">output.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">944</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2017-07-14 16:53:18</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">16</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Legend:</td>
            <td class="headerValueLeg">            Lines:
            <span class="coverLegendCov">hit</span>
            <span class="coverLegendNoCov">not hit</span>
</td>
            <td></td>
          </tr>
          <tr><td><img src="../../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /*</a>
<span class="lineNum">       2 </span>            :  *  Copyright (c) 2010 The WebM project authors. All Rights Reserved.
<span class="lineNum">       3 </span>            :  *
<span class="lineNum">       4 </span>            :  *  Use of this source code is governed by a BSD-style license
<span class="lineNum">       5 </span>            :  *  that can be found in the LICENSE file in the root of the source
<span class="lineNum">       6 </span>            :  *  tree. An additional intellectual property rights grant can be found
<span class="lineNum">       7 </span>            :  *  in the file PATENTS.  All contributing project authors may
<span class="lineNum">       8 </span>            :  *  be found in the AUTHORS file in the root of the source tree.
<span class="lineNum">       9 </span>            :  */
<span class="lineNum">      10 </span>            : 
<span class="lineNum">      11 </span>            : #include &quot;./vp8_rtcd.h&quot;
<span class="lineNum">      12 </span>            : #include &quot;./vpx_dsp_rtcd.h&quot;
<span class="lineNum">      13 </span>            : #include &quot;onyx_int.h&quot;
<span class="lineNum">      14 </span>            : #include &quot;mcomp.h&quot;
<span class="lineNum">      15 </span>            : #include &quot;vpx_mem/vpx_mem.h&quot;
<span class="lineNum">      16 </span>            : #include &quot;vpx_config.h&quot;
<span class="lineNum">      17 </span>            : #include &lt;stdio.h&gt;
<span class="lineNum">      18 </span>            : #include &lt;limits.h&gt;
<span class="lineNum">      19 </span>            : #include &lt;math.h&gt;
<span class="lineNum">      20 </span>            : #include &quot;vp8/common/findnearmv.h&quot;
<span class="lineNum">      21 </span>            : #include &quot;vp8/common/common.h&quot;
<span class="lineNum">      22 </span>            : #include &quot;vpx_dsp/vpx_dsp_common.h&quot;
<span class="lineNum">      23 </span>            : 
<span class="lineNum">      24 </span>            : #ifdef VP8_ENTROPY_STATS
<span class="lineNum">      25 </span>            : static int mv_ref_ct[31][4][2];
<span class="lineNum">      26 </span>            : static int mv_mode_cts[4][2];
<a name="27"><span class="lineNum">      27 </span>            : #endif</a>
<span class="lineNum">      28 </span>            : 
<span class="lineNum">      29 </span><span class="lineNoCov">          0 : int vp8_mv_bit_cost(int_mv *mv, int_mv *ref, int *mvcost[2], int Weight) {</span>
<span class="lineNum">      30 </span>            :   /* MV costing is based on the distribution of vectors in the previous
<span class="lineNum">      31 </span>            :    * frame and as such will tend to over state the cost of vectors. In
<span class="lineNum">      32 </span>            :    * addition coding a new vector can have a knock on effect on the cost
<span class="lineNum">      33 </span>            :    * of subsequent vectors and the quality of prediction from NEAR and
<span class="lineNum">      34 </span>            :    * NEAREST for subsequent blocks. The &quot;Weight&quot; parameter allows, to a
<span class="lineNum">      35 </span>            :    * limited extent, for some account to be taken of these factors.
<span class="lineNum">      36 </span>            :    */
<span class="lineNum">      37 </span><span class="lineNoCov">          0 :   return ((mvcost[0][(mv-&gt;as_mv.row - ref-&gt;as_mv.row) &gt;&gt; 1] +</span>
<span class="lineNum">      38 </span><span class="lineNoCov">          0 :            mvcost[1][(mv-&gt;as_mv.col - ref-&gt;as_mv.col) &gt;&gt; 1]) *</span>
<span class="lineNum">      39 </span><span class="lineNoCov">          0 :           Weight) &gt;&gt;</span>
<span class="lineNum">      40 </span>            :          7;
<a name="41"><span class="lineNum">      41 </span>            : }</a>
<span class="lineNum">      42 </span>            : 
<span class="lineNum">      43 </span><span class="lineNoCov">          0 : static int mv_err_cost(int_mv *mv, int_mv *ref, int *mvcost[2],</span>
<span class="lineNum">      44 </span>            :                        int error_per_bit) {
<span class="lineNum">      45 </span>            :   /* Ignore mv costing if mvcost is NULL */
<span class="lineNum">      46 </span><span class="lineNoCov">          0 :   if (mvcost) {</span>
<span class="lineNum">      47 </span><span class="lineNoCov">          0 :     return ((mvcost[0][(mv-&gt;as_mv.row - ref-&gt;as_mv.row) &gt;&gt; 1] +</span>
<span class="lineNum">      48 </span><span class="lineNoCov">          0 :              mvcost[1][(mv-&gt;as_mv.col - ref-&gt;as_mv.col) &gt;&gt; 1]) *</span>
<span class="lineNum">      49 </span><span class="lineNoCov">          0 :                 error_per_bit +</span>
<span class="lineNum">      50 </span><span class="lineNoCov">          0 :             128) &gt;&gt;</span>
<span class="lineNum">      51 </span>            :            8;
<span class="lineNum">      52 </span>            :   }
<span class="lineNum">      53 </span><span class="lineNoCov">          0 :   return 0;</span>
<a name="54"><span class="lineNum">      54 </span>            : }</a>
<span class="lineNum">      55 </span>            : 
<span class="lineNum">      56 </span><span class="lineNoCov">          0 : static int mvsad_err_cost(int_mv *mv, int_mv *ref, int *mvsadcost[2],</span>
<span class="lineNum">      57 </span>            :                           int error_per_bit) {
<span class="lineNum">      58 </span>            :   /* Calculate sad error cost on full pixel basis. */
<span class="lineNum">      59 </span>            :   /* Ignore mv costing if mvsadcost is NULL */
<span class="lineNum">      60 </span><span class="lineNoCov">          0 :   if (mvsadcost) {</span>
<span class="lineNum">      61 </span><span class="lineNoCov">          0 :     return ((mvsadcost[0][(mv-&gt;as_mv.row - ref-&gt;as_mv.row)] +</span>
<span class="lineNum">      62 </span><span class="lineNoCov">          0 :              mvsadcost[1][(mv-&gt;as_mv.col - ref-&gt;as_mv.col)]) *</span>
<span class="lineNum">      63 </span><span class="lineNoCov">          0 :                 error_per_bit +</span>
<span class="lineNum">      64 </span><span class="lineNoCov">          0 :             128) &gt;&gt;</span>
<span class="lineNum">      65 </span>            :            8;
<span class="lineNum">      66 </span>            :   }
<span class="lineNum">      67 </span><span class="lineNoCov">          0 :   return 0;</span>
<a name="68"><span class="lineNum">      68 </span>            : }</a>
<span class="lineNum">      69 </span>            : 
<span class="lineNum">      70 </span><span class="lineNoCov">          0 : void vp8_init_dsmotion_compensation(MACROBLOCK *x, int stride) {</span>
<span class="lineNum">      71 </span>            :   int Len;
<span class="lineNum">      72 </span><span class="lineNoCov">          0 :   int search_site_count = 0;</span>
<span class="lineNum">      73 </span>            : 
<span class="lineNum">      74 </span>            :   /* Generate offsets for 4 search sites per step. */
<span class="lineNum">      75 </span><span class="lineNoCov">          0 :   Len = MAX_FIRST_STEP;</span>
<span class="lineNum">      76 </span><span class="lineNoCov">          0 :   x-&gt;ss[search_site_count].mv.col = 0;</span>
<span class="lineNum">      77 </span><span class="lineNoCov">          0 :   x-&gt;ss[search_site_count].mv.row = 0;</span>
<span class="lineNum">      78 </span><span class="lineNoCov">          0 :   x-&gt;ss[search_site_count].offset = 0;</span>
<span class="lineNum">      79 </span><span class="lineNoCov">          0 :   search_site_count++;</span>
<span class="lineNum">      80 </span>            : 
<span class="lineNum">      81 </span><span class="lineNoCov">          0 :   while (Len &gt; 0) {</span>
<span class="lineNum">      82 </span>            :     /* Compute offsets for search sites. */
<span class="lineNum">      83 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.col = 0;</span>
<span class="lineNum">      84 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.row = -Len;</span>
<span class="lineNum">      85 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].offset = -Len * stride;</span>
<span class="lineNum">      86 </span><span class="lineNoCov">          0 :     search_site_count++;</span>
<span class="lineNum">      87 </span>            : 
<span class="lineNum">      88 </span>            :     /* Compute offsets for search sites. */
<span class="lineNum">      89 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.col = 0;</span>
<span class="lineNum">      90 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.row = Len;</span>
<span class="lineNum">      91 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].offset = Len * stride;</span>
<span class="lineNum">      92 </span><span class="lineNoCov">          0 :     search_site_count++;</span>
<span class="lineNum">      93 </span>            : 
<span class="lineNum">      94 </span>            :     /* Compute offsets for search sites. */
<span class="lineNum">      95 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.col = -Len;</span>
<span class="lineNum">      96 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.row = 0;</span>
<span class="lineNum">      97 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].offset = -Len;</span>
<span class="lineNum">      98 </span><span class="lineNoCov">          0 :     search_site_count++;</span>
<span class="lineNum">      99 </span>            : 
<span class="lineNum">     100 </span>            :     /* Compute offsets for search sites. */
<span class="lineNum">     101 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.col = Len;</span>
<span class="lineNum">     102 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.row = 0;</span>
<span class="lineNum">     103 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].offset = Len;</span>
<span class="lineNum">     104 </span><span class="lineNoCov">          0 :     search_site_count++;</span>
<span class="lineNum">     105 </span>            : 
<span class="lineNum">     106 </span>            :     /* Contract. */
<span class="lineNum">     107 </span><span class="lineNoCov">          0 :     Len /= 2;</span>
<span class="lineNum">     108 </span>            :   }
<span class="lineNum">     109 </span>            : 
<span class="lineNum">     110 </span><span class="lineNoCov">          0 :   x-&gt;ss_count = search_site_count;</span>
<span class="lineNum">     111 </span><span class="lineNoCov">          0 :   x-&gt;searches_per_step = 4;</span>
<a name="112"><span class="lineNum">     112 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     113 </span>            : 
<span class="lineNum">     114 </span><span class="lineNoCov">          0 : void vp8_init3smotion_compensation(MACROBLOCK *x, int stride) {</span>
<span class="lineNum">     115 </span>            :   int Len;
<span class="lineNum">     116 </span><span class="lineNoCov">          0 :   int search_site_count = 0;</span>
<span class="lineNum">     117 </span>            : 
<span class="lineNum">     118 </span>            :   /* Generate offsets for 8 search sites per step. */
<span class="lineNum">     119 </span><span class="lineNoCov">          0 :   Len = MAX_FIRST_STEP;</span>
<span class="lineNum">     120 </span><span class="lineNoCov">          0 :   x-&gt;ss[search_site_count].mv.col = 0;</span>
<span class="lineNum">     121 </span><span class="lineNoCov">          0 :   x-&gt;ss[search_site_count].mv.row = 0;</span>
<span class="lineNum">     122 </span><span class="lineNoCov">          0 :   x-&gt;ss[search_site_count].offset = 0;</span>
<span class="lineNum">     123 </span><span class="lineNoCov">          0 :   search_site_count++;</span>
<span class="lineNum">     124 </span>            : 
<span class="lineNum">     125 </span><span class="lineNoCov">          0 :   while (Len &gt; 0) {</span>
<span class="lineNum">     126 </span>            :     /* Compute offsets for search sites. */
<span class="lineNum">     127 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.col = 0;</span>
<span class="lineNum">     128 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.row = -Len;</span>
<span class="lineNum">     129 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].offset = -Len * stride;</span>
<span class="lineNum">     130 </span><span class="lineNoCov">          0 :     search_site_count++;</span>
<span class="lineNum">     131 </span>            : 
<span class="lineNum">     132 </span>            :     /* Compute offsets for search sites. */
<span class="lineNum">     133 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.col = 0;</span>
<span class="lineNum">     134 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.row = Len;</span>
<span class="lineNum">     135 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].offset = Len * stride;</span>
<span class="lineNum">     136 </span><span class="lineNoCov">          0 :     search_site_count++;</span>
<span class="lineNum">     137 </span>            : 
<span class="lineNum">     138 </span>            :     /* Compute offsets for search sites. */
<span class="lineNum">     139 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.col = -Len;</span>
<span class="lineNum">     140 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.row = 0;</span>
<span class="lineNum">     141 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].offset = -Len;</span>
<span class="lineNum">     142 </span><span class="lineNoCov">          0 :     search_site_count++;</span>
<span class="lineNum">     143 </span>            : 
<span class="lineNum">     144 </span>            :     /* Compute offsets for search sites. */
<span class="lineNum">     145 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.col = Len;</span>
<span class="lineNum">     146 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.row = 0;</span>
<span class="lineNum">     147 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].offset = Len;</span>
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :     search_site_count++;</span>
<span class="lineNum">     149 </span>            : 
<span class="lineNum">     150 </span>            :     /* Compute offsets for search sites. */
<span class="lineNum">     151 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.col = -Len;</span>
<span class="lineNum">     152 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.row = -Len;</span>
<span class="lineNum">     153 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].offset = -Len * stride - Len;</span>
<span class="lineNum">     154 </span><span class="lineNoCov">          0 :     search_site_count++;</span>
<span class="lineNum">     155 </span>            : 
<span class="lineNum">     156 </span>            :     /* Compute offsets for search sites. */
<span class="lineNum">     157 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.col = Len;</span>
<span class="lineNum">     158 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.row = -Len;</span>
<span class="lineNum">     159 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].offset = -Len * stride + Len;</span>
<span class="lineNum">     160 </span><span class="lineNoCov">          0 :     search_site_count++;</span>
<span class="lineNum">     161 </span>            : 
<span class="lineNum">     162 </span>            :     /* Compute offsets for search sites. */
<span class="lineNum">     163 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.col = -Len;</span>
<span class="lineNum">     164 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.row = Len;</span>
<span class="lineNum">     165 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].offset = Len * stride - Len;</span>
<span class="lineNum">     166 </span><span class="lineNoCov">          0 :     search_site_count++;</span>
<span class="lineNum">     167 </span>            : 
<span class="lineNum">     168 </span>            :     /* Compute offsets for search sites. */
<span class="lineNum">     169 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.col = Len;</span>
<span class="lineNum">     170 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].mv.row = Len;</span>
<span class="lineNum">     171 </span><span class="lineNoCov">          0 :     x-&gt;ss[search_site_count].offset = Len * stride + Len;</span>
<span class="lineNum">     172 </span><span class="lineNoCov">          0 :     search_site_count++;</span>
<span class="lineNum">     173 </span>            : 
<span class="lineNum">     174 </span>            :     /* Contract. */
<span class="lineNum">     175 </span><span class="lineNoCov">          0 :     Len /= 2;</span>
<span class="lineNum">     176 </span>            :   }
<span class="lineNum">     177 </span>            : 
<span class="lineNum">     178 </span><span class="lineNoCov">          0 :   x-&gt;ss_count = search_site_count;</span>
<span class="lineNum">     179 </span><span class="lineNoCov">          0 :   x-&gt;searches_per_step = 8;</span>
<span class="lineNum">     180 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     181 </span>            : 
<span class="lineNum">     182 </span>            : /*
<span class="lineNum">     183 </span>            :  * To avoid the penalty for crossing cache-line read, preload the reference
<span class="lineNum">     184 </span>            :  * area in a small buffer, which is aligned to make sure there won't be crossing
<span class="lineNum">     185 </span>            :  * cache-line read while reading from this buffer. This reduced the cpu
<span class="lineNum">     186 </span>            :  * cycles spent on reading ref data in sub-pixel filter functions.
<span class="lineNum">     187 </span>            :  * TODO: Currently, since sub-pixel search range here is -3 ~ 3, copy 22 rows x
<span class="lineNum">     188 </span>            :  * 32 cols area that is enough for 16x16 macroblock. Later, for SPLITMV, we
<span class="lineNum">     189 </span>            :  * could reduce the area.
<span class="lineNum">     190 </span>            :  */
<span class="lineNum">     191 </span>            : 
<span class="lineNum">     192 </span>            : /* estimated cost of a motion vector (r,c) */
<span class="lineNum">     193 </span>            : #define MVC(r, c)                                                             \
<span class="lineNum">     194 </span>            :   (mvcost                                                                     \
<span class="lineNum">     195 </span>            :        ? ((mvcost[0][(r)-rr] + mvcost[1][(c)-rc]) * error_per_bit + 128) &gt;&gt; 8 \
<span class="lineNum">     196 </span>            :        : 0)
<span class="lineNum">     197 </span>            : /* pointer to predictor base of a motionvector */
<span class="lineNum">     198 </span>            : #define PRE(r, c) (y + (((r) &gt;&gt; 2) * y_stride + ((c) &gt;&gt; 2) - (offset)))
<span class="lineNum">     199 </span>            : /* convert motion vector component to offset for svf calc */
<span class="lineNum">     200 </span>            : #define SP(x) (((x)&amp;3) &lt;&lt; 1)
<span class="lineNum">     201 </span>            : /* returns subpixel variance error function. */
<span class="lineNum">     202 </span>            : #define DIST(r, c) \
<span class="lineNum">     203 </span>            :   vfp-&gt;svf(PRE(r, c), y_stride, SP(c), SP(r), z, b-&gt;src_stride, &amp;sse)
<span class="lineNum">     204 </span>            : #define IFMVCV(r, c, s, e) \
<span class="lineNum">     205 </span>            :   if (c &gt;= minc &amp;&amp; c &lt;= maxc &amp;&amp; r &gt;= minr &amp;&amp; r &lt;= maxr) s else e;
<span class="lineNum">     206 </span>            : /* returns distortion + motion vector cost */
<span class="lineNum">     207 </span>            : #define ERR(r, c) (MVC(r, c) + DIST(r, c))
<span class="lineNum">     208 </span>            : /* checks if (r,c) has better score than previous best */
<span class="lineNum">     209 </span>            : #define CHECK_BETTER(v, r, c)                           \
<span class="lineNum">     210 </span>            :   IFMVCV(r, c,                                          \
<span class="lineNum">     211 </span>            :          {                                              \
<span class="lineNum">     212 </span>            :            thismse = DIST(r, c);                        \
<span class="lineNum">     213 </span>            :            if ((v = (MVC(r, c) + thismse)) &lt; besterr) { \
<span class="lineNum">     214 </span>            :              besterr = v;                               \
<span class="lineNum">     215 </span>            :              br = r;                                    \
<span class="lineNum">     216 </span>            :              bc = c;                                    \
<span class="lineNum">     217 </span>            :              *distortion = thismse;                     \
<span class="lineNum">     218 </span>            :              *sse1 = sse;                               \
<span class="lineNum">     219 </span>            :            }                                            \
<span class="lineNum">     220 </span>            :          },                                             \
<a name="221"><span class="lineNum">     221 </span>            :          v = UINT_MAX;)</a>
<span class="lineNum">     222 </span>            : 
<span class="lineNum">     223 </span><span class="lineNoCov">          0 : int vp8_find_best_sub_pixel_step_iteratively(MACROBLOCK *x, BLOCK *b, BLOCKD *d,</span>
<span class="lineNum">     224 </span>            :                                              int_mv *bestmv, int_mv *ref_mv,
<span class="lineNum">     225 </span>            :                                              int error_per_bit,
<span class="lineNum">     226 </span>            :                                              const vp8_variance_fn_ptr_t *vfp,
<span class="lineNum">     227 </span>            :                                              int *mvcost[2], int *distortion,
<span class="lineNum">     228 </span>            :                                              unsigned int *sse1) {
<span class="lineNum">     229 </span><span class="lineNoCov">          0 :   unsigned char *z = (*(b-&gt;base_src) + b-&gt;src);</span>
<span class="lineNum">     230 </span>            : 
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :   int rr = ref_mv-&gt;as_mv.row &gt;&gt; 1, rc = ref_mv-&gt;as_mv.col &gt;&gt; 1;</span>
<span class="lineNum">     232 </span><span class="lineNoCov">          0 :   int br = bestmv-&gt;as_mv.row * 4, bc = bestmv-&gt;as_mv.col * 4;</span>
<span class="lineNum">     233 </span><span class="lineNoCov">          0 :   int tr = br, tc = bc;</span>
<span class="lineNum">     234 </span>            :   unsigned int besterr;
<span class="lineNum">     235 </span>            :   unsigned int left, right, up, down, diag;
<span class="lineNum">     236 </span>            :   unsigned int sse;
<span class="lineNum">     237 </span>            :   unsigned int whichdir;
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :   unsigned int halfiters = 4;</span>
<span class="lineNum">     239 </span><span class="lineNoCov">          0 :   unsigned int quarteriters = 4;</span>
<span class="lineNum">     240 </span>            :   int thismse;
<span class="lineNum">     241 </span>            : 
<span class="lineNum">     242 </span><span class="lineNoCov">          0 :   int minc = VPXMAX(x-&gt;mv_col_min * 4,</span>
<span class="lineNum">     243 </span>            :                     (ref_mv-&gt;as_mv.col &gt;&gt; 1) - ((1 &lt;&lt; mvlong_width) - 1));
<span class="lineNum">     244 </span><span class="lineNoCov">          0 :   int maxc = VPXMIN(x-&gt;mv_col_max * 4,</span>
<span class="lineNum">     245 </span>            :                     (ref_mv-&gt;as_mv.col &gt;&gt; 1) + ((1 &lt;&lt; mvlong_width) - 1));
<span class="lineNum">     246 </span><span class="lineNoCov">          0 :   int minr = VPXMAX(x-&gt;mv_row_min * 4,</span>
<span class="lineNum">     247 </span>            :                     (ref_mv-&gt;as_mv.row &gt;&gt; 1) - ((1 &lt;&lt; mvlong_width) - 1));
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :   int maxr = VPXMIN(x-&gt;mv_row_max * 4,</span>
<span class="lineNum">     249 </span>            :                     (ref_mv-&gt;as_mv.row &gt;&gt; 1) + ((1 &lt;&lt; mvlong_width) - 1));
<span class="lineNum">     250 </span>            : 
<span class="lineNum">     251 </span>            :   int y_stride;
<span class="lineNum">     252 </span>            :   int offset;
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :   int pre_stride = x-&gt;e_mbd.pre.y_stride;</span>
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :   unsigned char *base_pre = x-&gt;e_mbd.pre.y_buffer;</span>
<span class="lineNum">     255 </span>            : 
<span class="lineNum">     256 </span>            : #if ARCH_X86 || ARCH_X86_64
<span class="lineNum">     257 </span><span class="lineNoCov">          0 :   MACROBLOCKD *xd = &amp;x-&gt;e_mbd;</span>
<span class="lineNum">     258 </span><span class="lineNoCov">          0 :   unsigned char *y_0 = base_pre + d-&gt;offset + (bestmv-&gt;as_mv.row) * pre_stride +</span>
<span class="lineNum">     259 </span><span class="lineNoCov">          0 :                        bestmv-&gt;as_mv.col;</span>
<span class="lineNum">     260 </span>            :   unsigned char *y;
<span class="lineNum">     261 </span>            :   int buf_r1, buf_r2, buf_c1;
<span class="lineNum">     262 </span>            : 
<span class="lineNum">     263 </span>            :   /* Clamping to avoid out-of-range data access */
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :   buf_r1 = ((bestmv-&gt;as_mv.row - 3) &lt; x-&gt;mv_row_min)</span>
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :                ? (bestmv-&gt;as_mv.row - x-&gt;mv_row_min)</span>
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :                : 3;</span>
<span class="lineNum">     267 </span><span class="lineNoCov">          0 :   buf_r2 = ((bestmv-&gt;as_mv.row + 3) &gt; x-&gt;mv_row_max)</span>
<span class="lineNum">     268 </span><span class="lineNoCov">          0 :                ? (x-&gt;mv_row_max - bestmv-&gt;as_mv.row)</span>
<span class="lineNum">     269 </span><span class="lineNoCov">          0 :                : 3;</span>
<span class="lineNum">     270 </span><span class="lineNoCov">          0 :   buf_c1 = ((bestmv-&gt;as_mv.col - 3) &lt; x-&gt;mv_col_min)</span>
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :                ? (bestmv-&gt;as_mv.col - x-&gt;mv_col_min)</span>
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :                : 3;</span>
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :   y_stride = 32;</span>
<span class="lineNum">     274 </span>            : 
<span class="lineNum">     275 </span>            :   /* Copy to intermediate buffer before searching. */
<span class="lineNum">     276 </span><span class="lineNoCov">          0 :   vfp-&gt;copymem(y_0 - buf_c1 - pre_stride * buf_r1, pre_stride, xd-&gt;y_buf,</span>
<span class="lineNum">     277 </span><span class="lineNoCov">          0 :                y_stride, 16 + buf_r1 + buf_r2);</span>
<span class="lineNum">     278 </span><span class="lineNoCov">          0 :   y = xd-&gt;y_buf + y_stride * buf_r1 + buf_c1;</span>
<span class="lineNum">     279 </span>            : #else
<span class="lineNum">     280 </span>            :   unsigned char *y = base_pre + d-&gt;offset + (bestmv-&gt;as_mv.row) * pre_stride +
<span class="lineNum">     281 </span>            :                      bestmv-&gt;as_mv.col;
<span class="lineNum">     282 </span>            :   y_stride = pre_stride;
<span class="lineNum">     283 </span>            : #endif
<span class="lineNum">     284 </span>            : 
<span class="lineNum">     285 </span><span class="lineNoCov">          0 :   offset = (bestmv-&gt;as_mv.row) * y_stride + bestmv-&gt;as_mv.col;</span>
<span class="lineNum">     286 </span>            : 
<span class="lineNum">     287 </span>            :   /* central mv */
<span class="lineNum">     288 </span><span class="lineNoCov">          0 :   bestmv-&gt;as_mv.row *= 8;</span>
<span class="lineNum">     289 </span><span class="lineNoCov">          0 :   bestmv-&gt;as_mv.col *= 8;</span>
<span class="lineNum">     290 </span>            : 
<span class="lineNum">     291 </span>            :   /* calculate central point error */
<span class="lineNum">     292 </span><span class="lineNoCov">          0 :   besterr = vfp-&gt;vf(y, y_stride, z, b-&gt;src_stride, sse1);</span>
<span class="lineNum">     293 </span><span class="lineNoCov">          0 :   *distortion = besterr;</span>
<span class="lineNum">     294 </span><span class="lineNoCov">          0 :   besterr += mv_err_cost(bestmv, ref_mv, mvcost, error_per_bit);</span>
<span class="lineNum">     295 </span>            : 
<span class="lineNum">     296 </span>            :   /* TODO: Each subsequent iteration checks at least one point in common
<span class="lineNum">     297 </span>            :    * with the last iteration could be 2 ( if diag selected)
<span class="lineNum">     298 </span>            :    */
<span class="lineNum">     299 </span><span class="lineNoCov">          0 :   while (--halfiters) {</span>
<span class="lineNum">     300 </span>            :     /* 1/2 pel */
<span class="lineNum">     301 </span><span class="lineNoCov">          0 :     CHECK_BETTER(left, tr, tc - 2);</span>
<span class="lineNum">     302 </span><span class="lineNoCov">          0 :     CHECK_BETTER(right, tr, tc + 2);</span>
<span class="lineNum">     303 </span><span class="lineNoCov">          0 :     CHECK_BETTER(up, tr - 2, tc);</span>
<span class="lineNum">     304 </span><span class="lineNoCov">          0 :     CHECK_BETTER(down, tr + 2, tc);</span>
<span class="lineNum">     305 </span>            : 
<span class="lineNum">     306 </span><span class="lineNoCov">          0 :     whichdir = (left &lt; right ? 0 : 1) + (up &lt; down ? 0 : 2);</span>
<span class="lineNum">     307 </span>            : 
<span class="lineNum">     308 </span><span class="lineNoCov">          0 :     switch (whichdir) {</span>
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :       case 0: CHECK_BETTER(diag, tr - 2, tc - 2); break;</span>
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :       case 1: CHECK_BETTER(diag, tr - 2, tc + 2); break;</span>
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :       case 2: CHECK_BETTER(diag, tr + 2, tc - 2); break;</span>
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :       case 3: CHECK_BETTER(diag, tr + 2, tc + 2); break;</span>
<span class="lineNum">     313 </span>            :     }
<span class="lineNum">     314 </span>            : 
<span class="lineNum">     315 </span>            :     /* no reason to check the same one again. */
<span class="lineNum">     316 </span><span class="lineNoCov">          0 :     if (tr == br &amp;&amp; tc == bc) break;</span>
<span class="lineNum">     317 </span>            : 
<span class="lineNum">     318 </span><span class="lineNoCov">          0 :     tr = br;</span>
<span class="lineNum">     319 </span><span class="lineNoCov">          0 :     tc = bc;</span>
<span class="lineNum">     320 </span>            :   }
<span class="lineNum">     321 </span>            : 
<span class="lineNum">     322 </span>            :   /* TODO: Each subsequent iteration checks at least one point in common
<span class="lineNum">     323 </span>            :    * with the last iteration could be 2 ( if diag selected)
<span class="lineNum">     324 </span>            :    */
<span class="lineNum">     325 </span>            : 
<span class="lineNum">     326 </span>            :   /* 1/4 pel */
<span class="lineNum">     327 </span><span class="lineNoCov">          0 :   while (--quarteriters) {</span>
<span class="lineNum">     328 </span><span class="lineNoCov">          0 :     CHECK_BETTER(left, tr, tc - 1);</span>
<span class="lineNum">     329 </span><span class="lineNoCov">          0 :     CHECK_BETTER(right, tr, tc + 1);</span>
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :     CHECK_BETTER(up, tr - 1, tc);</span>
<span class="lineNum">     331 </span><span class="lineNoCov">          0 :     CHECK_BETTER(down, tr + 1, tc);</span>
<span class="lineNum">     332 </span>            : 
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :     whichdir = (left &lt; right ? 0 : 1) + (up &lt; down ? 0 : 2);</span>
<span class="lineNum">     334 </span>            : 
<span class="lineNum">     335 </span><span class="lineNoCov">          0 :     switch (whichdir) {</span>
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :       case 0: CHECK_BETTER(diag, tr - 1, tc - 1); break;</span>
<span class="lineNum">     337 </span><span class="lineNoCov">          0 :       case 1: CHECK_BETTER(diag, tr - 1, tc + 1); break;</span>
<span class="lineNum">     338 </span><span class="lineNoCov">          0 :       case 2: CHECK_BETTER(diag, tr + 1, tc - 1); break;</span>
<span class="lineNum">     339 </span><span class="lineNoCov">          0 :       case 3: CHECK_BETTER(diag, tr + 1, tc + 1); break;</span>
<span class="lineNum">     340 </span>            :     }
<span class="lineNum">     341 </span>            : 
<span class="lineNum">     342 </span>            :     /* no reason to check the same one again. */
<span class="lineNum">     343 </span><span class="lineNoCov">          0 :     if (tr == br &amp;&amp; tc == bc) break;</span>
<span class="lineNum">     344 </span>            : 
<span class="lineNum">     345 </span><span class="lineNoCov">          0 :     tr = br;</span>
<span class="lineNum">     346 </span><span class="lineNoCov">          0 :     tc = bc;</span>
<span class="lineNum">     347 </span>            :   }
<span class="lineNum">     348 </span>            : 
<span class="lineNum">     349 </span><span class="lineNoCov">          0 :   bestmv-&gt;as_mv.row = br * 2;</span>
<span class="lineNum">     350 </span><span class="lineNoCov">          0 :   bestmv-&gt;as_mv.col = bc * 2;</span>
<span class="lineNum">     351 </span>            : 
<span class="lineNum">     352 </span><span class="lineNoCov">          0 :   if ((abs(bestmv-&gt;as_mv.col - ref_mv-&gt;as_mv.col) &gt; (MAX_FULL_PEL_VAL &lt;&lt; 3)) ||</span>
<span class="lineNum">     353 </span><span class="lineNoCov">          0 :       (abs(bestmv-&gt;as_mv.row - ref_mv-&gt;as_mv.row) &gt; (MAX_FULL_PEL_VAL &lt;&lt; 3))) {</span>
<span class="lineNum">     354 </span><span class="lineNoCov">          0 :     return INT_MAX;</span>
<span class="lineNum">     355 </span>            :   }
<span class="lineNum">     356 </span>            : 
<span class="lineNum">     357 </span><span class="lineNoCov">          0 :   return besterr;</span>
<span class="lineNum">     358 </span>            : }
<span class="lineNum">     359 </span>            : #undef MVC
<span class="lineNum">     360 </span>            : #undef PRE
<span class="lineNum">     361 </span>            : #undef SP
<span class="lineNum">     362 </span>            : #undef DIST
<span class="lineNum">     363 </span>            : #undef IFMVCV
<span class="lineNum">     364 </span>            : #undef ERR
<a name="365"><span class="lineNum">     365 </span>            : #undef CHECK_BETTER</a>
<span class="lineNum">     366 </span>            : 
<span class="lineNum">     367 </span><span class="lineNoCov">          0 : int vp8_find_best_sub_pixel_step(MACROBLOCK *x, BLOCK *b, BLOCKD *d,</span>
<span class="lineNum">     368 </span>            :                                  int_mv *bestmv, int_mv *ref_mv,
<span class="lineNum">     369 </span>            :                                  int error_per_bit,
<span class="lineNum">     370 </span>            :                                  const vp8_variance_fn_ptr_t *vfp,
<span class="lineNum">     371 </span>            :                                  int *mvcost[2], int *distortion,
<span class="lineNum">     372 </span>            :                                  unsigned int *sse1) {
<span class="lineNum">     373 </span><span class="lineNoCov">          0 :   int bestmse = INT_MAX;</span>
<span class="lineNum">     374 </span>            :   int_mv startmv;
<span class="lineNum">     375 </span>            :   int_mv this_mv;
<span class="lineNum">     376 </span><span class="lineNoCov">          0 :   unsigned char *z = (*(b-&gt;base_src) + b-&gt;src);</span>
<span class="lineNum">     377 </span>            :   int left, right, up, down, diag;
<span class="lineNum">     378 </span>            :   unsigned int sse;
<span class="lineNum">     379 </span>            :   int whichdir;
<span class="lineNum">     380 </span>            :   int thismse;
<span class="lineNum">     381 </span>            :   int y_stride;
<span class="lineNum">     382 </span><span class="lineNoCov">          0 :   int pre_stride = x-&gt;e_mbd.pre.y_stride;</span>
<span class="lineNum">     383 </span><span class="lineNoCov">          0 :   unsigned char *base_pre = x-&gt;e_mbd.pre.y_buffer;</span>
<span class="lineNum">     384 </span>            : 
<span class="lineNum">     385 </span>            : #if ARCH_X86 || ARCH_X86_64
<span class="lineNum">     386 </span><span class="lineNoCov">          0 :   MACROBLOCKD *xd = &amp;x-&gt;e_mbd;</span>
<span class="lineNum">     387 </span><span class="lineNoCov">          0 :   unsigned char *y_0 = base_pre + d-&gt;offset + (bestmv-&gt;as_mv.row) * pre_stride +</span>
<span class="lineNum">     388 </span><span class="lineNoCov">          0 :                        bestmv-&gt;as_mv.col;</span>
<span class="lineNum">     389 </span>            :   unsigned char *y;
<span class="lineNum">     390 </span>            : 
<span class="lineNum">     391 </span><span class="lineNoCov">          0 :   y_stride = 32;</span>
<span class="lineNum">     392 </span>            :   /* Copy 18 rows x 32 cols area to intermediate buffer before searching. */
<span class="lineNum">     393 </span><span class="lineNoCov">          0 :   vfp-&gt;copymem(y_0 - 1 - pre_stride, pre_stride, xd-&gt;y_buf, y_stride, 18);</span>
<span class="lineNum">     394 </span><span class="lineNoCov">          0 :   y = xd-&gt;y_buf + y_stride + 1;</span>
<span class="lineNum">     395 </span>            : #else
<span class="lineNum">     396 </span>            :   unsigned char *y = base_pre + d-&gt;offset + (bestmv-&gt;as_mv.row) * pre_stride +
<span class="lineNum">     397 </span>            :                      bestmv-&gt;as_mv.col;
<span class="lineNum">     398 </span>            :   y_stride = pre_stride;
<span class="lineNum">     399 </span>            : #endif
<span class="lineNum">     400 </span>            : 
<span class="lineNum">     401 </span>            :   /* central mv */
<span class="lineNum">     402 </span><span class="lineNoCov">          0 :   bestmv-&gt;as_mv.row *= 8;</span>
<span class="lineNum">     403 </span><span class="lineNoCov">          0 :   bestmv-&gt;as_mv.col *= 8;</span>
<span class="lineNum">     404 </span><span class="lineNoCov">          0 :   startmv = *bestmv;</span>
<span class="lineNum">     405 </span>            : 
<span class="lineNum">     406 </span>            :   /* calculate central point error */
<span class="lineNum">     407 </span><span class="lineNoCov">          0 :   bestmse = vfp-&gt;vf(y, y_stride, z, b-&gt;src_stride, sse1);</span>
<span class="lineNum">     408 </span><span class="lineNoCov">          0 :   *distortion = bestmse;</span>
<span class="lineNum">     409 </span><span class="lineNoCov">          0 :   bestmse += mv_err_cost(bestmv, ref_mv, mvcost, error_per_bit);</span>
<span class="lineNum">     410 </span>            : 
<span class="lineNum">     411 </span>            :   /* go left then right and check error */
<span class="lineNum">     412 </span><span class="lineNoCov">          0 :   this_mv.as_mv.row = startmv.as_mv.row;</span>
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :   this_mv.as_mv.col = ((startmv.as_mv.col - 8) | 4);</span>
<span class="lineNum">     414 </span>            :   /* &quot;halfpix&quot; horizontal variance */
<span class="lineNum">     415 </span><span class="lineNoCov">          0 :   thismse = vfp-&gt;svf(y - 1, y_stride, 4, 0, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :   left = thismse + mv_err_cost(&amp;this_mv, ref_mv, mvcost, error_per_bit);</span>
<span class="lineNum">     417 </span>            : 
<span class="lineNum">     418 </span><span class="lineNoCov">          0 :   if (left &lt; bestmse) {</span>
<span class="lineNum">     419 </span><span class="lineNoCov">          0 :     *bestmv = this_mv;</span>
<span class="lineNum">     420 </span><span class="lineNoCov">          0 :     bestmse = left;</span>
<span class="lineNum">     421 </span><span class="lineNoCov">          0 :     *distortion = thismse;</span>
<span class="lineNum">     422 </span><span class="lineNoCov">          0 :     *sse1 = sse;</span>
<span class="lineNum">     423 </span>            :   }
<span class="lineNum">     424 </span>            : 
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :   this_mv.as_mv.col += 8;</span>
<span class="lineNum">     426 </span>            :   /* &quot;halfpix&quot; horizontal variance */
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :   thismse = vfp-&gt;svf(y, y_stride, 4, 0, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     428 </span><span class="lineNoCov">          0 :   right = thismse + mv_err_cost(&amp;this_mv, ref_mv, mvcost, error_per_bit);</span>
<span class="lineNum">     429 </span>            : 
<span class="lineNum">     430 </span><span class="lineNoCov">          0 :   if (right &lt; bestmse) {</span>
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :     *bestmv = this_mv;</span>
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :     bestmse = right;</span>
<span class="lineNum">     433 </span><span class="lineNoCov">          0 :     *distortion = thismse;</span>
<span class="lineNum">     434 </span><span class="lineNoCov">          0 :     *sse1 = sse;</span>
<span class="lineNum">     435 </span>            :   }
<span class="lineNum">     436 </span>            : 
<span class="lineNum">     437 </span>            :   /* go up then down and check error */
<span class="lineNum">     438 </span><span class="lineNoCov">          0 :   this_mv.as_mv.col = startmv.as_mv.col;</span>
<span class="lineNum">     439 </span><span class="lineNoCov">          0 :   this_mv.as_mv.row = ((startmv.as_mv.row - 8) | 4);</span>
<span class="lineNum">     440 </span>            :   /* &quot;halfpix&quot; vertical variance */
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :   thismse = vfp-&gt;svf(y - y_stride, y_stride, 0, 4, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     442 </span><span class="lineNoCov">          0 :   up = thismse + mv_err_cost(&amp;this_mv, ref_mv, mvcost, error_per_bit);</span>
<span class="lineNum">     443 </span>            : 
<span class="lineNum">     444 </span><span class="lineNoCov">          0 :   if (up &lt; bestmse) {</span>
<span class="lineNum">     445 </span><span class="lineNoCov">          0 :     *bestmv = this_mv;</span>
<span class="lineNum">     446 </span><span class="lineNoCov">          0 :     bestmse = up;</span>
<span class="lineNum">     447 </span><span class="lineNoCov">          0 :     *distortion = thismse;</span>
<span class="lineNum">     448 </span><span class="lineNoCov">          0 :     *sse1 = sse;</span>
<span class="lineNum">     449 </span>            :   }
<span class="lineNum">     450 </span>            : 
<span class="lineNum">     451 </span><span class="lineNoCov">          0 :   this_mv.as_mv.row += 8;</span>
<span class="lineNum">     452 </span>            :   /* &quot;halfpix&quot; vertical variance */
<span class="lineNum">     453 </span><span class="lineNoCov">          0 :   thismse = vfp-&gt;svf(y, y_stride, 0, 4, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     454 </span><span class="lineNoCov">          0 :   down = thismse + mv_err_cost(&amp;this_mv, ref_mv, mvcost, error_per_bit);</span>
<span class="lineNum">     455 </span>            : 
<span class="lineNum">     456 </span><span class="lineNoCov">          0 :   if (down &lt; bestmse) {</span>
<span class="lineNum">     457 </span><span class="lineNoCov">          0 :     *bestmv = this_mv;</span>
<span class="lineNum">     458 </span><span class="lineNoCov">          0 :     bestmse = down;</span>
<span class="lineNum">     459 </span><span class="lineNoCov">          0 :     *distortion = thismse;</span>
<span class="lineNum">     460 </span><span class="lineNoCov">          0 :     *sse1 = sse;</span>
<span class="lineNum">     461 </span>            :   }
<span class="lineNum">     462 </span>            : 
<span class="lineNum">     463 </span>            :   /* now check 1 more diagonal */
<span class="lineNum">     464 </span><span class="lineNoCov">          0 :   whichdir = (left &lt; right ? 0 : 1) + (up &lt; down ? 0 : 2);</span>
<span class="lineNum">     465 </span><span class="lineNoCov">          0 :   this_mv = startmv;</span>
<span class="lineNum">     466 </span>            : 
<span class="lineNum">     467 </span><span class="lineNoCov">          0 :   switch (whichdir) {</span>
<span class="lineNum">     468 </span>            :     case 0:
<span class="lineNum">     469 </span><span class="lineNoCov">          0 :       this_mv.as_mv.col = (this_mv.as_mv.col - 8) | 4;</span>
<span class="lineNum">     470 </span><span class="lineNoCov">          0 :       this_mv.as_mv.row = (this_mv.as_mv.row - 8) | 4;</span>
<span class="lineNum">     471 </span>            :       /* &quot;halfpix&quot; horizontal/vertical variance */
<span class="lineNum">     472 </span><span class="lineNoCov">          0 :       thismse =</span>
<span class="lineNum">     473 </span><span class="lineNoCov">          0 :           vfp-&gt;svf(y - 1 - y_stride, y_stride, 4, 4, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     474 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     475 </span>            :     case 1:
<span class="lineNum">     476 </span><span class="lineNoCov">          0 :       this_mv.as_mv.col += 4;</span>
<span class="lineNum">     477 </span><span class="lineNoCov">          0 :       this_mv.as_mv.row = (this_mv.as_mv.row - 8) | 4;</span>
<span class="lineNum">     478 </span>            :       /* &quot;halfpix&quot; horizontal/vertical variance */
<span class="lineNum">     479 </span><span class="lineNoCov">          0 :       thismse = vfp-&gt;svf(y - y_stride, y_stride, 4, 4, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     480 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     481 </span>            :     case 2:
<span class="lineNum">     482 </span><span class="lineNoCov">          0 :       this_mv.as_mv.col = (this_mv.as_mv.col - 8) | 4;</span>
<span class="lineNum">     483 </span><span class="lineNoCov">          0 :       this_mv.as_mv.row += 4;</span>
<span class="lineNum">     484 </span>            :       /* &quot;halfpix&quot; horizontal/vertical variance */
<span class="lineNum">     485 </span><span class="lineNoCov">          0 :       thismse = vfp-&gt;svf(y - 1, y_stride, 4, 4, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     486 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     487 </span>            :     case 3:
<span class="lineNum">     488 </span>            :     default:
<span class="lineNum">     489 </span><span class="lineNoCov">          0 :       this_mv.as_mv.col += 4;</span>
<span class="lineNum">     490 </span><span class="lineNoCov">          0 :       this_mv.as_mv.row += 4;</span>
<span class="lineNum">     491 </span>            :       /* &quot;halfpix&quot; horizontal/vertical variance */
<span class="lineNum">     492 </span><span class="lineNoCov">          0 :       thismse = vfp-&gt;svf(y, y_stride, 4, 4, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     493 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     494 </span>            :   }
<span class="lineNum">     495 </span>            : 
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :   diag = thismse + mv_err_cost(&amp;this_mv, ref_mv, mvcost, error_per_bit);</span>
<span class="lineNum">     497 </span>            : 
<span class="lineNum">     498 </span><span class="lineNoCov">          0 :   if (diag &lt; bestmse) {</span>
<span class="lineNum">     499 </span><span class="lineNoCov">          0 :     *bestmv = this_mv;</span>
<span class="lineNum">     500 </span><span class="lineNoCov">          0 :     bestmse = diag;</span>
<span class="lineNum">     501 </span><span class="lineNoCov">          0 :     *distortion = thismse;</span>
<span class="lineNum">     502 </span><span class="lineNoCov">          0 :     *sse1 = sse;</span>
<span class="lineNum">     503 </span>            :   }
<span class="lineNum">     504 </span>            : 
<span class="lineNum">     505 </span>            :   /* time to check quarter pels. */
<span class="lineNum">     506 </span><span class="lineNoCov">          0 :   if (bestmv-&gt;as_mv.row &lt; startmv.as_mv.row) y -= y_stride;</span>
<span class="lineNum">     507 </span>            : 
<span class="lineNum">     508 </span><span class="lineNoCov">          0 :   if (bestmv-&gt;as_mv.col &lt; startmv.as_mv.col) y--;</span>
<span class="lineNum">     509 </span>            : 
<span class="lineNum">     510 </span><span class="lineNoCov">          0 :   startmv = *bestmv;</span>
<span class="lineNum">     511 </span>            : 
<span class="lineNum">     512 </span>            :   /* go left then right and check error */
<span class="lineNum">     513 </span><span class="lineNoCov">          0 :   this_mv.as_mv.row = startmv.as_mv.row;</span>
<span class="lineNum">     514 </span>            : 
<span class="lineNum">     515 </span><span class="lineNoCov">          0 :   if (startmv.as_mv.col &amp; 7) {</span>
<span class="lineNum">     516 </span><span class="lineNoCov">          0 :     this_mv.as_mv.col = startmv.as_mv.col - 2;</span>
<span class="lineNum">     517 </span><span class="lineNoCov">          0 :     thismse = vfp-&gt;svf(y, y_stride, this_mv.as_mv.col &amp; 7,</span>
<span class="lineNum">     518 </span><span class="lineNoCov">          0 :                        this_mv.as_mv.row &amp; 7, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     519 </span>            :   } else {
<span class="lineNum">     520 </span><span class="lineNoCov">          0 :     this_mv.as_mv.col = (startmv.as_mv.col - 8) | 6;</span>
<span class="lineNum">     521 </span><span class="lineNoCov">          0 :     thismse = vfp-&gt;svf(y - 1, y_stride, 6, this_mv.as_mv.row &amp; 7, z,</span>
<span class="lineNum">     522 </span>            :                        b-&gt;src_stride, &amp;sse);
<span class="lineNum">     523 </span>            :   }
<span class="lineNum">     524 </span>            : 
<span class="lineNum">     525 </span><span class="lineNoCov">          0 :   left = thismse + mv_err_cost(&amp;this_mv, ref_mv, mvcost, error_per_bit);</span>
<span class="lineNum">     526 </span>            : 
<span class="lineNum">     527 </span><span class="lineNoCov">          0 :   if (left &lt; bestmse) {</span>
<span class="lineNum">     528 </span><span class="lineNoCov">          0 :     *bestmv = this_mv;</span>
<span class="lineNum">     529 </span><span class="lineNoCov">          0 :     bestmse = left;</span>
<span class="lineNum">     530 </span><span class="lineNoCov">          0 :     *distortion = thismse;</span>
<span class="lineNum">     531 </span><span class="lineNoCov">          0 :     *sse1 = sse;</span>
<span class="lineNum">     532 </span>            :   }
<span class="lineNum">     533 </span>            : 
<span class="lineNum">     534 </span><span class="lineNoCov">          0 :   this_mv.as_mv.col += 4;</span>
<span class="lineNum">     535 </span><span class="lineNoCov">          0 :   thismse = vfp-&gt;svf(y, y_stride, this_mv.as_mv.col &amp; 7, this_mv.as_mv.row &amp; 7,</span>
<span class="lineNum">     536 </span>            :                      z, b-&gt;src_stride, &amp;sse);
<span class="lineNum">     537 </span><span class="lineNoCov">          0 :   right = thismse + mv_err_cost(&amp;this_mv, ref_mv, mvcost, error_per_bit);</span>
<span class="lineNum">     538 </span>            : 
<span class="lineNum">     539 </span><span class="lineNoCov">          0 :   if (right &lt; bestmse) {</span>
<span class="lineNum">     540 </span><span class="lineNoCov">          0 :     *bestmv = this_mv;</span>
<span class="lineNum">     541 </span><span class="lineNoCov">          0 :     bestmse = right;</span>
<span class="lineNum">     542 </span><span class="lineNoCov">          0 :     *distortion = thismse;</span>
<span class="lineNum">     543 </span><span class="lineNoCov">          0 :     *sse1 = sse;</span>
<span class="lineNum">     544 </span>            :   }
<span class="lineNum">     545 </span>            : 
<span class="lineNum">     546 </span>            :   /* go up then down and check error */
<span class="lineNum">     547 </span><span class="lineNoCov">          0 :   this_mv.as_mv.col = startmv.as_mv.col;</span>
<span class="lineNum">     548 </span>            : 
<span class="lineNum">     549 </span><span class="lineNoCov">          0 :   if (startmv.as_mv.row &amp; 7) {</span>
<span class="lineNum">     550 </span><span class="lineNoCov">          0 :     this_mv.as_mv.row = startmv.as_mv.row - 2;</span>
<span class="lineNum">     551 </span><span class="lineNoCov">          0 :     thismse = vfp-&gt;svf(y, y_stride, this_mv.as_mv.col &amp; 7,</span>
<span class="lineNum">     552 </span><span class="lineNoCov">          0 :                        this_mv.as_mv.row &amp; 7, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     553 </span>            :   } else {
<span class="lineNum">     554 </span><span class="lineNoCov">          0 :     this_mv.as_mv.row = (startmv.as_mv.row - 8) | 6;</span>
<span class="lineNum">     555 </span><span class="lineNoCov">          0 :     thismse = vfp-&gt;svf(y - y_stride, y_stride, this_mv.as_mv.col &amp; 7, 6, z,</span>
<span class="lineNum">     556 </span>            :                        b-&gt;src_stride, &amp;sse);
<span class="lineNum">     557 </span>            :   }
<span class="lineNum">     558 </span>            : 
<span class="lineNum">     559 </span><span class="lineNoCov">          0 :   up = thismse + mv_err_cost(&amp;this_mv, ref_mv, mvcost, error_per_bit);</span>
<span class="lineNum">     560 </span>            : 
<span class="lineNum">     561 </span><span class="lineNoCov">          0 :   if (up &lt; bestmse) {</span>
<span class="lineNum">     562 </span><span class="lineNoCov">          0 :     *bestmv = this_mv;</span>
<span class="lineNum">     563 </span><span class="lineNoCov">          0 :     bestmse = up;</span>
<span class="lineNum">     564 </span><span class="lineNoCov">          0 :     *distortion = thismse;</span>
<span class="lineNum">     565 </span><span class="lineNoCov">          0 :     *sse1 = sse;</span>
<span class="lineNum">     566 </span>            :   }
<span class="lineNum">     567 </span>            : 
<span class="lineNum">     568 </span><span class="lineNoCov">          0 :   this_mv.as_mv.row += 4;</span>
<span class="lineNum">     569 </span><span class="lineNoCov">          0 :   thismse = vfp-&gt;svf(y, y_stride, this_mv.as_mv.col &amp; 7, this_mv.as_mv.row &amp; 7,</span>
<span class="lineNum">     570 </span>            :                      z, b-&gt;src_stride, &amp;sse);
<span class="lineNum">     571 </span><span class="lineNoCov">          0 :   down = thismse + mv_err_cost(&amp;this_mv, ref_mv, mvcost, error_per_bit);</span>
<span class="lineNum">     572 </span>            : 
<span class="lineNum">     573 </span><span class="lineNoCov">          0 :   if (down &lt; bestmse) {</span>
<span class="lineNum">     574 </span><span class="lineNoCov">          0 :     *bestmv = this_mv;</span>
<span class="lineNum">     575 </span><span class="lineNoCov">          0 :     bestmse = down;</span>
<span class="lineNum">     576 </span><span class="lineNoCov">          0 :     *distortion = thismse;</span>
<span class="lineNum">     577 </span><span class="lineNoCov">          0 :     *sse1 = sse;</span>
<span class="lineNum">     578 </span>            :   }
<span class="lineNum">     579 </span>            : 
<span class="lineNum">     580 </span>            :   /* now check 1 more diagonal */
<span class="lineNum">     581 </span><span class="lineNoCov">          0 :   whichdir = (left &lt; right ? 0 : 1) + (up &lt; down ? 0 : 2);</span>
<span class="lineNum">     582 </span>            : 
<span class="lineNum">     583 </span><span class="lineNoCov">          0 :   this_mv = startmv;</span>
<span class="lineNum">     584 </span>            : 
<span class="lineNum">     585 </span><span class="lineNoCov">          0 :   switch (whichdir) {</span>
<span class="lineNum">     586 </span>            :     case 0:
<span class="lineNum">     587 </span>            : 
<span class="lineNum">     588 </span><span class="lineNoCov">          0 :       if (startmv.as_mv.row &amp; 7) {</span>
<span class="lineNum">     589 </span><span class="lineNoCov">          0 :         this_mv.as_mv.row -= 2;</span>
<span class="lineNum">     590 </span>            : 
<span class="lineNum">     591 </span><span class="lineNoCov">          0 :         if (startmv.as_mv.col &amp; 7) {</span>
<span class="lineNum">     592 </span><span class="lineNoCov">          0 :           this_mv.as_mv.col -= 2;</span>
<span class="lineNum">     593 </span><span class="lineNoCov">          0 :           thismse = vfp-&gt;svf(y, y_stride, this_mv.as_mv.col &amp; 7,</span>
<span class="lineNum">     594 </span><span class="lineNoCov">          0 :                              this_mv.as_mv.row &amp; 7, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     595 </span>            :         } else {
<span class="lineNum">     596 </span><span class="lineNoCov">          0 :           this_mv.as_mv.col = (startmv.as_mv.col - 8) | 6;</span>
<span class="lineNum">     597 </span><span class="lineNoCov">          0 :           thismse = vfp-&gt;svf(y - 1, y_stride, 6, this_mv.as_mv.row &amp; 7, z,</span>
<span class="lineNum">     598 </span>            :                              b-&gt;src_stride, &amp;sse);
<span class="lineNum">     599 </span>            :         }
<span class="lineNum">     600 </span>            :       } else {
<span class="lineNum">     601 </span><span class="lineNoCov">          0 :         this_mv.as_mv.row = (startmv.as_mv.row - 8) | 6;</span>
<span class="lineNum">     602 </span>            : 
<span class="lineNum">     603 </span><span class="lineNoCov">          0 :         if (startmv.as_mv.col &amp; 7) {</span>
<span class="lineNum">     604 </span><span class="lineNoCov">          0 :           this_mv.as_mv.col -= 2;</span>
<span class="lineNum">     605 </span><span class="lineNoCov">          0 :           thismse = vfp-&gt;svf(y - y_stride, y_stride, this_mv.as_mv.col &amp; 7, 6,</span>
<span class="lineNum">     606 </span>            :                              z, b-&gt;src_stride, &amp;sse);
<span class="lineNum">     607 </span>            :         } else {
<span class="lineNum">     608 </span><span class="lineNoCov">          0 :           this_mv.as_mv.col = (startmv.as_mv.col - 8) | 6;</span>
<span class="lineNum">     609 </span><span class="lineNoCov">          0 :           thismse = vfp-&gt;svf(y - y_stride - 1, y_stride, 6, 6, z, b-&gt;src_stride,</span>
<span class="lineNum">     610 </span>            :                              &amp;sse);
<span class="lineNum">     611 </span>            :         }
<span class="lineNum">     612 </span>            :       }
<span class="lineNum">     613 </span>            : 
<span class="lineNum">     614 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     615 </span>            :     case 1:
<span class="lineNum">     616 </span><span class="lineNoCov">          0 :       this_mv.as_mv.col += 2;</span>
<span class="lineNum">     617 </span>            : 
<span class="lineNum">     618 </span><span class="lineNoCov">          0 :       if (startmv.as_mv.row &amp; 7) {</span>
<span class="lineNum">     619 </span><span class="lineNoCov">          0 :         this_mv.as_mv.row -= 2;</span>
<span class="lineNum">     620 </span><span class="lineNoCov">          0 :         thismse = vfp-&gt;svf(y, y_stride, this_mv.as_mv.col &amp; 7,</span>
<span class="lineNum">     621 </span><span class="lineNoCov">          0 :                            this_mv.as_mv.row &amp; 7, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     622 </span>            :       } else {
<span class="lineNum">     623 </span><span class="lineNoCov">          0 :         this_mv.as_mv.row = (startmv.as_mv.row - 8) | 6;</span>
<span class="lineNum">     624 </span><span class="lineNoCov">          0 :         thismse = vfp-&gt;svf(y - y_stride, y_stride, this_mv.as_mv.col &amp; 7, 6, z,</span>
<span class="lineNum">     625 </span>            :                            b-&gt;src_stride, &amp;sse);
<span class="lineNum">     626 </span>            :       }
<span class="lineNum">     627 </span>            : 
<span class="lineNum">     628 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     629 </span>            :     case 2:
<span class="lineNum">     630 </span><span class="lineNoCov">          0 :       this_mv.as_mv.row += 2;</span>
<span class="lineNum">     631 </span>            : 
<span class="lineNum">     632 </span><span class="lineNoCov">          0 :       if (startmv.as_mv.col &amp; 7) {</span>
<span class="lineNum">     633 </span><span class="lineNoCov">          0 :         this_mv.as_mv.col -= 2;</span>
<span class="lineNum">     634 </span><span class="lineNoCov">          0 :         thismse = vfp-&gt;svf(y, y_stride, this_mv.as_mv.col &amp; 7,</span>
<span class="lineNum">     635 </span><span class="lineNoCov">          0 :                            this_mv.as_mv.row &amp; 7, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     636 </span>            :       } else {
<span class="lineNum">     637 </span><span class="lineNoCov">          0 :         this_mv.as_mv.col = (startmv.as_mv.col - 8) | 6;</span>
<span class="lineNum">     638 </span><span class="lineNoCov">          0 :         thismse = vfp-&gt;svf(y - 1, y_stride, 6, this_mv.as_mv.row &amp; 7, z,</span>
<span class="lineNum">     639 </span>            :                            b-&gt;src_stride, &amp;sse);
<span class="lineNum">     640 </span>            :       }
<span class="lineNum">     641 </span>            : 
<span class="lineNum">     642 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     643 </span>            :     case 3:
<span class="lineNum">     644 </span><span class="lineNoCov">          0 :       this_mv.as_mv.col += 2;</span>
<span class="lineNum">     645 </span><span class="lineNoCov">          0 :       this_mv.as_mv.row += 2;</span>
<span class="lineNum">     646 </span><span class="lineNoCov">          0 :       thismse = vfp-&gt;svf(y, y_stride, this_mv.as_mv.col &amp; 7,</span>
<span class="lineNum">     647 </span><span class="lineNoCov">          0 :                          this_mv.as_mv.row &amp; 7, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     648 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     649 </span>            :   }
<span class="lineNum">     650 </span>            : 
<span class="lineNum">     651 </span><span class="lineNoCov">          0 :   diag = thismse + mv_err_cost(&amp;this_mv, ref_mv, mvcost, error_per_bit);</span>
<span class="lineNum">     652 </span>            : 
<span class="lineNum">     653 </span><span class="lineNoCov">          0 :   if (diag &lt; bestmse) {</span>
<span class="lineNum">     654 </span><span class="lineNoCov">          0 :     *bestmv = this_mv;</span>
<span class="lineNum">     655 </span><span class="lineNoCov">          0 :     bestmse = diag;</span>
<span class="lineNum">     656 </span><span class="lineNoCov">          0 :     *distortion = thismse;</span>
<span class="lineNum">     657 </span><span class="lineNoCov">          0 :     *sse1 = sse;</span>
<span class="lineNum">     658 </span>            :   }
<span class="lineNum">     659 </span>            : 
<span class="lineNum">     660 </span><span class="lineNoCov">          0 :   return bestmse;</span>
<a name="661"><span class="lineNum">     661 </span>            : }</a>
<span class="lineNum">     662 </span>            : 
<span class="lineNum">     663 </span><span class="lineNoCov">          0 : int vp8_find_best_half_pixel_step(MACROBLOCK *x, BLOCK *b, BLOCKD *d,</span>
<span class="lineNum">     664 </span>            :                                   int_mv *bestmv, int_mv *ref_mv,
<span class="lineNum">     665 </span>            :                                   int error_per_bit,
<span class="lineNum">     666 </span>            :                                   const vp8_variance_fn_ptr_t *vfp,
<span class="lineNum">     667 </span>            :                                   int *mvcost[2], int *distortion,
<span class="lineNum">     668 </span>            :                                   unsigned int *sse1) {
<span class="lineNum">     669 </span><span class="lineNoCov">          0 :   int bestmse = INT_MAX;</span>
<span class="lineNum">     670 </span>            :   int_mv startmv;
<span class="lineNum">     671 </span>            :   int_mv this_mv;
<span class="lineNum">     672 </span><span class="lineNoCov">          0 :   unsigned char *z = (*(b-&gt;base_src) + b-&gt;src);</span>
<span class="lineNum">     673 </span>            :   int left, right, up, down, diag;
<span class="lineNum">     674 </span>            :   unsigned int sse;
<span class="lineNum">     675 </span>            :   int whichdir;
<span class="lineNum">     676 </span>            :   int thismse;
<span class="lineNum">     677 </span>            :   int y_stride;
<span class="lineNum">     678 </span><span class="lineNoCov">          0 :   int pre_stride = x-&gt;e_mbd.pre.y_stride;</span>
<span class="lineNum">     679 </span><span class="lineNoCov">          0 :   unsigned char *base_pre = x-&gt;e_mbd.pre.y_buffer;</span>
<span class="lineNum">     680 </span>            : 
<span class="lineNum">     681 </span>            : #if ARCH_X86 || ARCH_X86_64
<span class="lineNum">     682 </span><span class="lineNoCov">          0 :   MACROBLOCKD *xd = &amp;x-&gt;e_mbd;</span>
<span class="lineNum">     683 </span><span class="lineNoCov">          0 :   unsigned char *y_0 = base_pre + d-&gt;offset + (bestmv-&gt;as_mv.row) * pre_stride +</span>
<span class="lineNum">     684 </span><span class="lineNoCov">          0 :                        bestmv-&gt;as_mv.col;</span>
<span class="lineNum">     685 </span>            :   unsigned char *y;
<span class="lineNum">     686 </span>            : 
<span class="lineNum">     687 </span><span class="lineNoCov">          0 :   y_stride = 32;</span>
<span class="lineNum">     688 </span>            :   /* Copy 18 rows x 32 cols area to intermediate buffer before searching. */
<span class="lineNum">     689 </span><span class="lineNoCov">          0 :   vfp-&gt;copymem(y_0 - 1 - pre_stride, pre_stride, xd-&gt;y_buf, y_stride, 18);</span>
<span class="lineNum">     690 </span><span class="lineNoCov">          0 :   y = xd-&gt;y_buf + y_stride + 1;</span>
<span class="lineNum">     691 </span>            : #else
<span class="lineNum">     692 </span>            :   unsigned char *y = base_pre + d-&gt;offset + (bestmv-&gt;as_mv.row) * pre_stride +
<span class="lineNum">     693 </span>            :                      bestmv-&gt;as_mv.col;
<span class="lineNum">     694 </span>            :   y_stride = pre_stride;
<span class="lineNum">     695 </span>            : #endif
<span class="lineNum">     696 </span>            : 
<span class="lineNum">     697 </span>            :   /* central mv */
<span class="lineNum">     698 </span><span class="lineNoCov">          0 :   bestmv-&gt;as_mv.row *= 8;</span>
<span class="lineNum">     699 </span><span class="lineNoCov">          0 :   bestmv-&gt;as_mv.col *= 8;</span>
<span class="lineNum">     700 </span><span class="lineNoCov">          0 :   startmv = *bestmv;</span>
<span class="lineNum">     701 </span>            : 
<span class="lineNum">     702 </span>            :   /* calculate central point error */
<span class="lineNum">     703 </span><span class="lineNoCov">          0 :   bestmse = vfp-&gt;vf(y, y_stride, z, b-&gt;src_stride, sse1);</span>
<span class="lineNum">     704 </span><span class="lineNoCov">          0 :   *distortion = bestmse;</span>
<span class="lineNum">     705 </span><span class="lineNoCov">          0 :   bestmse += mv_err_cost(bestmv, ref_mv, mvcost, error_per_bit);</span>
<span class="lineNum">     706 </span>            : 
<span class="lineNum">     707 </span>            :   /* go left then right and check error */
<span class="lineNum">     708 </span><span class="lineNoCov">          0 :   this_mv.as_mv.row = startmv.as_mv.row;</span>
<span class="lineNum">     709 </span><span class="lineNoCov">          0 :   this_mv.as_mv.col = ((startmv.as_mv.col - 8) | 4);</span>
<span class="lineNum">     710 </span>            :   /* &quot;halfpix&quot; horizontal variance */
<span class="lineNum">     711 </span><span class="lineNoCov">          0 :   thismse = vfp-&gt;svf(y - 1, y_stride, 4, 0, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     712 </span><span class="lineNoCov">          0 :   left = thismse + mv_err_cost(&amp;this_mv, ref_mv, mvcost, error_per_bit);</span>
<span class="lineNum">     713 </span>            : 
<span class="lineNum">     714 </span><span class="lineNoCov">          0 :   if (left &lt; bestmse) {</span>
<span class="lineNum">     715 </span><span class="lineNoCov">          0 :     *bestmv = this_mv;</span>
<span class="lineNum">     716 </span><span class="lineNoCov">          0 :     bestmse = left;</span>
<span class="lineNum">     717 </span><span class="lineNoCov">          0 :     *distortion = thismse;</span>
<span class="lineNum">     718 </span><span class="lineNoCov">          0 :     *sse1 = sse;</span>
<span class="lineNum">     719 </span>            :   }
<span class="lineNum">     720 </span>            : 
<span class="lineNum">     721 </span><span class="lineNoCov">          0 :   this_mv.as_mv.col += 8;</span>
<span class="lineNum">     722 </span>            :   /* &quot;halfpix&quot; horizontal variance */
<span class="lineNum">     723 </span><span class="lineNoCov">          0 :   thismse = vfp-&gt;svf(y, y_stride, 4, 0, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     724 </span><span class="lineNoCov">          0 :   right = thismse + mv_err_cost(&amp;this_mv, ref_mv, mvcost, error_per_bit);</span>
<span class="lineNum">     725 </span>            : 
<span class="lineNum">     726 </span><span class="lineNoCov">          0 :   if (right &lt; bestmse) {</span>
<span class="lineNum">     727 </span><span class="lineNoCov">          0 :     *bestmv = this_mv;</span>
<span class="lineNum">     728 </span><span class="lineNoCov">          0 :     bestmse = right;</span>
<span class="lineNum">     729 </span><span class="lineNoCov">          0 :     *distortion = thismse;</span>
<span class="lineNum">     730 </span><span class="lineNoCov">          0 :     *sse1 = sse;</span>
<span class="lineNum">     731 </span>            :   }
<span class="lineNum">     732 </span>            : 
<span class="lineNum">     733 </span>            :   /* go up then down and check error */
<span class="lineNum">     734 </span><span class="lineNoCov">          0 :   this_mv.as_mv.col = startmv.as_mv.col;</span>
<span class="lineNum">     735 </span><span class="lineNoCov">          0 :   this_mv.as_mv.row = ((startmv.as_mv.row - 8) | 4);</span>
<span class="lineNum">     736 </span>            :   /* &quot;halfpix&quot; vertical variance */
<span class="lineNum">     737 </span><span class="lineNoCov">          0 :   thismse = vfp-&gt;svf(y - y_stride, y_stride, 0, 4, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     738 </span><span class="lineNoCov">          0 :   up = thismse + mv_err_cost(&amp;this_mv, ref_mv, mvcost, error_per_bit);</span>
<span class="lineNum">     739 </span>            : 
<span class="lineNum">     740 </span><span class="lineNoCov">          0 :   if (up &lt; bestmse) {</span>
<span class="lineNum">     741 </span><span class="lineNoCov">          0 :     *bestmv = this_mv;</span>
<span class="lineNum">     742 </span><span class="lineNoCov">          0 :     bestmse = up;</span>
<span class="lineNum">     743 </span><span class="lineNoCov">          0 :     *distortion = thismse;</span>
<span class="lineNum">     744 </span><span class="lineNoCov">          0 :     *sse1 = sse;</span>
<span class="lineNum">     745 </span>            :   }
<span class="lineNum">     746 </span>            : 
<span class="lineNum">     747 </span><span class="lineNoCov">          0 :   this_mv.as_mv.row += 8;</span>
<span class="lineNum">     748 </span>            :   /* &quot;halfpix&quot; vertical variance */
<span class="lineNum">     749 </span><span class="lineNoCov">          0 :   thismse = vfp-&gt;svf(y, y_stride, 0, 4, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     750 </span><span class="lineNoCov">          0 :   down = thismse + mv_err_cost(&amp;this_mv, ref_mv, mvcost, error_per_bit);</span>
<span class="lineNum">     751 </span>            : 
<span class="lineNum">     752 </span><span class="lineNoCov">          0 :   if (down &lt; bestmse) {</span>
<span class="lineNum">     753 </span><span class="lineNoCov">          0 :     *bestmv = this_mv;</span>
<span class="lineNum">     754 </span><span class="lineNoCov">          0 :     bestmse = down;</span>
<span class="lineNum">     755 </span><span class="lineNoCov">          0 :     *distortion = thismse;</span>
<span class="lineNum">     756 </span><span class="lineNoCov">          0 :     *sse1 = sse;</span>
<span class="lineNum">     757 </span>            :   }
<span class="lineNum">     758 </span>            : 
<span class="lineNum">     759 </span>            :   /* now check 1 more diagonal - */
<span class="lineNum">     760 </span><span class="lineNoCov">          0 :   whichdir = (left &lt; right ? 0 : 1) + (up &lt; down ? 0 : 2);</span>
<span class="lineNum">     761 </span><span class="lineNoCov">          0 :   this_mv = startmv;</span>
<span class="lineNum">     762 </span>            : 
<span class="lineNum">     763 </span><span class="lineNoCov">          0 :   switch (whichdir) {</span>
<span class="lineNum">     764 </span>            :     case 0:
<span class="lineNum">     765 </span><span class="lineNoCov">          0 :       this_mv.as_mv.col = (this_mv.as_mv.col - 8) | 4;</span>
<span class="lineNum">     766 </span><span class="lineNoCov">          0 :       this_mv.as_mv.row = (this_mv.as_mv.row - 8) | 4;</span>
<span class="lineNum">     767 </span>            :       /* &quot;halfpix&quot; horizontal/vertical variance */
<span class="lineNum">     768 </span><span class="lineNoCov">          0 :       thismse =</span>
<span class="lineNum">     769 </span><span class="lineNoCov">          0 :           vfp-&gt;svf(y - 1 - y_stride, y_stride, 4, 4, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     770 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     771 </span>            :     case 1:
<span class="lineNum">     772 </span><span class="lineNoCov">          0 :       this_mv.as_mv.col += 4;</span>
<span class="lineNum">     773 </span><span class="lineNoCov">          0 :       this_mv.as_mv.row = (this_mv.as_mv.row - 8) | 4;</span>
<span class="lineNum">     774 </span>            :       /* &quot;halfpix&quot; horizontal/vertical variance */
<span class="lineNum">     775 </span><span class="lineNoCov">          0 :       thismse = vfp-&gt;svf(y - y_stride, y_stride, 4, 4, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     776 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     777 </span>            :     case 2:
<span class="lineNum">     778 </span><span class="lineNoCov">          0 :       this_mv.as_mv.col = (this_mv.as_mv.col - 8) | 4;</span>
<span class="lineNum">     779 </span><span class="lineNoCov">          0 :       this_mv.as_mv.row += 4;</span>
<span class="lineNum">     780 </span>            :       /* &quot;halfpix&quot; horizontal/vertical variance */
<span class="lineNum">     781 </span><span class="lineNoCov">          0 :       thismse = vfp-&gt;svf(y - 1, y_stride, 4, 4, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     782 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     783 </span>            :     case 3:
<span class="lineNum">     784 </span>            :     default:
<span class="lineNum">     785 </span><span class="lineNoCov">          0 :       this_mv.as_mv.col += 4;</span>
<span class="lineNum">     786 </span><span class="lineNoCov">          0 :       this_mv.as_mv.row += 4;</span>
<span class="lineNum">     787 </span>            :       /* &quot;halfpix&quot; horizontal/vertical variance */
<span class="lineNum">     788 </span><span class="lineNoCov">          0 :       thismse = vfp-&gt;svf(y, y_stride, 4, 4, z, b-&gt;src_stride, &amp;sse);</span>
<span class="lineNum">     789 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     790 </span>            :   }
<span class="lineNum">     791 </span>            : 
<span class="lineNum">     792 </span><span class="lineNoCov">          0 :   diag = thismse + mv_err_cost(&amp;this_mv, ref_mv, mvcost, error_per_bit);</span>
<span class="lineNum">     793 </span>            : 
<span class="lineNum">     794 </span><span class="lineNoCov">          0 :   if (diag &lt; bestmse) {</span>
<span class="lineNum">     795 </span><span class="lineNoCov">          0 :     *bestmv = this_mv;</span>
<span class="lineNum">     796 </span><span class="lineNoCov">          0 :     bestmse = diag;</span>
<span class="lineNum">     797 </span><span class="lineNoCov">          0 :     *distortion = thismse;</span>
<span class="lineNum">     798 </span><span class="lineNoCov">          0 :     *sse1 = sse;</span>
<span class="lineNum">     799 </span>            :   }
<span class="lineNum">     800 </span>            : 
<span class="lineNum">     801 </span><span class="lineNoCov">          0 :   return bestmse;</span>
<span class="lineNum">     802 </span>            : }
<span class="lineNum">     803 </span>            : 
<span class="lineNum">     804 </span>            : #define CHECK_BOUNDS(range)                    \
<span class="lineNum">     805 </span>            :   {                                            \
<span class="lineNum">     806 </span>            :     all_in = 1;                                \
<span class="lineNum">     807 </span>            :     all_in &amp;= ((br - range) &gt;= x-&gt;mv_row_min); \
<span class="lineNum">     808 </span>            :     all_in &amp;= ((br + range) &lt;= x-&gt;mv_row_max); \
<span class="lineNum">     809 </span>            :     all_in &amp;= ((bc - range) &gt;= x-&gt;mv_col_min); \
<span class="lineNum">     810 </span>            :     all_in &amp;= ((bc + range) &lt;= x-&gt;mv_col_max); \
<span class="lineNum">     811 </span>            :   }
<span class="lineNum">     812 </span>            : 
<span class="lineNum">     813 </span>            : #define CHECK_POINT                                  \
<span class="lineNum">     814 </span>            :   {                                                  \
<span class="lineNum">     815 </span>            :     if (this_mv.as_mv.col &lt; x-&gt;mv_col_min) continue; \
<span class="lineNum">     816 </span>            :     if (this_mv.as_mv.col &gt; x-&gt;mv_col_max) continue; \
<span class="lineNum">     817 </span>            :     if (this_mv.as_mv.row &lt; x-&gt;mv_row_min) continue; \
<span class="lineNum">     818 </span>            :     if (this_mv.as_mv.row &gt; x-&gt;mv_row_max) continue; \
<span class="lineNum">     819 </span>            :   }
<span class="lineNum">     820 </span>            : 
<span class="lineNum">     821 </span>            : #define CHECK_BETTER                                                     \
<span class="lineNum">     822 </span>            :   {                                                                      \
<span class="lineNum">     823 </span>            :     if (thissad &lt; bestsad) {                                             \
<span class="lineNum">     824 </span>            :       thissad +=                                                         \
<span class="lineNum">     825 </span>            :           mvsad_err_cost(&amp;this_mv, &amp;fcenter_mv, mvsadcost, sad_per_bit); \
<span class="lineNum">     826 </span>            :       if (thissad &lt; bestsad) {                                           \
<span class="lineNum">     827 </span>            :         bestsad = thissad;                                               \
<span class="lineNum">     828 </span>            :         best_site = i;                                                   \
<span class="lineNum">     829 </span>            :       }                                                                  \
<span class="lineNum">     830 </span>            :     }                                                                    \
<span class="lineNum">     831 </span>            :   }
<span class="lineNum">     832 </span>            : 
<span class="lineNum">     833 </span>            : static const MV next_chkpts[6][3] = {
<span class="lineNum">     834 </span>            :   { { -2, 0 }, { -1, -2 }, { 1, -2 } }, { { -1, -2 }, { 1, -2 }, { 2, 0 } },
<span class="lineNum">     835 </span>            :   { { 1, -2 }, { 2, 0 }, { 1, 2 } },    { { 2, 0 }, { 1, 2 }, { -1, 2 } },
<span class="lineNum">     836 </span>            :   { { 1, 2 }, { -1, 2 }, { -2, 0 } },   { { -1, 2 }, { -2, 0 }, { -1, -2 } }
<a name="837"><span class="lineNum">     837 </span>            : };</a>
<span class="lineNum">     838 </span>            : 
<span class="lineNum">     839 </span><span class="lineNoCov">          0 : int vp8_hex_search(MACROBLOCK *x, BLOCK *b, BLOCKD *d, int_mv *ref_mv,</span>
<span class="lineNum">     840 </span>            :                    int_mv *best_mv, int search_param, int sad_per_bit,
<span class="lineNum">     841 </span>            :                    const vp8_variance_fn_ptr_t *vfp, int *mvsadcost[2],
<span class="lineNum">     842 </span>            :                    int *mvcost[2], int_mv *center_mv) {
<span class="lineNum">     843 </span><span class="lineNoCov">          0 :   MV hex[6] = {</span>
<span class="lineNum">     844 </span>            :     { -1, -2 }, { 1, -2 }, { 2, 0 }, { 1, 2 }, { -1, 2 }, { -2, 0 }
<span class="lineNum">     845 </span>            :   };
<span class="lineNum">     846 </span><span class="lineNoCov">          0 :   MV neighbors[4] = { { 0, -1 }, { -1, 0 }, { 1, 0 }, { 0, 1 } };</span>
<span class="lineNum">     847 </span>            :   int i, j;
<span class="lineNum">     848 </span>            : 
<span class="lineNum">     849 </span><span class="lineNoCov">          0 :   unsigned char *what = (*(b-&gt;base_src) + b-&gt;src);</span>
<span class="lineNum">     850 </span><span class="lineNoCov">          0 :   int what_stride = b-&gt;src_stride;</span>
<span class="lineNum">     851 </span><span class="lineNoCov">          0 :   int pre_stride = x-&gt;e_mbd.pre.y_stride;</span>
<span class="lineNum">     852 </span><span class="lineNoCov">          0 :   unsigned char *base_pre = x-&gt;e_mbd.pre.y_buffer;</span>
<span class="lineNum">     853 </span>            : 
<span class="lineNum">     854 </span><span class="lineNoCov">          0 :   int in_what_stride = pre_stride;</span>
<span class="lineNum">     855 </span>            :   int br, bc;
<span class="lineNum">     856 </span>            :   int_mv this_mv;
<span class="lineNum">     857 </span>            :   unsigned int bestsad;
<span class="lineNum">     858 </span>            :   unsigned int thissad;
<span class="lineNum">     859 </span>            :   unsigned char *base_offset;
<span class="lineNum">     860 </span>            :   unsigned char *this_offset;
<span class="lineNum">     861 </span><span class="lineNoCov">          0 :   int k = -1;</span>
<span class="lineNum">     862 </span>            :   int all_in;
<span class="lineNum">     863 </span><span class="lineNoCov">          0 :   int best_site = -1;</span>
<span class="lineNum">     864 </span><span class="lineNoCov">          0 :   int hex_range = 127;</span>
<span class="lineNum">     865 </span><span class="lineNoCov">          0 :   int dia_range = 8;</span>
<span class="lineNum">     866 </span>            : 
<span class="lineNum">     867 </span>            :   int_mv fcenter_mv;
<span class="lineNum">     868 </span><span class="lineNoCov">          0 :   fcenter_mv.as_mv.row = center_mv-&gt;as_mv.row &gt;&gt; 3;</span>
<span class="lineNum">     869 </span><span class="lineNoCov">          0 :   fcenter_mv.as_mv.col = center_mv-&gt;as_mv.col &gt;&gt; 3;</span>
<span class="lineNum">     870 </span>            : 
<span class="lineNum">     871 </span>            :   (void)mvcost;
<span class="lineNum">     872 </span>            : 
<span class="lineNum">     873 </span>            :   /* adjust ref_mv to make sure it is within MV range */
<span class="lineNum">     874 </span><span class="lineNoCov">          0 :   vp8_clamp_mv(ref_mv, x-&gt;mv_col_min, x-&gt;mv_col_max, x-&gt;mv_row_min,</span>
<span class="lineNum">     875 </span>            :                x-&gt;mv_row_max);
<span class="lineNum">     876 </span><span class="lineNoCov">          0 :   br = ref_mv-&gt;as_mv.row;</span>
<span class="lineNum">     877 </span><span class="lineNoCov">          0 :   bc = ref_mv-&gt;as_mv.col;</span>
<span class="lineNum">     878 </span>            : 
<span class="lineNum">     879 </span>            :   /* Work out the start point for the search */
<span class="lineNum">     880 </span><span class="lineNoCov">          0 :   base_offset = (unsigned char *)(base_pre + d-&gt;offset);</span>
<span class="lineNum">     881 </span><span class="lineNoCov">          0 :   this_offset = base_offset + (br * (pre_stride)) + bc;</span>
<span class="lineNum">     882 </span><span class="lineNoCov">          0 :   this_mv.as_mv.row = br;</span>
<span class="lineNum">     883 </span><span class="lineNoCov">          0 :   this_mv.as_mv.col = bc;</span>
<span class="lineNum">     884 </span><span class="lineNoCov">          0 :   bestsad = vfp-&gt;sdf(what, what_stride, this_offset, in_what_stride) +</span>
<span class="lineNum">     885 </span><span class="lineNoCov">          0 :             mvsad_err_cost(&amp;this_mv, &amp;fcenter_mv, mvsadcost, sad_per_bit);</span>
<span class="lineNum">     886 </span>            : 
<span class="lineNum">     887 </span>            : #if CONFIG_MULTI_RES_ENCODING
<span class="lineNum">     888 </span>            :   /* Lower search range based on prediction info */
<span class="lineNum">     889 </span><span class="lineNoCov">          0 :   if (search_param &gt;= 6)</span>
<span class="lineNum">     890 </span><span class="lineNoCov">          0 :     goto cal_neighbors;</span>
<span class="lineNum">     891 </span><span class="lineNoCov">          0 :   else if (search_param &gt;= 5)</span>
<span class="lineNum">     892 </span><span class="lineNoCov">          0 :     hex_range = 4;</span>
<span class="lineNum">     893 </span><span class="lineNoCov">          0 :   else if (search_param &gt;= 4)</span>
<span class="lineNum">     894 </span><span class="lineNoCov">          0 :     hex_range = 6;</span>
<span class="lineNum">     895 </span><span class="lineNoCov">          0 :   else if (search_param &gt;= 3)</span>
<span class="lineNum">     896 </span><span class="lineNoCov">          0 :     hex_range = 15;</span>
<span class="lineNum">     897 </span><span class="lineNoCov">          0 :   else if (search_param &gt;= 2)</span>
<span class="lineNum">     898 </span><span class="lineNoCov">          0 :     hex_range = 31;</span>
<span class="lineNum">     899 </span><span class="lineNoCov">          0 :   else if (search_param &gt;= 1)</span>
<span class="lineNum">     900 </span><span class="lineNoCov">          0 :     hex_range = 63;</span>
<span class="lineNum">     901 </span>            : 
<span class="lineNum">     902 </span><span class="lineNoCov">          0 :   dia_range = 8;</span>
<span class="lineNum">     903 </span>            : #else
<span class="lineNum">     904 </span>            :   (void)search_param;
<span class="lineNum">     905 </span>            : #endif
<span class="lineNum">     906 </span>            : 
<span class="lineNum">     907 </span>            :   /* hex search */
<span class="lineNum">     908 </span><span class="lineNoCov">          0 :   CHECK_BOUNDS(2)</span>
<span class="lineNum">     909 </span>            : 
<span class="lineNum">     910 </span><span class="lineNoCov">          0 :   if (all_in) {</span>
<span class="lineNum">     911 </span><span class="lineNoCov">          0 :     for (i = 0; i &lt; 6; ++i) {</span>
<span class="lineNum">     912 </span><span class="lineNoCov">          0 :       this_mv.as_mv.row = br + hex[i].row;</span>
<span class="lineNum">     913 </span><span class="lineNoCov">          0 :       this_mv.as_mv.col = bc + hex[i].col;</span>
<span class="lineNum">     914 </span><span class="lineNoCov">          0 :       this_offset = base_offset + (this_mv.as_mv.row * in_what_stride) +</span>
<span class="lineNum">     915 </span><span class="lineNoCov">          0 :                     this_mv.as_mv.col;</span>
<span class="lineNum">     916 </span><span class="lineNoCov">          0 :       thissad = vfp-&gt;sdf(what, what_stride, this_offset, in_what_stride);</span>
<span class="lineNum">     917 </span><span class="lineNoCov">          0 :       CHECK_BETTER</span>
<span class="lineNum">     918 </span>            :     }
<span class="lineNum">     919 </span>            :   } else {
<span class="lineNum">     920 </span><span class="lineNoCov">          0 :     for (i = 0; i &lt; 6; ++i) {</span>
<span class="lineNum">     921 </span><span class="lineNoCov">          0 :       this_mv.as_mv.row = br + hex[i].row;</span>
<span class="lineNum">     922 </span><span class="lineNoCov">          0 :       this_mv.as_mv.col = bc + hex[i].col;</span>
<span class="lineNum">     923 </span><span class="lineNoCov">          0 :       CHECK_POINT</span>
<span class="lineNum">     924 </span><span class="lineNoCov">          0 :       this_offset = base_offset + (this_mv.as_mv.row * in_what_stride) +</span>
<span class="lineNum">     925 </span><span class="lineNoCov">          0 :                     this_mv.as_mv.col;</span>
<span class="lineNum">     926 </span><span class="lineNoCov">          0 :       thissad = vfp-&gt;sdf(what, what_stride, this_offset, in_what_stride);</span>
<span class="lineNum">     927 </span><span class="lineNoCov">          0 :       CHECK_BETTER</span>
<span class="lineNum">     928 </span>            :     }
<span class="lineNum">     929 </span>            :   }
<span class="lineNum">     930 </span>            : 
<span class="lineNum">     931 </span><span class="lineNoCov">          0 :   if (best_site == -1) {</span>
<span class="lineNum">     932 </span><span class="lineNoCov">          0 :     goto cal_neighbors;</span>
<span class="lineNum">     933 </span>            :   } else {
<span class="lineNum">     934 </span><span class="lineNoCov">          0 :     br += hex[best_site].row;</span>
<span class="lineNum">     935 </span><span class="lineNoCov">          0 :     bc += hex[best_site].col;</span>
<span class="lineNum">     936 </span><span class="lineNoCov">          0 :     k = best_site;</span>
<span class="lineNum">     937 </span>            :   }
<span class="lineNum">     938 </span>            : 
<span class="lineNum">     939 </span><span class="lineNoCov">          0 :   for (j = 1; j &lt; hex_range; ++j) {</span>
<span class="lineNum">     940 </span><span class="lineNoCov">          0 :     best_site = -1;</span>
<span class="lineNum">     941 </span><span class="lineNoCov">          0 :     CHECK_BOUNDS(2)</span>
<span class="lineNum">     942 </span>            : 
<span class="lineNum">     943 </span><span class="lineNoCov">          0 :     if (all_in) {</span>
<span class="lineNum">     944 </span><span class="lineNoCov">          0 :       for (i = 0; i &lt; 3; ++i) {</span>
<span class="lineNum">     945 </span><span class="lineNoCov">          0 :         this_mv.as_mv.row = br + next_chkpts[k][i].row;</span>
<span class="lineNum">     946 </span><span class="lineNoCov">          0 :         this_mv.as_mv.col = bc + next_chkpts[k][i].col;</span>
<span class="lineNum">     947 </span><span class="lineNoCov">          0 :         this_offset = base_offset + (this_mv.as_mv.row * (in_what_stride)) +</span>
<span class="lineNum">     948 </span><span class="lineNoCov">          0 :                       this_mv.as_mv.col;</span>
<span class="lineNum">     949 </span><span class="lineNoCov">          0 :         thissad = vfp-&gt;sdf(what, what_stride, this_offset, in_what_stride);</span>
<span class="lineNum">     950 </span><span class="lineNoCov">          0 :         CHECK_BETTER</span>
<span class="lineNum">     951 </span>            :       }
<span class="lineNum">     952 </span>            :     } else {
<span class="lineNum">     953 </span><span class="lineNoCov">          0 :       for (i = 0; i &lt; 3; ++i) {</span>
<span class="lineNum">     954 </span><span class="lineNoCov">          0 :         this_mv.as_mv.row = br + next_chkpts[k][i].row;</span>
<span class="lineNum">     955 </span><span class="lineNoCov">          0 :         this_mv.as_mv.col = bc + next_chkpts[k][i].col;</span>
<span class="lineNum">     956 </span><span class="lineNoCov">          0 :         CHECK_POINT</span>
<span class="lineNum">     957 </span><span class="lineNoCov">          0 :         this_offset = base_offset + (this_mv.as_mv.row * (in_what_stride)) +</span>
<span class="lineNum">     958 </span><span class="lineNoCov">          0 :                       this_mv.as_mv.col;</span>
<span class="lineNum">     959 </span><span class="lineNoCov">          0 :         thissad = vfp-&gt;sdf(what, what_stride, this_offset, in_what_stride);</span>
<span class="lineNum">     960 </span><span class="lineNoCov">          0 :         CHECK_BETTER</span>
<span class="lineNum">     961 </span>            :       }
<span class="lineNum">     962 </span>            :     }
<span class="lineNum">     963 </span>            : 
<span class="lineNum">     964 </span><span class="lineNoCov">          0 :     if (best_site == -1) {</span>
<span class="lineNum">     965 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     966 </span>            :     } else {
<span class="lineNum">     967 </span><span class="lineNoCov">          0 :       br += next_chkpts[k][best_site].row;</span>
<span class="lineNum">     968 </span><span class="lineNoCov">          0 :       bc += next_chkpts[k][best_site].col;</span>
<span class="lineNum">     969 </span><span class="lineNoCov">          0 :       k += 5 + best_site;</span>
<span class="lineNum">     970 </span><span class="lineNoCov">          0 :       if (k &gt;= 12) {</span>
<span class="lineNum">     971 </span><span class="lineNoCov">          0 :         k -= 12;</span>
<span class="lineNum">     972 </span><span class="lineNoCov">          0 :       } else if (k &gt;= 6) {</span>
<span class="lineNum">     973 </span><span class="lineNoCov">          0 :         k -= 6;</span>
<span class="lineNum">     974 </span>            :       }
<span class="lineNum">     975 </span>            :     }
<span class="lineNum">     976 </span>            :   }
<span class="lineNum">     977 </span>            : 
<span class="lineNum">     978 </span>            : /* check 4 1-away neighbors */
<span class="lineNum">     979 </span>            : cal_neighbors:
<span class="lineNum">     980 </span><span class="lineNoCov">          0 :   for (j = 0; j &lt; dia_range; ++j) {</span>
<span class="lineNum">     981 </span><span class="lineNoCov">          0 :     best_site = -1;</span>
<span class="lineNum">     982 </span><span class="lineNoCov">          0 :     CHECK_BOUNDS(1)</span>
<span class="lineNum">     983 </span>            : 
<span class="lineNum">     984 </span><span class="lineNoCov">          0 :     if (all_in) {</span>
<span class="lineNum">     985 </span><span class="lineNoCov">          0 :       for (i = 0; i &lt; 4; ++i) {</span>
<span class="lineNum">     986 </span><span class="lineNoCov">          0 :         this_mv.as_mv.row = br + neighbors[i].row;</span>
<span class="lineNum">     987 </span><span class="lineNoCov">          0 :         this_mv.as_mv.col = bc + neighbors[i].col;</span>
<span class="lineNum">     988 </span><span class="lineNoCov">          0 :         this_offset = base_offset + (this_mv.as_mv.row * (in_what_stride)) +</span>
<span class="lineNum">     989 </span><span class="lineNoCov">          0 :                       this_mv.as_mv.col;</span>
<span class="lineNum">     990 </span><span class="lineNoCov">          0 :         thissad = vfp-&gt;sdf(what, what_stride, this_offset, in_what_stride);</span>
<span class="lineNum">     991 </span><span class="lineNoCov">          0 :         CHECK_BETTER</span>
<span class="lineNum">     992 </span>            :       }
<span class="lineNum">     993 </span>            :     } else {
<span class="lineNum">     994 </span><span class="lineNoCov">          0 :       for (i = 0; i &lt; 4; ++i) {</span>
<span class="lineNum">     995 </span><span class="lineNoCov">          0 :         this_mv.as_mv.row = br + neighbors[i].row;</span>
<span class="lineNum">     996 </span><span class="lineNoCov">          0 :         this_mv.as_mv.col = bc + neighbors[i].col;</span>
<span class="lineNum">     997 </span><span class="lineNoCov">          0 :         CHECK_POINT</span>
<span class="lineNum">     998 </span><span class="lineNoCov">          0 :         this_offset = base_offset + (this_mv.as_mv.row * (in_what_stride)) +</span>
<span class="lineNum">     999 </span><span class="lineNoCov">          0 :                       this_mv.as_mv.col;</span>
<span class="lineNum">    1000 </span><span class="lineNoCov">          0 :         thissad = vfp-&gt;sdf(what, what_stride, this_offset, in_what_stride);</span>
<span class="lineNum">    1001 </span><span class="lineNoCov">          0 :         CHECK_BETTER</span>
<span class="lineNum">    1002 </span>            :       }
<span class="lineNum">    1003 </span>            :     }
<span class="lineNum">    1004 </span>            : 
<span class="lineNum">    1005 </span><span class="lineNoCov">          0 :     if (best_site == -1) {</span>
<span class="lineNum">    1006 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    1007 </span>            :     } else {
<span class="lineNum">    1008 </span><span class="lineNoCov">          0 :       br += neighbors[best_site].row;</span>
<span class="lineNum">    1009 </span><span class="lineNoCov">          0 :       bc += neighbors[best_site].col;</span>
<span class="lineNum">    1010 </span>            :     }
<span class="lineNum">    1011 </span>            :   }
<span class="lineNum">    1012 </span>            : 
<span class="lineNum">    1013 </span><span class="lineNoCov">          0 :   best_mv-&gt;as_mv.row = br;</span>
<span class="lineNum">    1014 </span><span class="lineNoCov">          0 :   best_mv-&gt;as_mv.col = bc;</span>
<span class="lineNum">    1015 </span>            : 
<span class="lineNum">    1016 </span><span class="lineNoCov">          0 :   return bestsad;</span>
<span class="lineNum">    1017 </span>            : }
<span class="lineNum">    1018 </span>            : #undef CHECK_BOUNDS
<span class="lineNum">    1019 </span>            : #undef CHECK_POINT
<a name="1020"><span class="lineNum">    1020 </span>            : #undef CHECK_BETTER</a>
<span class="lineNum">    1021 </span>            : 
<span class="lineNum">    1022 </span><span class="lineNoCov">          0 : int vp8_diamond_search_sad_c(MACROBLOCK *x, BLOCK *b, BLOCKD *d, int_mv *ref_mv,</span>
<span class="lineNum">    1023 </span>            :                              int_mv *best_mv, int search_param, int sad_per_bit,
<span class="lineNum">    1024 </span>            :                              int *num00, vp8_variance_fn_ptr_t *fn_ptr,
<span class="lineNum">    1025 </span>            :                              int *mvcost[2], int_mv *center_mv) {
<span class="lineNum">    1026 </span>            :   int i, j, step;
<span class="lineNum">    1027 </span>            : 
<span class="lineNum">    1028 </span><span class="lineNoCov">          0 :   unsigned char *what = (*(b-&gt;base_src) + b-&gt;src);</span>
<span class="lineNum">    1029 </span><span class="lineNoCov">          0 :   int what_stride = b-&gt;src_stride;</span>
<span class="lineNum">    1030 </span>            :   unsigned char *in_what;
<span class="lineNum">    1031 </span><span class="lineNoCov">          0 :   int pre_stride = x-&gt;e_mbd.pre.y_stride;</span>
<span class="lineNum">    1032 </span><span class="lineNoCov">          0 :   unsigned char *base_pre = x-&gt;e_mbd.pre.y_buffer;</span>
<span class="lineNum">    1033 </span><span class="lineNoCov">          0 :   int in_what_stride = pre_stride;</span>
<span class="lineNum">    1034 </span>            :   unsigned char *best_address;
<span class="lineNum">    1035 </span>            : 
<span class="lineNum">    1036 </span>            :   int tot_steps;
<span class="lineNum">    1037 </span>            :   int_mv this_mv;
<span class="lineNum">    1038 </span>            : 
<span class="lineNum">    1039 </span>            :   unsigned int bestsad;
<span class="lineNum">    1040 </span>            :   unsigned int thissad;
<span class="lineNum">    1041 </span><span class="lineNoCov">          0 :   int best_site = 0;</span>
<span class="lineNum">    1042 </span><span class="lineNoCov">          0 :   int last_site = 0;</span>
<span class="lineNum">    1043 </span>            : 
<span class="lineNum">    1044 </span>            :   int ref_row;
<span class="lineNum">    1045 </span>            :   int ref_col;
<span class="lineNum">    1046 </span>            :   int this_row_offset;
<span class="lineNum">    1047 </span>            :   int this_col_offset;
<span class="lineNum">    1048 </span>            :   search_site *ss;
<span class="lineNum">    1049 </span>            : 
<span class="lineNum">    1050 </span>            :   unsigned char *check_here;
<span class="lineNum">    1051 </span>            : 
<span class="lineNum">    1052 </span>            :   int *mvsadcost[2];
<span class="lineNum">    1053 </span>            :   int_mv fcenter_mv;
<span class="lineNum">    1054 </span>            : 
<span class="lineNum">    1055 </span><span class="lineNoCov">          0 :   mvsadcost[0] = x-&gt;mvsadcost[0];</span>
<span class="lineNum">    1056 </span><span class="lineNoCov">          0 :   mvsadcost[1] = x-&gt;mvsadcost[1];</span>
<span class="lineNum">    1057 </span><span class="lineNoCov">          0 :   fcenter_mv.as_mv.row = center_mv-&gt;as_mv.row &gt;&gt; 3;</span>
<span class="lineNum">    1058 </span><span class="lineNoCov">          0 :   fcenter_mv.as_mv.col = center_mv-&gt;as_mv.col &gt;&gt; 3;</span>
<span class="lineNum">    1059 </span>            : 
<span class="lineNum">    1060 </span><span class="lineNoCov">          0 :   vp8_clamp_mv(ref_mv, x-&gt;mv_col_min, x-&gt;mv_col_max, x-&gt;mv_row_min,</span>
<span class="lineNum">    1061 </span>            :                x-&gt;mv_row_max);
<span class="lineNum">    1062 </span><span class="lineNoCov">          0 :   ref_row = ref_mv-&gt;as_mv.row;</span>
<span class="lineNum">    1063 </span><span class="lineNoCov">          0 :   ref_col = ref_mv-&gt;as_mv.col;</span>
<span class="lineNum">    1064 </span><span class="lineNoCov">          0 :   *num00 = 0;</span>
<span class="lineNum">    1065 </span><span class="lineNoCov">          0 :   best_mv-&gt;as_mv.row = ref_row;</span>
<span class="lineNum">    1066 </span><span class="lineNoCov">          0 :   best_mv-&gt;as_mv.col = ref_col;</span>
<span class="lineNum">    1067 </span>            : 
<span class="lineNum">    1068 </span>            :   /* Work out the start point for the search */
<span class="lineNum">    1069 </span><span class="lineNoCov">          0 :   in_what = (unsigned char *)(base_pre + d-&gt;offset + (ref_row * pre_stride) +</span>
<span class="lineNum">    1070 </span>            :                               ref_col);
<span class="lineNum">    1071 </span><span class="lineNoCov">          0 :   best_address = in_what;</span>
<span class="lineNum">    1072 </span>            : 
<span class="lineNum">    1073 </span>            :   /* Check the starting position */
<span class="lineNum">    1074 </span><span class="lineNoCov">          0 :   bestsad = fn_ptr-&gt;sdf(what, what_stride, in_what, in_what_stride) +</span>
<span class="lineNum">    1075 </span><span class="lineNoCov">          0 :             mvsad_err_cost(best_mv, &amp;fcenter_mv, mvsadcost, sad_per_bit);</span>
<span class="lineNum">    1076 </span>            : 
<span class="lineNum">    1077 </span>            :   /* search_param determines the length of the initial step and hence
<span class="lineNum">    1078 </span>            :    * the number of iterations 0 = initial step (MAX_FIRST_STEP) pel :
<span class="lineNum">    1079 </span>            :    * 1 = (MAX_FIRST_STEP/2) pel, 2 = (MAX_FIRST_STEP/4) pel... etc.
<span class="lineNum">    1080 </span>            :    */
<span class="lineNum">    1081 </span><span class="lineNoCov">          0 :   ss = &amp;x-&gt;ss[search_param * x-&gt;searches_per_step];</span>
<span class="lineNum">    1082 </span><span class="lineNoCov">          0 :   tot_steps = (x-&gt;ss_count / x-&gt;searches_per_step) - search_param;</span>
<span class="lineNum">    1083 </span>            : 
<span class="lineNum">    1084 </span><span class="lineNoCov">          0 :   i = 1;</span>
<span class="lineNum">    1085 </span>            : 
<span class="lineNum">    1086 </span><span class="lineNoCov">          0 :   for (step = 0; step &lt; tot_steps; ++step) {</span>
<span class="lineNum">    1087 </span><span class="lineNoCov">          0 :     for (j = 0; j &lt; x-&gt;searches_per_step; ++j) {</span>
<span class="lineNum">    1088 </span>            :       /* Trap illegal vectors */
<span class="lineNum">    1089 </span><span class="lineNoCov">          0 :       this_row_offset = best_mv-&gt;as_mv.row + ss[i].mv.row;</span>
<span class="lineNum">    1090 </span><span class="lineNoCov">          0 :       this_col_offset = best_mv-&gt;as_mv.col + ss[i].mv.col;</span>
<span class="lineNum">    1091 </span>            : 
<span class="lineNum">    1092 </span><span class="lineNoCov">          0 :       if ((this_col_offset &gt; x-&gt;mv_col_min) &amp;&amp;</span>
<span class="lineNum">    1093 </span><span class="lineNoCov">          0 :           (this_col_offset &lt; x-&gt;mv_col_max) &amp;&amp;</span>
<span class="lineNum">    1094 </span><span class="lineNoCov">          0 :           (this_row_offset &gt; x-&gt;mv_row_min) &amp;&amp;</span>
<span class="lineNum">    1095 </span><span class="lineNoCov">          0 :           (this_row_offset &lt; x-&gt;mv_row_max))</span>
<span class="lineNum">    1096 </span>            : 
<span class="lineNum">    1097 </span>            :       {
<span class="lineNum">    1098 </span><span class="lineNoCov">          0 :         check_here = ss[i].offset + best_address;</span>
<span class="lineNum">    1099 </span><span class="lineNoCov">          0 :         thissad = fn_ptr-&gt;sdf(what, what_stride, check_here, in_what_stride);</span>
<span class="lineNum">    1100 </span>            : 
<span class="lineNum">    1101 </span><span class="lineNoCov">          0 :         if (thissad &lt; bestsad) {</span>
<span class="lineNum">    1102 </span><span class="lineNoCov">          0 :           this_mv.as_mv.row = this_row_offset;</span>
<span class="lineNum">    1103 </span><span class="lineNoCov">          0 :           this_mv.as_mv.col = this_col_offset;</span>
<span class="lineNum">    1104 </span><span class="lineNoCov">          0 :           thissad +=</span>
<span class="lineNum">    1105 </span><span class="lineNoCov">          0 :               mvsad_err_cost(&amp;this_mv, &amp;fcenter_mv, mvsadcost, sad_per_bit);</span>
<span class="lineNum">    1106 </span>            : 
<span class="lineNum">    1107 </span><span class="lineNoCov">          0 :           if (thissad &lt; bestsad) {</span>
<span class="lineNum">    1108 </span><span class="lineNoCov">          0 :             bestsad = thissad;</span>
<span class="lineNum">    1109 </span><span class="lineNoCov">          0 :             best_site = i;</span>
<span class="lineNum">    1110 </span>            :           }
<span class="lineNum">    1111 </span>            :         }
<span class="lineNum">    1112 </span>            :       }
<span class="lineNum">    1113 </span>            : 
<span class="lineNum">    1114 </span><span class="lineNoCov">          0 :       i++;</span>
<span class="lineNum">    1115 </span>            :     }
<span class="lineNum">    1116 </span>            : 
<span class="lineNum">    1117 </span><span class="lineNoCov">          0 :     if (best_site != last_site) {</span>
<span class="lineNum">    1118 </span><span class="lineNoCov">          0 :       best_mv-&gt;as_mv.row += ss[best_site].mv.row;</span>
<span class="lineNum">    1119 </span><span class="lineNoCov">          0 :       best_mv-&gt;as_mv.col += ss[best_site].mv.col;</span>
<span class="lineNum">    1120 </span><span class="lineNoCov">          0 :       best_address += ss[best_site].offset;</span>
<span class="lineNum">    1121 </span><span class="lineNoCov">          0 :       last_site = best_site;</span>
<span class="lineNum">    1122 </span><span class="lineNoCov">          0 :     } else if (best_address == in_what) {</span>
<span class="lineNum">    1123 </span><span class="lineNoCov">          0 :       (*num00)++;</span>
<span class="lineNum">    1124 </span>            :     }
<span class="lineNum">    1125 </span>            :   }
<span class="lineNum">    1126 </span>            : 
<span class="lineNum">    1127 </span><span class="lineNoCov">          0 :   this_mv.as_mv.row = best_mv-&gt;as_mv.row &lt;&lt; 3;</span>
<span class="lineNum">    1128 </span><span class="lineNoCov">          0 :   this_mv.as_mv.col = best_mv-&gt;as_mv.col &lt;&lt; 3;</span>
<span class="lineNum">    1129 </span>            : 
<span class="lineNum">    1130 </span><span class="lineNoCov">          0 :   return fn_ptr-&gt;vf(what, what_stride, best_address, in_what_stride, &amp;thissad) +</span>
<span class="lineNum">    1131 </span><span class="lineNoCov">          0 :          mv_err_cost(&amp;this_mv, center_mv, mvcost, x-&gt;errorperbit);</span>
<a name="1132"><span class="lineNum">    1132 </span>            : }</a>
<span class="lineNum">    1133 </span>            : 
<span class="lineNum">    1134 </span><span class="lineNoCov">          0 : int vp8_diamond_search_sadx4(MACROBLOCK *x, BLOCK *b, BLOCKD *d, int_mv *ref_mv,</span>
<span class="lineNum">    1135 </span>            :                              int_mv *best_mv, int search_param, int sad_per_bit,
<span class="lineNum">    1136 </span>            :                              int *num00, vp8_variance_fn_ptr_t *fn_ptr,
<span class="lineNum">    1137 </span>            :                              int *mvcost[2], int_mv *center_mv) {
<span class="lineNum">    1138 </span>            :   int i, j, step;
<span class="lineNum">    1139 </span>            : 
<span class="lineNum">    1140 </span><span class="lineNoCov">          0 :   unsigned char *what = (*(b-&gt;base_src) + b-&gt;src);</span>
<span class="lineNum">    1141 </span><span class="lineNoCov">          0 :   int what_stride = b-&gt;src_stride;</span>
<span class="lineNum">    1142 </span>            :   unsigned char *in_what;
<span class="lineNum">    1143 </span><span class="lineNoCov">          0 :   int pre_stride = x-&gt;e_mbd.pre.y_stride;</span>
<span class="lineNum">    1144 </span><span class="lineNoCov">          0 :   unsigned char *base_pre = x-&gt;e_mbd.pre.y_buffer;</span>
<span class="lineNum">    1145 </span><span class="lineNoCov">          0 :   int in_what_stride = pre_stride;</span>
<span class="lineNum">    1146 </span>            :   unsigned char *best_address;
<span class="lineNum">    1147 </span>            : 
<span class="lineNum">    1148 </span>            :   int tot_steps;
<span class="lineNum">    1149 </span>            :   int_mv this_mv;
<span class="lineNum">    1150 </span>            : 
<span class="lineNum">    1151 </span>            :   unsigned int bestsad;
<span class="lineNum">    1152 </span>            :   unsigned int thissad;
<span class="lineNum">    1153 </span><span class="lineNoCov">          0 :   int best_site = 0;</span>
<span class="lineNum">    1154 </span><span class="lineNoCov">          0 :   int last_site = 0;</span>
<span class="lineNum">    1155 </span>            : 
<span class="lineNum">    1156 </span>            :   int ref_row;
<span class="lineNum">    1157 </span>            :   int ref_col;
<span class="lineNum">    1158 </span>            :   int this_row_offset;
<span class="lineNum">    1159 </span>            :   int this_col_offset;
<span class="lineNum">    1160 </span>            :   search_site *ss;
<span class="lineNum">    1161 </span>            : 
<span class="lineNum">    1162 </span>            :   unsigned char *check_here;
<span class="lineNum">    1163 </span>            : 
<span class="lineNum">    1164 </span>            :   int *mvsadcost[2];
<span class="lineNum">    1165 </span>            :   int_mv fcenter_mv;
<span class="lineNum">    1166 </span>            : 
<span class="lineNum">    1167 </span><span class="lineNoCov">          0 :   mvsadcost[0] = x-&gt;mvsadcost[0];</span>
<span class="lineNum">    1168 </span><span class="lineNoCov">          0 :   mvsadcost[1] = x-&gt;mvsadcost[1];</span>
<span class="lineNum">    1169 </span><span class="lineNoCov">          0 :   fcenter_mv.as_mv.row = center_mv-&gt;as_mv.row &gt;&gt; 3;</span>
<span class="lineNum">    1170 </span><span class="lineNoCov">          0 :   fcenter_mv.as_mv.col = center_mv-&gt;as_mv.col &gt;&gt; 3;</span>
<span class="lineNum">    1171 </span>            : 
<span class="lineNum">    1172 </span><span class="lineNoCov">          0 :   vp8_clamp_mv(ref_mv, x-&gt;mv_col_min, x-&gt;mv_col_max, x-&gt;mv_row_min,</span>
<span class="lineNum">    1173 </span>            :                x-&gt;mv_row_max);
<span class="lineNum">    1174 </span><span class="lineNoCov">          0 :   ref_row = ref_mv-&gt;as_mv.row;</span>
<span class="lineNum">    1175 </span><span class="lineNoCov">          0 :   ref_col = ref_mv-&gt;as_mv.col;</span>
<span class="lineNum">    1176 </span><span class="lineNoCov">          0 :   *num00 = 0;</span>
<span class="lineNum">    1177 </span><span class="lineNoCov">          0 :   best_mv-&gt;as_mv.row = ref_row;</span>
<span class="lineNum">    1178 </span><span class="lineNoCov">          0 :   best_mv-&gt;as_mv.col = ref_col;</span>
<span class="lineNum">    1179 </span>            : 
<span class="lineNum">    1180 </span>            :   /* Work out the start point for the search */
<span class="lineNum">    1181 </span><span class="lineNoCov">          0 :   in_what = (unsigned char *)(base_pre + d-&gt;offset + (ref_row * pre_stride) +</span>
<span class="lineNum">    1182 </span>            :                               ref_col);
<span class="lineNum">    1183 </span><span class="lineNoCov">          0 :   best_address = in_what;</span>
<span class="lineNum">    1184 </span>            : 
<span class="lineNum">    1185 </span>            :   /* Check the starting position */
<span class="lineNum">    1186 </span><span class="lineNoCov">          0 :   bestsad = fn_ptr-&gt;sdf(what, what_stride, in_what, in_what_stride) +</span>
<span class="lineNum">    1187 </span><span class="lineNoCov">          0 :             mvsad_err_cost(best_mv, &amp;fcenter_mv, mvsadcost, sad_per_bit);</span>
<span class="lineNum">    1188 </span>            : 
<span class="lineNum">    1189 </span>            :   /* search_param determines the length of the initial step and hence the
<span class="lineNum">    1190 </span>            :    * number of iterations 0 = initial step (MAX_FIRST_STEP) pel : 1 =
<span class="lineNum">    1191 </span>            :    * (MAX_FIRST_STEP/2) pel, 2 = (MAX_FIRST_STEP/4) pel... etc.
<span class="lineNum">    1192 </span>            :    */
<span class="lineNum">    1193 </span><span class="lineNoCov">          0 :   ss = &amp;x-&gt;ss[search_param * x-&gt;searches_per_step];</span>
<span class="lineNum">    1194 </span><span class="lineNoCov">          0 :   tot_steps = (x-&gt;ss_count / x-&gt;searches_per_step) - search_param;</span>
<span class="lineNum">    1195 </span>            : 
<span class="lineNum">    1196 </span><span class="lineNoCov">          0 :   i = 1;</span>
<span class="lineNum">    1197 </span>            : 
<span class="lineNum">    1198 </span><span class="lineNoCov">          0 :   for (step = 0; step &lt; tot_steps; ++step) {</span>
<span class="lineNum">    1199 </span><span class="lineNoCov">          0 :     int all_in = 1, t;</span>
<span class="lineNum">    1200 </span>            : 
<span class="lineNum">    1201 </span>            :     /* To know if all neighbor points are within the bounds, 4 bounds
<span class="lineNum">    1202 </span>            :      * checking are enough instead of checking 4 bounds for each
<span class="lineNum">    1203 </span>            :      * points.
<span class="lineNum">    1204 </span>            :      */
<span class="lineNum">    1205 </span><span class="lineNoCov">          0 :     all_in &amp;= ((best_mv-&gt;as_mv.row + ss[i].mv.row) &gt; x-&gt;mv_row_min);</span>
<span class="lineNum">    1206 </span><span class="lineNoCov">          0 :     all_in &amp;= ((best_mv-&gt;as_mv.row + ss[i + 1].mv.row) &lt; x-&gt;mv_row_max);</span>
<span class="lineNum">    1207 </span><span class="lineNoCov">          0 :     all_in &amp;= ((best_mv-&gt;as_mv.col + ss[i + 2].mv.col) &gt; x-&gt;mv_col_min);</span>
<span class="lineNum">    1208 </span><span class="lineNoCov">          0 :     all_in &amp;= ((best_mv-&gt;as_mv.col + ss[i + 3].mv.col) &lt; x-&gt;mv_col_max);</span>
<span class="lineNum">    1209 </span>            : 
<span class="lineNum">    1210 </span><span class="lineNoCov">          0 :     if (all_in) {</span>
<span class="lineNum">    1211 </span>            :       unsigned int sad_array[4];
<span class="lineNum">    1212 </span>            : 
<span class="lineNum">    1213 </span><span class="lineNoCov">          0 :       for (j = 0; j &lt; x-&gt;searches_per_step; j += 4) {</span>
<span class="lineNum">    1214 </span>            :         const unsigned char *block_offset[4];
<span class="lineNum">    1215 </span>            : 
<span class="lineNum">    1216 </span><span class="lineNoCov">          0 :         for (t = 0; t &lt; 4; ++t) {</span>
<span class="lineNum">    1217 </span><span class="lineNoCov">          0 :           block_offset[t] = ss[i + t].offset + best_address;</span>
<span class="lineNum">    1218 </span>            :         }
<span class="lineNum">    1219 </span>            : 
<span class="lineNum">    1220 </span><span class="lineNoCov">          0 :         fn_ptr-&gt;sdx4df(what, what_stride, block_offset, in_what_stride,</span>
<span class="lineNum">    1221 </span>            :                        sad_array);
<span class="lineNum">    1222 </span>            : 
<span class="lineNum">    1223 </span><span class="lineNoCov">          0 :         for (t = 0; t &lt; 4; t++, i++) {</span>
<span class="lineNum">    1224 </span><span class="lineNoCov">          0 :           if (sad_array[t] &lt; bestsad) {</span>
<span class="lineNum">    1225 </span><span class="lineNoCov">          0 :             this_mv.as_mv.row = best_mv-&gt;as_mv.row + ss[i].mv.row;</span>
<span class="lineNum">    1226 </span><span class="lineNoCov">          0 :             this_mv.as_mv.col = best_mv-&gt;as_mv.col + ss[i].mv.col;</span>
<span class="lineNum">    1227 </span><span class="lineNoCov">          0 :             sad_array[t] +=</span>
<span class="lineNum">    1228 </span><span class="lineNoCov">          0 :                 mvsad_err_cost(&amp;this_mv, &amp;fcenter_mv, mvsadcost, sad_per_bit);</span>
<span class="lineNum">    1229 </span>            : 
<span class="lineNum">    1230 </span><span class="lineNoCov">          0 :             if (sad_array[t] &lt; bestsad) {</span>
<span class="lineNum">    1231 </span><span class="lineNoCov">          0 :               bestsad = sad_array[t];</span>
<span class="lineNum">    1232 </span><span class="lineNoCov">          0 :               best_site = i;</span>
<span class="lineNum">    1233 </span>            :             }
<span class="lineNum">    1234 </span>            :           }
<span class="lineNum">    1235 </span>            :         }
<span class="lineNum">    1236 </span>            :       }
<span class="lineNum">    1237 </span>            :     } else {
<span class="lineNum">    1238 </span><span class="lineNoCov">          0 :       for (j = 0; j &lt; x-&gt;searches_per_step; ++j) {</span>
<span class="lineNum">    1239 </span>            :         /* Trap illegal vectors */
<span class="lineNum">    1240 </span><span class="lineNoCov">          0 :         this_row_offset = best_mv-&gt;as_mv.row + ss[i].mv.row;</span>
<span class="lineNum">    1241 </span><span class="lineNoCov">          0 :         this_col_offset = best_mv-&gt;as_mv.col + ss[i].mv.col;</span>
<span class="lineNum">    1242 </span>            : 
<span class="lineNum">    1243 </span><span class="lineNoCov">          0 :         if ((this_col_offset &gt; x-&gt;mv_col_min) &amp;&amp;</span>
<span class="lineNum">    1244 </span><span class="lineNoCov">          0 :             (this_col_offset &lt; x-&gt;mv_col_max) &amp;&amp;</span>
<span class="lineNum">    1245 </span><span class="lineNoCov">          0 :             (this_row_offset &gt; x-&gt;mv_row_min) &amp;&amp;</span>
<span class="lineNum">    1246 </span><span class="lineNoCov">          0 :             (this_row_offset &lt; x-&gt;mv_row_max)) {</span>
<span class="lineNum">    1247 </span><span class="lineNoCov">          0 :           check_here = ss[i].offset + best_address;</span>
<span class="lineNum">    1248 </span><span class="lineNoCov">          0 :           thissad = fn_ptr-&gt;sdf(what, what_stride, check_here, in_what_stride);</span>
<span class="lineNum">    1249 </span>            : 
<span class="lineNum">    1250 </span><span class="lineNoCov">          0 :           if (thissad &lt; bestsad) {</span>
<span class="lineNum">    1251 </span><span class="lineNoCov">          0 :             this_mv.as_mv.row = this_row_offset;</span>
<span class="lineNum">    1252 </span><span class="lineNoCov">          0 :             this_mv.as_mv.col = this_col_offset;</span>
<span class="lineNum">    1253 </span><span class="lineNoCov">          0 :             thissad +=</span>
<span class="lineNum">    1254 </span><span class="lineNoCov">          0 :                 mvsad_err_cost(&amp;this_mv, &amp;fcenter_mv, mvsadcost, sad_per_bit);</span>
<span class="lineNum">    1255 </span>            : 
<span class="lineNum">    1256 </span><span class="lineNoCov">          0 :             if (thissad &lt; bestsad) {</span>
<span class="lineNum">    1257 </span><span class="lineNoCov">          0 :               bestsad = thissad;</span>
<span class="lineNum">    1258 </span><span class="lineNoCov">          0 :               best_site = i;</span>
<span class="lineNum">    1259 </span>            :             }
<span class="lineNum">    1260 </span>            :           }
<span class="lineNum">    1261 </span>            :         }
<span class="lineNum">    1262 </span><span class="lineNoCov">          0 :         i++;</span>
<span class="lineNum">    1263 </span>            :       }
<span class="lineNum">    1264 </span>            :     }
<span class="lineNum">    1265 </span>            : 
<span class="lineNum">    1266 </span><span class="lineNoCov">          0 :     if (best_site != last_site) {</span>
<span class="lineNum">    1267 </span><span class="lineNoCov">          0 :       best_mv-&gt;as_mv.row += ss[best_site].mv.row;</span>
<span class="lineNum">    1268 </span><span class="lineNoCov">          0 :       best_mv-&gt;as_mv.col += ss[best_site].mv.col;</span>
<span class="lineNum">    1269 </span><span class="lineNoCov">          0 :       best_address += ss[best_site].offset;</span>
<span class="lineNum">    1270 </span><span class="lineNoCov">          0 :       last_site = best_site;</span>
<span class="lineNum">    1271 </span><span class="lineNoCov">          0 :     } else if (best_address == in_what) {</span>
<span class="lineNum">    1272 </span><span class="lineNoCov">          0 :       (*num00)++;</span>
<span class="lineNum">    1273 </span>            :     }
<span class="lineNum">    1274 </span>            :   }
<span class="lineNum">    1275 </span>            : 
<span class="lineNum">    1276 </span><span class="lineNoCov">          0 :   this_mv.as_mv.row = best_mv-&gt;as_mv.row * 8;</span>
<span class="lineNum">    1277 </span><span class="lineNoCov">          0 :   this_mv.as_mv.col = best_mv-&gt;as_mv.col * 8;</span>
<span class="lineNum">    1278 </span>            : 
<span class="lineNum">    1279 </span><span class="lineNoCov">          0 :   return fn_ptr-&gt;vf(what, what_stride, best_address, in_what_stride, &amp;thissad) +</span>
<span class="lineNum">    1280 </span><span class="lineNoCov">          0 :          mv_err_cost(&amp;this_mv, center_mv, mvcost, x-&gt;errorperbit);</span>
<a name="1281"><span class="lineNum">    1281 </span>            : }</a>
<span class="lineNum">    1282 </span>            : 
<span class="lineNum">    1283 </span><span class="lineNoCov">          0 : int vp8_full_search_sad_c(MACROBLOCK *x, BLOCK *b, BLOCKD *d, int_mv *ref_mv,</span>
<span class="lineNum">    1284 </span>            :                           int sad_per_bit, int distance,
<span class="lineNum">    1285 </span>            :                           vp8_variance_fn_ptr_t *fn_ptr, int *mvcost[2],
<span class="lineNum">    1286 </span>            :                           int_mv *center_mv) {
<span class="lineNum">    1287 </span><span class="lineNoCov">          0 :   unsigned char *what = (*(b-&gt;base_src) + b-&gt;src);</span>
<span class="lineNum">    1288 </span><span class="lineNoCov">          0 :   int what_stride = b-&gt;src_stride;</span>
<span class="lineNum">    1289 </span>            :   unsigned char *in_what;
<span class="lineNum">    1290 </span><span class="lineNoCov">          0 :   int pre_stride = x-&gt;e_mbd.pre.y_stride;</span>
<span class="lineNum">    1291 </span><span class="lineNoCov">          0 :   unsigned char *base_pre = x-&gt;e_mbd.pre.y_buffer;</span>
<span class="lineNum">    1292 </span><span class="lineNoCov">          0 :   int in_what_stride = pre_stride;</span>
<span class="lineNum">    1293 </span><span class="lineNoCov">          0 :   int mv_stride = pre_stride;</span>
<span class="lineNum">    1294 </span>            :   unsigned char *bestaddress;
<span class="lineNum">    1295 </span><span class="lineNoCov">          0 :   int_mv *best_mv = &amp;d-&gt;bmi.mv;</span>
<span class="lineNum">    1296 </span>            :   int_mv this_mv;
<span class="lineNum">    1297 </span>            :   unsigned int bestsad;
<span class="lineNum">    1298 </span>            :   unsigned int thissad;
<span class="lineNum">    1299 </span>            :   int r, c;
<span class="lineNum">    1300 </span>            : 
<span class="lineNum">    1301 </span>            :   unsigned char *check_here;
<span class="lineNum">    1302 </span>            : 
<span class="lineNum">    1303 </span><span class="lineNoCov">          0 :   int ref_row = ref_mv-&gt;as_mv.row;</span>
<span class="lineNum">    1304 </span><span class="lineNoCov">          0 :   int ref_col = ref_mv-&gt;as_mv.col;</span>
<span class="lineNum">    1305 </span>            : 
<span class="lineNum">    1306 </span><span class="lineNoCov">          0 :   int row_min = ref_row - distance;</span>
<span class="lineNum">    1307 </span><span class="lineNoCov">          0 :   int row_max = ref_row + distance;</span>
<span class="lineNum">    1308 </span><span class="lineNoCov">          0 :   int col_min = ref_col - distance;</span>
<span class="lineNum">    1309 </span><span class="lineNoCov">          0 :   int col_max = ref_col + distance;</span>
<span class="lineNum">    1310 </span>            : 
<span class="lineNum">    1311 </span>            :   int *mvsadcost[2];
<span class="lineNum">    1312 </span>            :   int_mv fcenter_mv;
<span class="lineNum">    1313 </span>            : 
<span class="lineNum">    1314 </span><span class="lineNoCov">          0 :   mvsadcost[0] = x-&gt;mvsadcost[0];</span>
<span class="lineNum">    1315 </span><span class="lineNoCov">          0 :   mvsadcost[1] = x-&gt;mvsadcost[1];</span>
<span class="lineNum">    1316 </span><span class="lineNoCov">          0 :   fcenter_mv.as_mv.row = center_mv-&gt;as_mv.row &gt;&gt; 3;</span>
<span class="lineNum">    1317 </span><span class="lineNoCov">          0 :   fcenter_mv.as_mv.col = center_mv-&gt;as_mv.col &gt;&gt; 3;</span>
<span class="lineNum">    1318 </span>            : 
<span class="lineNum">    1319 </span>            :   /* Work out the mid point for the search */
<span class="lineNum">    1320 </span><span class="lineNoCov">          0 :   in_what = base_pre + d-&gt;offset;</span>
<span class="lineNum">    1321 </span><span class="lineNoCov">          0 :   bestaddress = in_what + (ref_row * pre_stride) + ref_col;</span>
<span class="lineNum">    1322 </span>            : 
<span class="lineNum">    1323 </span><span class="lineNoCov">          0 :   best_mv-&gt;as_mv.row = ref_row;</span>
<span class="lineNum">    1324 </span><span class="lineNoCov">          0 :   best_mv-&gt;as_mv.col = ref_col;</span>
<span class="lineNum">    1325 </span>            : 
<span class="lineNum">    1326 </span>            :   /* Baseline value at the centre */
<span class="lineNum">    1327 </span><span class="lineNoCov">          0 :   bestsad = fn_ptr-&gt;sdf(what, what_stride, bestaddress, in_what_stride) +</span>
<span class="lineNum">    1328 </span><span class="lineNoCov">          0 :             mvsad_err_cost(best_mv, &amp;fcenter_mv, mvsadcost, sad_per_bit);</span>
<span class="lineNum">    1329 </span>            : 
<span class="lineNum">    1330 </span>            :   /* Apply further limits to prevent us looking using vectors that
<span class="lineNum">    1331 </span>            :    * stretch beyiond the UMV border
<span class="lineNum">    1332 </span>            :    */
<span class="lineNum">    1333 </span><span class="lineNoCov">          0 :   if (col_min &lt; x-&gt;mv_col_min) col_min = x-&gt;mv_col_min;</span>
<span class="lineNum">    1334 </span>            : 
<span class="lineNum">    1335 </span><span class="lineNoCov">          0 :   if (col_max &gt; x-&gt;mv_col_max) col_max = x-&gt;mv_col_max;</span>
<span class="lineNum">    1336 </span>            : 
<span class="lineNum">    1337 </span><span class="lineNoCov">          0 :   if (row_min &lt; x-&gt;mv_row_min) row_min = x-&gt;mv_row_min;</span>
<span class="lineNum">    1338 </span>            : 
<span class="lineNum">    1339 </span><span class="lineNoCov">          0 :   if (row_max &gt; x-&gt;mv_row_max) row_max = x-&gt;mv_row_max;</span>
<span class="lineNum">    1340 </span>            : 
<span class="lineNum">    1341 </span><span class="lineNoCov">          0 :   for (r = row_min; r &lt; row_max; ++r) {</span>
<span class="lineNum">    1342 </span><span class="lineNoCov">          0 :     this_mv.as_mv.row = r;</span>
<span class="lineNum">    1343 </span><span class="lineNoCov">          0 :     check_here = r * mv_stride + in_what + col_min;</span>
<span class="lineNum">    1344 </span>            : 
<span class="lineNum">    1345 </span><span class="lineNoCov">          0 :     for (c = col_min; c &lt; col_max; ++c) {</span>
<span class="lineNum">    1346 </span><span class="lineNoCov">          0 :       thissad = fn_ptr-&gt;sdf(what, what_stride, check_here, in_what_stride);</span>
<span class="lineNum">    1347 </span>            : 
<span class="lineNum">    1348 </span><span class="lineNoCov">          0 :       this_mv.as_mv.col = c;</span>
<span class="lineNum">    1349 </span><span class="lineNoCov">          0 :       thissad += mvsad_err_cost(&amp;this_mv, &amp;fcenter_mv, mvsadcost, sad_per_bit);</span>
<span class="lineNum">    1350 </span>            : 
<span class="lineNum">    1351 </span><span class="lineNoCov">          0 :       if (thissad &lt; bestsad) {</span>
<span class="lineNum">    1352 </span><span class="lineNoCov">          0 :         bestsad = thissad;</span>
<span class="lineNum">    1353 </span><span class="lineNoCov">          0 :         best_mv-&gt;as_mv.row = r;</span>
<span class="lineNum">    1354 </span><span class="lineNoCov">          0 :         best_mv-&gt;as_mv.col = c;</span>
<span class="lineNum">    1355 </span><span class="lineNoCov">          0 :         bestaddress = check_here;</span>
<span class="lineNum">    1356 </span>            :       }
<span class="lineNum">    1357 </span>            : 
<span class="lineNum">    1358 </span><span class="lineNoCov">          0 :       check_here++;</span>
<span class="lineNum">    1359 </span>            :     }
<span class="lineNum">    1360 </span>            :   }
<span class="lineNum">    1361 </span>            : 
<span class="lineNum">    1362 </span><span class="lineNoCov">          0 :   this_mv.as_mv.row = best_mv-&gt;as_mv.row &lt;&lt; 3;</span>
<span class="lineNum">    1363 </span><span class="lineNoCov">          0 :   this_mv.as_mv.col = best_mv-&gt;as_mv.col &lt;&lt; 3;</span>
<span class="lineNum">    1364 </span>            : 
<span class="lineNum">    1365 </span><span class="lineNoCov">          0 :   return fn_ptr-&gt;vf(what, what_stride, bestaddress, in_what_stride, &amp;thissad) +</span>
<span class="lineNum">    1366 </span><span class="lineNoCov">          0 :          mv_err_cost(&amp;this_mv, center_mv, mvcost, x-&gt;errorperbit);</span>
<a name="1367"><span class="lineNum">    1367 </span>            : }</a>
<span class="lineNum">    1368 </span>            : 
<span class="lineNum">    1369 </span><span class="lineNoCov">          0 : int vp8_full_search_sadx3(MACROBLOCK *x, BLOCK *b, BLOCKD *d, int_mv *ref_mv,</span>
<span class="lineNum">    1370 </span>            :                           int sad_per_bit, int distance,
<span class="lineNum">    1371 </span>            :                           vp8_variance_fn_ptr_t *fn_ptr, int *mvcost[2],
<span class="lineNum">    1372 </span>            :                           int_mv *center_mv) {
<span class="lineNum">    1373 </span><span class="lineNoCov">          0 :   unsigned char *what = (*(b-&gt;base_src) + b-&gt;src);</span>
<span class="lineNum">    1374 </span><span class="lineNoCov">          0 :   int what_stride = b-&gt;src_stride;</span>
<span class="lineNum">    1375 </span>            :   unsigned char *in_what;
<span class="lineNum">    1376 </span><span class="lineNoCov">          0 :   int pre_stride = x-&gt;e_mbd.pre.y_stride;</span>
<span class="lineNum">    1377 </span><span class="lineNoCov">          0 :   unsigned char *base_pre = x-&gt;e_mbd.pre.y_buffer;</span>
<span class="lineNum">    1378 </span><span class="lineNoCov">          0 :   int in_what_stride = pre_stride;</span>
<span class="lineNum">    1379 </span><span class="lineNoCov">          0 :   int mv_stride = pre_stride;</span>
<span class="lineNum">    1380 </span>            :   unsigned char *bestaddress;
<span class="lineNum">    1381 </span><span class="lineNoCov">          0 :   int_mv *best_mv = &amp;d-&gt;bmi.mv;</span>
<span class="lineNum">    1382 </span>            :   int_mv this_mv;
<span class="lineNum">    1383 </span>            :   unsigned int bestsad;
<span class="lineNum">    1384 </span>            :   unsigned int thissad;
<span class="lineNum">    1385 </span>            :   int r, c;
<span class="lineNum">    1386 </span>            : 
<span class="lineNum">    1387 </span>            :   unsigned char *check_here;
<span class="lineNum">    1388 </span>            : 
<span class="lineNum">    1389 </span><span class="lineNoCov">          0 :   int ref_row = ref_mv-&gt;as_mv.row;</span>
<span class="lineNum">    1390 </span><span class="lineNoCov">          0 :   int ref_col = ref_mv-&gt;as_mv.col;</span>
<span class="lineNum">    1391 </span>            : 
<span class="lineNum">    1392 </span><span class="lineNoCov">          0 :   int row_min = ref_row - distance;</span>
<span class="lineNum">    1393 </span><span class="lineNoCov">          0 :   int row_max = ref_row + distance;</span>
<span class="lineNum">    1394 </span><span class="lineNoCov">          0 :   int col_min = ref_col - distance;</span>
<span class="lineNum">    1395 </span><span class="lineNoCov">          0 :   int col_max = ref_col + distance;</span>
<span class="lineNum">    1396 </span>            : 
<span class="lineNum">    1397 </span>            :   unsigned int sad_array[3];
<span class="lineNum">    1398 </span>            : 
<span class="lineNum">    1399 </span>            :   int *mvsadcost[2];
<span class="lineNum">    1400 </span>            :   int_mv fcenter_mv;
<span class="lineNum">    1401 </span>            : 
<span class="lineNum">    1402 </span><span class="lineNoCov">          0 :   mvsadcost[0] = x-&gt;mvsadcost[0];</span>
<span class="lineNum">    1403 </span><span class="lineNoCov">          0 :   mvsadcost[1] = x-&gt;mvsadcost[1];</span>
<span class="lineNum">    1404 </span><span class="lineNoCov">          0 :   fcenter_mv.as_mv.row = center_mv-&gt;as_mv.row &gt;&gt; 3;</span>
<span class="lineNum">    1405 </span><span class="lineNoCov">          0 :   fcenter_mv.as_mv.col = center_mv-&gt;as_mv.col &gt;&gt; 3;</span>
<span class="lineNum">    1406 </span>            : 
<span class="lineNum">    1407 </span>            :   /* Work out the mid point for the search */
<span class="lineNum">    1408 </span><span class="lineNoCov">          0 :   in_what = base_pre + d-&gt;offset;</span>
<span class="lineNum">    1409 </span><span class="lineNoCov">          0 :   bestaddress = in_what + (ref_row * pre_stride) + ref_col;</span>
<span class="lineNum">    1410 </span>            : 
<span class="lineNum">    1411 </span><span class="lineNoCov">          0 :   best_mv-&gt;as_mv.row = ref_row;</span>
<span class="lineNum">    1412 </span><span class="lineNoCov">          0 :   best_mv-&gt;as_mv.col = ref_col;</span>
<span class="lineNum">    1413 </span>            : 
<span class="lineNum">    1414 </span>            :   /* Baseline value at the centre */
<span class="lineNum">    1415 </span><span class="lineNoCov">          0 :   bestsad = fn_ptr-&gt;sdf(what, what_stride, bestaddress, in_what_stride) +</span>
<span class="lineNum">    1416 </span><span class="lineNoCov">          0 :             mvsad_err_cost(best_mv, &amp;fcenter_mv, mvsadcost, sad_per_bit);</span>
<span class="lineNum">    1417 </span>            : 
<span class="lineNum">    1418 </span>            :   /* Apply further limits to prevent us looking using vectors that stretch
<span class="lineNum">    1419 </span>            :    * beyond the UMV border
<span class="lineNum">    1420 </span>            :    */
<span class="lineNum">    1421 </span><span class="lineNoCov">          0 :   if (col_min &lt; x-&gt;mv_col_min) col_min = x-&gt;mv_col_min;</span>
<span class="lineNum">    1422 </span>            : 
<span class="lineNum">    1423 </span><span class="lineNoCov">          0 :   if (col_max &gt; x-&gt;mv_col_max) col_max = x-&gt;mv_col_max;</span>
<span class="lineNum">    1424 </span>            : 
<span class="lineNum">    1425 </span><span class="lineNoCov">          0 :   if (row_min &lt; x-&gt;mv_row_min) row_min = x-&gt;mv_row_min;</span>
<span class="lineNum">    1426 </span>            : 
<span class="lineNum">    1427 </span><span class="lineNoCov">          0 :   if (row_max &gt; x-&gt;mv_row_max) row_max = x-&gt;mv_row_max;</span>
<span class="lineNum">    1428 </span>            : 
<span class="lineNum">    1429 </span><span class="lineNoCov">          0 :   for (r = row_min; r &lt; row_max; ++r) {</span>
<span class="lineNum">    1430 </span><span class="lineNoCov">          0 :     this_mv.as_mv.row = r;</span>
<span class="lineNum">    1431 </span><span class="lineNoCov">          0 :     check_here = r * mv_stride + in_what + col_min;</span>
<span class="lineNum">    1432 </span><span class="lineNoCov">          0 :     c = col_min;</span>
<span class="lineNum">    1433 </span>            : 
<span class="lineNum">    1434 </span><span class="lineNoCov">          0 :     while ((c + 2) &lt; col_max) {</span>
<span class="lineNum">    1435 </span>            :       int i;
<span class="lineNum">    1436 </span>            : 
<span class="lineNum">    1437 </span><span class="lineNoCov">          0 :       fn_ptr-&gt;sdx3f(what, what_stride, check_here, in_what_stride, sad_array);</span>
<span class="lineNum">    1438 </span>            : 
<span class="lineNum">    1439 </span><span class="lineNoCov">          0 :       for (i = 0; i &lt; 3; ++i) {</span>
<span class="lineNum">    1440 </span><span class="lineNoCov">          0 :         thissad = sad_array[i];</span>
<span class="lineNum">    1441 </span>            : 
<span class="lineNum">    1442 </span><span class="lineNoCov">          0 :         if (thissad &lt; bestsad) {</span>
<span class="lineNum">    1443 </span><span class="lineNoCov">          0 :           this_mv.as_mv.col = c;</span>
<span class="lineNum">    1444 </span><span class="lineNoCov">          0 :           thissad +=</span>
<span class="lineNum">    1445 </span><span class="lineNoCov">          0 :               mvsad_err_cost(&amp;this_mv, &amp;fcenter_mv, mvsadcost, sad_per_bit);</span>
<span class="lineNum">    1446 </span>            : 
<span class="lineNum">    1447 </span><span class="lineNoCov">          0 :           if (thissad &lt; bestsad) {</span>
<span class="lineNum">    1448 </span><span class="lineNoCov">          0 :             bestsad = thissad;</span>
<span class="lineNum">    1449 </span><span class="lineNoCov">          0 :             best_mv-&gt;as_mv.row = r;</span>
<span class="lineNum">    1450 </span><span class="lineNoCov">          0 :             best_mv-&gt;as_mv.col = c;</span>
<span class="lineNum">    1451 </span><span class="lineNoCov">          0 :             bestaddress = check_here;</span>
<span class="lineNum">    1452 </span>            :           }
<span class="lineNum">    1453 </span>            :         }
<span class="lineNum">    1454 </span>            : 
<span class="lineNum">    1455 </span><span class="lineNoCov">          0 :         check_here++;</span>
<span class="lineNum">    1456 </span><span class="lineNoCov">          0 :         c++;</span>
<span class="lineNum">    1457 </span>            :       }
<span class="lineNum">    1458 </span>            :     }
<span class="lineNum">    1459 </span>            : 
<span class="lineNum">    1460 </span><span class="lineNoCov">          0 :     while (c &lt; col_max) {</span>
<span class="lineNum">    1461 </span><span class="lineNoCov">          0 :       thissad = fn_ptr-&gt;sdf(what, what_stride, check_here, in_what_stride);</span>
<span class="lineNum">    1462 </span>            : 
<span class="lineNum">    1463 </span><span class="lineNoCov">          0 :       if (thissad &lt; bestsad) {</span>
<span class="lineNum">    1464 </span><span class="lineNoCov">          0 :         this_mv.as_mv.col = c;</span>
<span class="lineNum">    1465 </span><span class="lineNoCov">          0 :         thissad +=</span>
<span class="lineNum">    1466 </span><span class="lineNoCov">          0 :             mvsad_err_cost(&amp;this_mv, &amp;fcenter_mv, mvsadcost, sad_per_bit);</span>
<span class="lineNum">    1467 </span>            : 
<span class="lineNum">    1468 </span><span class="lineNoCov">          0 :         if (thissad &lt; bestsad) {</span>
<span class="lineNum">    1469 </span><span class="lineNoCov">          0 :           bestsad = thissad;</span>
<span class="lineNum">    1470 </span><span class="lineNoCov">          0 :           best_mv-&gt;as_mv.row = r;</span>
<span class="lineNum">    1471 </span><span class="lineNoCov">          0 :           best_mv-&gt;as_mv.col = c;</span>
<span class="lineNum">    1472 </span><span class="lineNoCov">          0 :           bestaddress = check_here;</span>
<span class="lineNum">    1473 </span>            :         }
<span class="lineNum">    1474 </span>            :       }
<span class="lineNum">    1475 </span>            : 
<span class="lineNum">    1476 </span><span class="lineNoCov">          0 :       check_here++;</span>
<span class="lineNum">    1477 </span><span class="lineNoCov">          0 :       c++;</span>
<span class="lineNum">    1478 </span>            :     }
<span class="lineNum">    1479 </span>            :   }
<span class="lineNum">    1480 </span>            : 
<span class="lineNum">    1481 </span><span class="lineNoCov">          0 :   this_mv.as_mv.row = best_mv-&gt;as_mv.row &lt;&lt; 3;</span>
<span class="lineNum">    1482 </span><span class="lineNoCov">          0 :   this_mv.as_mv.col = best_mv-&gt;as_mv.col &lt;&lt; 3;</span>
<span class="lineNum">    1483 </span>            : 
<span class="lineNum">    1484 </span><span class="lineNoCov">          0 :   return fn_ptr-&gt;vf(what, what_stride, bestaddress, in_what_stride, &amp;thissad) +</span>
<span class="lineNum">    1485 </span><span class="lineNoCov">          0 :          mv_err_cost(&amp;this_mv, center_mv, mvcost, x-&gt;errorperbit);</span>
<a name="1486"><span class="lineNum">    1486 </span>            : }</a>
<span class="lineNum">    1487 </span>            : 
<span class="lineNum">    1488 </span><span class="lineNoCov">          0 : int vp8_full_search_sadx8(MACROBLOCK *x, BLOCK *b, BLOCKD *d, int_mv *ref_mv,</span>
<span class="lineNum">    1489 </span>            :                           int sad_per_bit, int distance,
<span class="lineNum">    1490 </span>            :                           vp8_variance_fn_ptr_t *fn_ptr, int *mvcost[2],
<span class="lineNum">    1491 </span>            :                           int_mv *center_mv) {
<span class="lineNum">    1492 </span><span class="lineNoCov">          0 :   unsigned char *what = (*(b-&gt;base_src) + b-&gt;src);</span>
<span class="lineNum">    1493 </span><span class="lineNoCov">          0 :   int what_stride = b-&gt;src_stride;</span>
<span class="lineNum">    1494 </span><span class="lineNoCov">          0 :   int pre_stride = x-&gt;e_mbd.pre.y_stride;</span>
<span class="lineNum">    1495 </span><span class="lineNoCov">          0 :   unsigned char *base_pre = x-&gt;e_mbd.pre.y_buffer;</span>
<span class="lineNum">    1496 </span>            :   unsigned char *in_what;
<span class="lineNum">    1497 </span><span class="lineNoCov">          0 :   int in_what_stride = pre_stride;</span>
<span class="lineNum">    1498 </span><span class="lineNoCov">          0 :   int mv_stride = pre_stride;</span>
<span class="lineNum">    1499 </span>            :   unsigned char *bestaddress;
<span class="lineNum">    1500 </span><span class="lineNoCov">          0 :   int_mv *best_mv = &amp;d-&gt;bmi.mv;</span>
<span class="lineNum">    1501 </span>            :   int_mv this_mv;
<span class="lineNum">    1502 </span>            :   unsigned int bestsad;
<span class="lineNum">    1503 </span>            :   unsigned int thissad;
<span class="lineNum">    1504 </span>            :   int r, c;
<span class="lineNum">    1505 </span>            : 
<span class="lineNum">    1506 </span>            :   unsigned char *check_here;
<span class="lineNum">    1507 </span>            : 
<span class="lineNum">    1508 </span><span class="lineNoCov">          0 :   int ref_row = ref_mv-&gt;as_mv.row;</span>
<span class="lineNum">    1509 </span><span class="lineNoCov">          0 :   int ref_col = ref_mv-&gt;as_mv.col;</span>
<span class="lineNum">    1510 </span>            : 
<span class="lineNum">    1511 </span><span class="lineNoCov">          0 :   int row_min = ref_row - distance;</span>
<span class="lineNum">    1512 </span><span class="lineNoCov">          0 :   int row_max = ref_row + distance;</span>
<span class="lineNum">    1513 </span><span class="lineNoCov">          0 :   int col_min = ref_col - distance;</span>
<span class="lineNum">    1514 </span><span class="lineNoCov">          0 :   int col_max = ref_col + distance;</span>
<span class="lineNum">    1515 </span>            : 
<span class="lineNum">    1516 </span>            :   DECLARE_ALIGNED(16, unsigned int, sad_array8[8]);
<span class="lineNum">    1517 </span>            :   unsigned int sad_array[3];
<span class="lineNum">    1518 </span>            : 
<span class="lineNum">    1519 </span>            :   int *mvsadcost[2];
<span class="lineNum">    1520 </span>            :   int_mv fcenter_mv;
<span class="lineNum">    1521 </span>            : 
<span class="lineNum">    1522 </span><span class="lineNoCov">          0 :   mvsadcost[0] = x-&gt;mvsadcost[0];</span>
<span class="lineNum">    1523 </span><span class="lineNoCov">          0 :   mvsadcost[1] = x-&gt;mvsadcost[1];</span>
<span class="lineNum">    1524 </span><span class="lineNoCov">          0 :   fcenter_mv.as_mv.row = center_mv-&gt;as_mv.row &gt;&gt; 3;</span>
<span class="lineNum">    1525 </span><span class="lineNoCov">          0 :   fcenter_mv.as_mv.col = center_mv-&gt;as_mv.col &gt;&gt; 3;</span>
<span class="lineNum">    1526 </span>            : 
<span class="lineNum">    1527 </span>            :   /* Work out the mid point for the search */
<span class="lineNum">    1528 </span><span class="lineNoCov">          0 :   in_what = base_pre + d-&gt;offset;</span>
<span class="lineNum">    1529 </span><span class="lineNoCov">          0 :   bestaddress = in_what + (ref_row * pre_stride) + ref_col;</span>
<span class="lineNum">    1530 </span>            : 
<span class="lineNum">    1531 </span><span class="lineNoCov">          0 :   best_mv-&gt;as_mv.row = ref_row;</span>
<span class="lineNum">    1532 </span><span class="lineNoCov">          0 :   best_mv-&gt;as_mv.col = ref_col;</span>
<span class="lineNum">    1533 </span>            : 
<span class="lineNum">    1534 </span>            :   /* Baseline value at the centre */
<span class="lineNum">    1535 </span><span class="lineNoCov">          0 :   bestsad = fn_ptr-&gt;sdf(what, what_stride, bestaddress, in_what_stride) +</span>
<span class="lineNum">    1536 </span><span class="lineNoCov">          0 :             mvsad_err_cost(best_mv, &amp;fcenter_mv, mvsadcost, sad_per_bit);</span>
<span class="lineNum">    1537 </span>            : 
<span class="lineNum">    1538 </span>            :   /* Apply further limits to prevent us looking using vectors that stretch
<span class="lineNum">    1539 </span>            :    * beyond the UMV border
<span class="lineNum">    1540 </span>            :    */
<span class="lineNum">    1541 </span><span class="lineNoCov">          0 :   if (col_min &lt; x-&gt;mv_col_min) col_min = x-&gt;mv_col_min;</span>
<span class="lineNum">    1542 </span>            : 
<span class="lineNum">    1543 </span><span class="lineNoCov">          0 :   if (col_max &gt; x-&gt;mv_col_max) col_max = x-&gt;mv_col_max;</span>
<span class="lineNum">    1544 </span>            : 
<span class="lineNum">    1545 </span><span class="lineNoCov">          0 :   if (row_min &lt; x-&gt;mv_row_min) row_min = x-&gt;mv_row_min;</span>
<span class="lineNum">    1546 </span>            : 
<span class="lineNum">    1547 </span><span class="lineNoCov">          0 :   if (row_max &gt; x-&gt;mv_row_max) row_max = x-&gt;mv_row_max;</span>
<span class="lineNum">    1548 </span>            : 
<span class="lineNum">    1549 </span><span class="lineNoCov">          0 :   for (r = row_min; r &lt; row_max; ++r) {</span>
<span class="lineNum">    1550 </span><span class="lineNoCov">          0 :     this_mv.as_mv.row = r;</span>
<span class="lineNum">    1551 </span><span class="lineNoCov">          0 :     check_here = r * mv_stride + in_what + col_min;</span>
<span class="lineNum">    1552 </span><span class="lineNoCov">          0 :     c = col_min;</span>
<span class="lineNum">    1553 </span>            : 
<span class="lineNum">    1554 </span><span class="lineNoCov">          0 :     while ((c + 7) &lt; col_max) {</span>
<span class="lineNum">    1555 </span>            :       int i;
<span class="lineNum">    1556 </span>            : 
<span class="lineNum">    1557 </span><span class="lineNoCov">          0 :       fn_ptr-&gt;sdx8f(what, what_stride, check_here, in_what_stride, sad_array8);</span>
<span class="lineNum">    1558 </span>            : 
<span class="lineNum">    1559 </span><span class="lineNoCov">          0 :       for (i = 0; i &lt; 8; ++i) {</span>
<span class="lineNum">    1560 </span><span class="lineNoCov">          0 :         thissad = sad_array8[i];</span>
<span class="lineNum">    1561 </span>            : 
<span class="lineNum">    1562 </span><span class="lineNoCov">          0 :         if (thissad &lt; bestsad) {</span>
<span class="lineNum">    1563 </span><span class="lineNoCov">          0 :           this_mv.as_mv.col = c;</span>
<span class="lineNum">    1564 </span><span class="lineNoCov">          0 :           thissad +=</span>
<span class="lineNum">    1565 </span><span class="lineNoCov">          0 :               mvsad_err_cost(&amp;this_mv, &amp;fcenter_mv, mvsadcost, sad_per_bit);</span>
<span class="lineNum">    1566 </span>            : 
<span class="lineNum">    1567 </span><span class="lineNoCov">          0 :           if (thissad &lt; bestsad) {</span>
<span class="lineNum">    1568 </span><span class="lineNoCov">          0 :             bestsad = thissad;</span>
<span class="lineNum">    1569 </span><span class="lineNoCov">          0 :             best_mv-&gt;as_mv.row = r;</span>
<span class="lineNum">    1570 </span><span class="lineNoCov">          0 :             best_mv-&gt;as_mv.col = c;</span>
<span class="lineNum">    1571 </span><span class="lineNoCov">          0 :             bestaddress = check_here;</span>
<span class="lineNum">    1572 </span>            :           }
<span class="lineNum">    1573 </span>            :         }
<span class="lineNum">    1574 </span>            : 
<span class="lineNum">    1575 </span><span class="lineNoCov">          0 :         check_here++;</span>
<span class="lineNum">    1576 </span><span class="lineNoCov">          0 :         c++;</span>
<span class="lineNum">    1577 </span>            :       }
<span class="lineNum">    1578 </span>            :     }
<span class="lineNum">    1579 </span>            : 
<span class="lineNum">    1580 </span><span class="lineNoCov">          0 :     while ((c + 2) &lt; col_max) {</span>
<span class="lineNum">    1581 </span>            :       int i;
<span class="lineNum">    1582 </span>            : 
<span class="lineNum">    1583 </span><span class="lineNoCov">          0 :       fn_ptr-&gt;sdx3f(what, what_stride, check_here, in_what_stride, sad_array);</span>
<span class="lineNum">    1584 </span>            : 
<span class="lineNum">    1585 </span><span class="lineNoCov">          0 :       for (i = 0; i &lt; 3; ++i) {</span>
<span class="lineNum">    1586 </span><span class="lineNoCov">          0 :         thissad = sad_array[i];</span>
<span class="lineNum">    1587 </span>            : 
<span class="lineNum">    1588 </span><span class="lineNoCov">          0 :         if (thissad &lt; bestsad) {</span>
<span class="lineNum">    1589 </span><span class="lineNoCov">          0 :           this_mv.as_mv.col = c;</span>
<span class="lineNum">    1590 </span><span class="lineNoCov">          0 :           thissad +=</span>
<span class="lineNum">    1591 </span><span class="lineNoCov">          0 :               mvsad_err_cost(&amp;this_mv, &amp;fcenter_mv, mvsadcost, sad_per_bit);</span>
<span class="lineNum">    1592 </span>            : 
<span class="lineNum">    1593 </span><span class="lineNoCov">          0 :           if (thissad &lt; bestsad) {</span>
<span class="lineNum">    1594 </span><span class="lineNoCov">          0 :             bestsad = thissad;</span>
<span class="lineNum">    1595 </span><span class="lineNoCov">          0 :             best_mv-&gt;as_mv.row = r;</span>
<span class="lineNum">    1596 </span><span class="lineNoCov">          0 :             best_mv-&gt;as_mv.col = c;</span>
<span class="lineNum">    1597 </span><span class="lineNoCov">          0 :             bestaddress = check_here;</span>
<span class="lineNum">    1598 </span>            :           }
<span class="lineNum">    1599 </span>            :         }
<span class="lineNum">    1600 </span>            : 
<span class="lineNum">    1601 </span><span class="lineNoCov">          0 :         check_here++;</span>
<span class="lineNum">    1602 </span><span class="lineNoCov">          0 :         c++;</span>
<span class="lineNum">    1603 </span>            :       }
<span class="lineNum">    1604 </span>            :     }
<span class="lineNum">    1605 </span>            : 
<span class="lineNum">    1606 </span><span class="lineNoCov">          0 :     while (c &lt; col_max) {</span>
<span class="lineNum">    1607 </span><span class="lineNoCov">          0 :       thissad = fn_ptr-&gt;sdf(what, what_stride, check_here, in_what_stride);</span>
<span class="lineNum">    1608 </span>            : 
<span class="lineNum">    1609 </span><span class="lineNoCov">          0 :       if (thissad &lt; bestsad) {</span>
<span class="lineNum">    1610 </span><span class="lineNoCov">          0 :         this_mv.as_mv.col = c;</span>
<span class="lineNum">    1611 </span><span class="lineNoCov">          0 :         thissad +=</span>
<span class="lineNum">    1612 </span><span class="lineNoCov">          0 :             mvsad_err_cost(&amp;this_mv, &amp;fcenter_mv, mvsadcost, sad_per_bit);</span>
<span class="lineNum">    1613 </span>            : 
<span class="lineNum">    1614 </span><span class="lineNoCov">          0 :         if (thissad &lt; bestsad) {</span>
<span class="lineNum">    1615 </span><span class="lineNoCov">          0 :           bestsad = thissad;</span>
<span class="lineNum">    1616 </span><span class="lineNoCov">          0 :           best_mv-&gt;as_mv.row = r;</span>
<span class="lineNum">    1617 </span><span class="lineNoCov">          0 :           best_mv-&gt;as_mv.col = c;</span>
<span class="lineNum">    1618 </span><span class="lineNoCov">          0 :           bestaddress = check_here;</span>
<span class="lineNum">    1619 </span>            :         }
<span class="lineNum">    1620 </span>            :       }
<span class="lineNum">    1621 </span>            : 
<span class="lineNum">    1622 </span><span class="lineNoCov">          0 :       check_here++;</span>
<span class="lineNum">    1623 </span><span class="lineNoCov">          0 :       c++;</span>
<span class="lineNum">    1624 </span>            :     }
<span class="lineNum">    1625 </span>            :   }
<span class="lineNum">    1626 </span>            : 
<span class="lineNum">    1627 </span><span class="lineNoCov">          0 :   this_mv.as_mv.row = best_mv-&gt;as_mv.row * 8;</span>
<span class="lineNum">    1628 </span><span class="lineNoCov">          0 :   this_mv.as_mv.col = best_mv-&gt;as_mv.col * 8;</span>
<span class="lineNum">    1629 </span>            : 
<span class="lineNum">    1630 </span><span class="lineNoCov">          0 :   return fn_ptr-&gt;vf(what, what_stride, bestaddress, in_what_stride, &amp;thissad) +</span>
<span class="lineNum">    1631 </span><span class="lineNoCov">          0 :          mv_err_cost(&amp;this_mv, center_mv, mvcost, x-&gt;errorperbit);</span>
<a name="1632"><span class="lineNum">    1632 </span>            : }</a>
<span class="lineNum">    1633 </span>            : 
<span class="lineNum">    1634 </span><span class="lineNoCov">          0 : int vp8_refining_search_sad_c(MACROBLOCK *x, BLOCK *b, BLOCKD *d,</span>
<span class="lineNum">    1635 </span>            :                               int_mv *ref_mv, int error_per_bit,
<span class="lineNum">    1636 </span>            :                               int search_range, vp8_variance_fn_ptr_t *fn_ptr,
<span class="lineNum">    1637 </span>            :                               int *mvcost[2], int_mv *center_mv) {
<span class="lineNum">    1638 </span><span class="lineNoCov">          0 :   MV neighbors[4] = { { -1, 0 }, { 0, -1 }, { 0, 1 }, { 1, 0 } };</span>
<span class="lineNum">    1639 </span>            :   int i, j;
<span class="lineNum">    1640 </span>            :   short this_row_offset, this_col_offset;
<span class="lineNum">    1641 </span>            : 
<span class="lineNum">    1642 </span><span class="lineNoCov">          0 :   int what_stride = b-&gt;src_stride;</span>
<span class="lineNum">    1643 </span><span class="lineNoCov">          0 :   int pre_stride = x-&gt;e_mbd.pre.y_stride;</span>
<span class="lineNum">    1644 </span><span class="lineNoCov">          0 :   unsigned char *base_pre = x-&gt;e_mbd.pre.y_buffer;</span>
<span class="lineNum">    1645 </span><span class="lineNoCov">          0 :   int in_what_stride = pre_stride;</span>
<span class="lineNum">    1646 </span><span class="lineNoCov">          0 :   unsigned char *what = (*(b-&gt;base_src) + b-&gt;src);</span>
<span class="lineNum">    1647 </span><span class="lineNoCov">          0 :   unsigned char *best_address =</span>
<span class="lineNum">    1648 </span><span class="lineNoCov">          0 :       (unsigned char *)(base_pre + d-&gt;offset +</span>
<span class="lineNum">    1649 </span><span class="lineNoCov">          0 :                         (ref_mv-&gt;as_mv.row * pre_stride) + ref_mv-&gt;as_mv.col);</span>
<span class="lineNum">    1650 </span>            :   unsigned char *check_here;
<span class="lineNum">    1651 </span>            :   int_mv this_mv;
<span class="lineNum">    1652 </span>            :   unsigned int bestsad;
<span class="lineNum">    1653 </span>            :   unsigned int thissad;
<span class="lineNum">    1654 </span>            : 
<span class="lineNum">    1655 </span>            :   int *mvsadcost[2];
<span class="lineNum">    1656 </span>            :   int_mv fcenter_mv;
<span class="lineNum">    1657 </span>            : 
<span class="lineNum">    1658 </span><span class="lineNoCov">          0 :   mvsadcost[0] = x-&gt;mvsadcost[0];</span>
<span class="lineNum">    1659 </span><span class="lineNoCov">          0 :   mvsadcost[1] = x-&gt;mvsadcost[1];</span>
<span class="lineNum">    1660 </span><span class="lineNoCov">          0 :   fcenter_mv.as_mv.row = center_mv-&gt;as_mv.row &gt;&gt; 3;</span>
<span class="lineNum">    1661 </span><span class="lineNoCov">          0 :   fcenter_mv.as_mv.col = center_mv-&gt;as_mv.col &gt;&gt; 3;</span>
<span class="lineNum">    1662 </span>            : 
<span class="lineNum">    1663 </span><span class="lineNoCov">          0 :   bestsad = fn_ptr-&gt;sdf(what, what_stride, best_address, in_what_stride) +</span>
<span class="lineNum">    1664 </span><span class="lineNoCov">          0 :             mvsad_err_cost(ref_mv, &amp;fcenter_mv, mvsadcost, error_per_bit);</span>
<span class="lineNum">    1665 </span>            : 
<span class="lineNum">    1666 </span><span class="lineNoCov">          0 :   for (i = 0; i &lt; search_range; ++i) {</span>
<span class="lineNum">    1667 </span><span class="lineNoCov">          0 :     int best_site = -1;</span>
<span class="lineNum">    1668 </span>            : 
<span class="lineNum">    1669 </span><span class="lineNoCov">          0 :     for (j = 0; j &lt; 4; ++j) {</span>
<span class="lineNum">    1670 </span><span class="lineNoCov">          0 :       this_row_offset = ref_mv-&gt;as_mv.row + neighbors[j].row;</span>
<span class="lineNum">    1671 </span><span class="lineNoCov">          0 :       this_col_offset = ref_mv-&gt;as_mv.col + neighbors[j].col;</span>
<span class="lineNum">    1672 </span>            : 
<span class="lineNum">    1673 </span><span class="lineNoCov">          0 :       if ((this_col_offset &gt; x-&gt;mv_col_min) &amp;&amp;</span>
<span class="lineNum">    1674 </span><span class="lineNoCov">          0 :           (this_col_offset &lt; x-&gt;mv_col_max) &amp;&amp;</span>
<span class="lineNum">    1675 </span><span class="lineNoCov">          0 :           (this_row_offset &gt; x-&gt;mv_row_min) &amp;&amp;</span>
<span class="lineNum">    1676 </span><span class="lineNoCov">          0 :           (this_row_offset &lt; x-&gt;mv_row_max)) {</span>
<span class="lineNum">    1677 </span><span class="lineNoCov">          0 :         check_here = (neighbors[j].row) * in_what_stride + neighbors[j].col +</span>
<span class="lineNum">    1678 </span>            :                      best_address;
<span class="lineNum">    1679 </span><span class="lineNoCov">          0 :         thissad = fn_ptr-&gt;sdf(what, what_stride, check_here, in_what_stride);</span>
<span class="lineNum">    1680 </span>            : 
<span class="lineNum">    1681 </span><span class="lineNoCov">          0 :         if (thissad &lt; bestsad) {</span>
<span class="lineNum">    1682 </span><span class="lineNoCov">          0 :           this_mv.as_mv.row = this_row_offset;</span>
<span class="lineNum">    1683 </span><span class="lineNoCov">          0 :           this_mv.as_mv.col = this_col_offset;</span>
<span class="lineNum">    1684 </span><span class="lineNoCov">          0 :           thissad +=</span>
<span class="lineNum">    1685 </span><span class="lineNoCov">          0 :               mvsad_err_cost(&amp;this_mv, &amp;fcenter_mv, mvsadcost, error_per_bit);</span>
<span class="lineNum">    1686 </span>            : 
<span class="lineNum">    1687 </span><span class="lineNoCov">          0 :           if (thissad &lt; bestsad) {</span>
<span class="lineNum">    1688 </span><span class="lineNoCov">          0 :             bestsad = thissad;</span>
<span class="lineNum">    1689 </span><span class="lineNoCov">          0 :             best_site = j;</span>
<span class="lineNum">    1690 </span>            :           }
<span class="lineNum">    1691 </span>            :         }
<span class="lineNum">    1692 </span>            :       }
<span class="lineNum">    1693 </span>            :     }
<span class="lineNum">    1694 </span>            : 
<span class="lineNum">    1695 </span><span class="lineNoCov">          0 :     if (best_site == -1) {</span>
<span class="lineNum">    1696 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    1697 </span>            :     } else {
<span class="lineNum">    1698 </span><span class="lineNoCov">          0 :       ref_mv-&gt;as_mv.row += neighbors[best_site].row;</span>
<span class="lineNum">    1699 </span><span class="lineNoCov">          0 :       ref_mv-&gt;as_mv.col += neighbors[best_site].col;</span>
<span class="lineNum">    1700 </span><span class="lineNoCov">          0 :       best_address += (neighbors[best_site].row) * in_what_stride +</span>
<span class="lineNum">    1701 </span><span class="lineNoCov">          0 :                       neighbors[best_site].col;</span>
<span class="lineNum">    1702 </span>            :     }
<span class="lineNum">    1703 </span>            :   }
<span class="lineNum">    1704 </span>            : 
<span class="lineNum">    1705 </span><span class="lineNoCov">          0 :   this_mv.as_mv.row = ref_mv-&gt;as_mv.row &lt;&lt; 3;</span>
<span class="lineNum">    1706 </span><span class="lineNoCov">          0 :   this_mv.as_mv.col = ref_mv-&gt;as_mv.col &lt;&lt; 3;</span>
<span class="lineNum">    1707 </span>            : 
<span class="lineNum">    1708 </span><span class="lineNoCov">          0 :   return fn_ptr-&gt;vf(what, what_stride, best_address, in_what_stride, &amp;thissad) +</span>
<span class="lineNum">    1709 </span><span class="lineNoCov">          0 :          mv_err_cost(&amp;this_mv, center_mv, mvcost, x-&gt;errorperbit);</span>
<a name="1710"><span class="lineNum">    1710 </span>            : }</a>
<span class="lineNum">    1711 </span>            : 
<span class="lineNum">    1712 </span><span class="lineNoCov">          0 : int vp8_refining_search_sadx4(MACROBLOCK *x, BLOCK *b, BLOCKD *d,</span>
<span class="lineNum">    1713 </span>            :                               int_mv *ref_mv, int error_per_bit,
<span class="lineNum">    1714 </span>            :                               int search_range, vp8_variance_fn_ptr_t *fn_ptr,
<span class="lineNum">    1715 </span>            :                               int *mvcost[2], int_mv *center_mv) {
<span class="lineNum">    1716 </span><span class="lineNoCov">          0 :   MV neighbors[4] = { { -1, 0 }, { 0, -1 }, { 0, 1 }, { 1, 0 } };</span>
<span class="lineNum">    1717 </span>            :   int i, j;
<span class="lineNum">    1718 </span>            :   short this_row_offset, this_col_offset;
<span class="lineNum">    1719 </span>            : 
<span class="lineNum">    1720 </span><span class="lineNoCov">          0 :   int what_stride = b-&gt;src_stride;</span>
<span class="lineNum">    1721 </span><span class="lineNoCov">          0 :   int pre_stride = x-&gt;e_mbd.pre.y_stride;</span>
<span class="lineNum">    1722 </span><span class="lineNoCov">          0 :   unsigned char *base_pre = x-&gt;e_mbd.pre.y_buffer;</span>
<span class="lineNum">    1723 </span><span class="lineNoCov">          0 :   int in_what_stride = pre_stride;</span>
<span class="lineNum">    1724 </span><span class="lineNoCov">          0 :   unsigned char *what = (*(b-&gt;base_src) + b-&gt;src);</span>
<span class="lineNum">    1725 </span><span class="lineNoCov">          0 :   unsigned char *best_address =</span>
<span class="lineNum">    1726 </span><span class="lineNoCov">          0 :       (unsigned char *)(base_pre + d-&gt;offset +</span>
<span class="lineNum">    1727 </span><span class="lineNoCov">          0 :                         (ref_mv-&gt;as_mv.row * pre_stride) + ref_mv-&gt;as_mv.col);</span>
<span class="lineNum">    1728 </span>            :   unsigned char *check_here;
<span class="lineNum">    1729 </span>            :   int_mv this_mv;
<span class="lineNum">    1730 </span>            :   unsigned int bestsad;
<span class="lineNum">    1731 </span>            :   unsigned int thissad;
<span class="lineNum">    1732 </span>            : 
<span class="lineNum">    1733 </span>            :   int *mvsadcost[2];
<span class="lineNum">    1734 </span>            :   int_mv fcenter_mv;
<span class="lineNum">    1735 </span>            : 
<span class="lineNum">    1736 </span><span class="lineNoCov">          0 :   mvsadcost[0] = x-&gt;mvsadcost[0];</span>
<span class="lineNum">    1737 </span><span class="lineNoCov">          0 :   mvsadcost[1] = x-&gt;mvsadcost[1];</span>
<span class="lineNum">    1738 </span><span class="lineNoCov">          0 :   fcenter_mv.as_mv.row = center_mv-&gt;as_mv.row &gt;&gt; 3;</span>
<span class="lineNum">    1739 </span><span class="lineNoCov">          0 :   fcenter_mv.as_mv.col = center_mv-&gt;as_mv.col &gt;&gt; 3;</span>
<span class="lineNum">    1740 </span>            : 
<span class="lineNum">    1741 </span><span class="lineNoCov">          0 :   bestsad = fn_ptr-&gt;sdf(what, what_stride, best_address, in_what_stride) +</span>
<span class="lineNum">    1742 </span><span class="lineNoCov">          0 :             mvsad_err_cost(ref_mv, &amp;fcenter_mv, mvsadcost, error_per_bit);</span>
<span class="lineNum">    1743 </span>            : 
<span class="lineNum">    1744 </span><span class="lineNoCov">          0 :   for (i = 0; i &lt; search_range; ++i) {</span>
<span class="lineNum">    1745 </span><span class="lineNoCov">          0 :     int best_site = -1;</span>
<span class="lineNum">    1746 </span><span class="lineNoCov">          0 :     int all_in = 1;</span>
<span class="lineNum">    1747 </span>            : 
<span class="lineNum">    1748 </span><span class="lineNoCov">          0 :     all_in &amp;= ((ref_mv-&gt;as_mv.row - 1) &gt; x-&gt;mv_row_min);</span>
<span class="lineNum">    1749 </span><span class="lineNoCov">          0 :     all_in &amp;= ((ref_mv-&gt;as_mv.row + 1) &lt; x-&gt;mv_row_max);</span>
<span class="lineNum">    1750 </span><span class="lineNoCov">          0 :     all_in &amp;= ((ref_mv-&gt;as_mv.col - 1) &gt; x-&gt;mv_col_min);</span>
<span class="lineNum">    1751 </span><span class="lineNoCov">          0 :     all_in &amp;= ((ref_mv-&gt;as_mv.col + 1) &lt; x-&gt;mv_col_max);</span>
<span class="lineNum">    1752 </span>            : 
<span class="lineNum">    1753 </span><span class="lineNoCov">          0 :     if (all_in) {</span>
<span class="lineNum">    1754 </span>            :       unsigned int sad_array[4];
<span class="lineNum">    1755 </span>            :       const unsigned char *block_offset[4];
<span class="lineNum">    1756 </span><span class="lineNoCov">          0 :       block_offset[0] = best_address - in_what_stride;</span>
<span class="lineNum">    1757 </span><span class="lineNoCov">          0 :       block_offset[1] = best_address - 1;</span>
<span class="lineNum">    1758 </span><span class="lineNoCov">          0 :       block_offset[2] = best_address + 1;</span>
<span class="lineNum">    1759 </span><span class="lineNoCov">          0 :       block_offset[3] = best_address + in_what_stride;</span>
<span class="lineNum">    1760 </span>            : 
<span class="lineNum">    1761 </span><span class="lineNoCov">          0 :       fn_ptr-&gt;sdx4df(what, what_stride, block_offset, in_what_stride,</span>
<span class="lineNum">    1762 </span>            :                      sad_array);
<span class="lineNum">    1763 </span>            : 
<span class="lineNum">    1764 </span><span class="lineNoCov">          0 :       for (j = 0; j &lt; 4; ++j) {</span>
<span class="lineNum">    1765 </span><span class="lineNoCov">          0 :         if (sad_array[j] &lt; bestsad) {</span>
<span class="lineNum">    1766 </span><span class="lineNoCov">          0 :           this_mv.as_mv.row = ref_mv-&gt;as_mv.row + neighbors[j].row;</span>
<span class="lineNum">    1767 </span><span class="lineNoCov">          0 :           this_mv.as_mv.col = ref_mv-&gt;as_mv.col + neighbors[j].col;</span>
<span class="lineNum">    1768 </span><span class="lineNoCov">          0 :           sad_array[j] +=</span>
<span class="lineNum">    1769 </span><span class="lineNoCov">          0 :               mvsad_err_cost(&amp;this_mv, &amp;fcenter_mv, mvsadcost, error_per_bit);</span>
<span class="lineNum">    1770 </span>            : 
<span class="lineNum">    1771 </span><span class="lineNoCov">          0 :           if (sad_array[j] &lt; bestsad) {</span>
<span class="lineNum">    1772 </span><span class="lineNoCov">          0 :             bestsad = sad_array[j];</span>
<span class="lineNum">    1773 </span><span class="lineNoCov">          0 :             best_site = j;</span>
<span class="lineNum">    1774 </span>            :           }
<span class="lineNum">    1775 </span>            :         }
<span class="lineNum">    1776 </span>            :       }
<span class="lineNum">    1777 </span>            :     } else {
<span class="lineNum">    1778 </span><span class="lineNoCov">          0 :       for (j = 0; j &lt; 4; ++j) {</span>
<span class="lineNum">    1779 </span><span class="lineNoCov">          0 :         this_row_offset = ref_mv-&gt;as_mv.row + neighbors[j].row;</span>
<span class="lineNum">    1780 </span><span class="lineNoCov">          0 :         this_col_offset = ref_mv-&gt;as_mv.col + neighbors[j].col;</span>
<span class="lineNum">    1781 </span>            : 
<span class="lineNum">    1782 </span><span class="lineNoCov">          0 :         if ((this_col_offset &gt; x-&gt;mv_col_min) &amp;&amp;</span>
<span class="lineNum">    1783 </span><span class="lineNoCov">          0 :             (this_col_offset &lt; x-&gt;mv_col_max) &amp;&amp;</span>
<span class="lineNum">    1784 </span><span class="lineNoCov">          0 :             (this_row_offset &gt; x-&gt;mv_row_min) &amp;&amp;</span>
<span class="lineNum">    1785 </span><span class="lineNoCov">          0 :             (this_row_offset &lt; x-&gt;mv_row_max)) {</span>
<span class="lineNum">    1786 </span><span class="lineNoCov">          0 :           check_here = (neighbors[j].row) * in_what_stride + neighbors[j].col +</span>
<span class="lineNum">    1787 </span>            :                        best_address;
<span class="lineNum">    1788 </span><span class="lineNoCov">          0 :           thissad = fn_ptr-&gt;sdf(what, what_stride, check_here, in_what_stride);</span>
<span class="lineNum">    1789 </span>            : 
<span class="lineNum">    1790 </span><span class="lineNoCov">          0 :           if (thissad &lt; bestsad) {</span>
<span class="lineNum">    1791 </span><span class="lineNoCov">          0 :             this_mv.as_mv.row = this_row_offset;</span>
<span class="lineNum">    1792 </span><span class="lineNoCov">          0 :             this_mv.as_mv.col = this_col_offset;</span>
<span class="lineNum">    1793 </span><span class="lineNoCov">          0 :             thissad +=</span>
<span class="lineNum">    1794 </span><span class="lineNoCov">          0 :                 mvsad_err_cost(&amp;this_mv, &amp;fcenter_mv, mvsadcost, error_per_bit);</span>
<span class="lineNum">    1795 </span>            : 
<span class="lineNum">    1796 </span><span class="lineNoCov">          0 :             if (thissad &lt; bestsad) {</span>
<span class="lineNum">    1797 </span><span class="lineNoCov">          0 :               bestsad = thissad;</span>
<span class="lineNum">    1798 </span><span class="lineNoCov">          0 :               best_site = j;</span>
<span class="lineNum">    1799 </span>            :             }
<span class="lineNum">    1800 </span>            :           }
<span class="lineNum">    1801 </span>            :         }
<span class="lineNum">    1802 </span>            :       }
<span class="lineNum">    1803 </span>            :     }
<span class="lineNum">    1804 </span>            : 
<span class="lineNum">    1805 </span><span class="lineNoCov">          0 :     if (best_site == -1) {</span>
<span class="lineNum">    1806 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">    1807 </span>            :     } else {
<span class="lineNum">    1808 </span><span class="lineNoCov">          0 :       ref_mv-&gt;as_mv.row += neighbors[best_site].row;</span>
<span class="lineNum">    1809 </span><span class="lineNoCov">          0 :       ref_mv-&gt;as_mv.col += neighbors[best_site].col;</span>
<span class="lineNum">    1810 </span><span class="lineNoCov">          0 :       best_address += (neighbors[best_site].row) * in_what_stride +</span>
<span class="lineNum">    1811 </span><span class="lineNoCov">          0 :                       neighbors[best_site].col;</span>
<span class="lineNum">    1812 </span>            :     }
<span class="lineNum">    1813 </span>            :   }
<span class="lineNum">    1814 </span>            : 
<span class="lineNum">    1815 </span><span class="lineNoCov">          0 :   this_mv.as_mv.row = ref_mv-&gt;as_mv.row * 8;</span>
<span class="lineNum">    1816 </span><span class="lineNoCov">          0 :   this_mv.as_mv.col = ref_mv-&gt;as_mv.col * 8;</span>
<span class="lineNum">    1817 </span>            : 
<span class="lineNum">    1818 </span><span class="lineNoCov">          0 :   return fn_ptr-&gt;vf(what, what_stride, best_address, in_what_stride, &amp;thissad) +</span>
<span class="lineNum">    1819 </span><span class="lineNoCov">          0 :          mv_err_cost(&amp;this_mv, center_mv, mvcost, x-&gt;errorperbit);</span>
<span class="lineNum">    1820 </span>            : }
<span class="lineNum">    1821 </span>            : 
<span class="lineNum">    1822 </span>            : #ifdef VP8_ENTROPY_STATS
<span class="lineNum">    1823 </span>            : void print_mode_context(void) {
<span class="lineNum">    1824 </span>            :   FILE *f = fopen(&quot;modecont.c&quot;, &quot;w&quot;);
<span class="lineNum">    1825 </span>            :   int i, j;
<span class="lineNum">    1826 </span>            : 
<span class="lineNum">    1827 </span>            :   fprintf(f, &quot;#include \&quot;entropy.h\&quot;\n&quot;);
<span class="lineNum">    1828 </span>            :   fprintf(f, &quot;const int vp8_mode_contexts[6][4] =\n&quot;);
<span class="lineNum">    1829 </span>            :   fprintf(f, &quot;{\n&quot;);
<span class="lineNum">    1830 </span>            : 
<span class="lineNum">    1831 </span>            :   for (j = 0; j &lt; 6; ++j) {
<span class="lineNum">    1832 </span>            :     fprintf(f, &quot;  { /* %d */\n&quot;, j);
<span class="lineNum">    1833 </span>            :     fprintf(f, &quot;    &quot;);
<span class="lineNum">    1834 </span>            : 
<span class="lineNum">    1835 </span>            :     for (i = 0; i &lt; 4; ++i) {
<span class="lineNum">    1836 </span>            :       int overal_prob;
<span class="lineNum">    1837 </span>            :       int this_prob;
<span class="lineNum">    1838 </span>            :       int count;
<span class="lineNum">    1839 </span>            : 
<span class="lineNum">    1840 </span>            :       /* Overall probs */
<span class="lineNum">    1841 </span>            :       count = mv_mode_cts[i][0] + mv_mode_cts[i][1];
<span class="lineNum">    1842 </span>            : 
<span class="lineNum">    1843 </span>            :       if (count)
<span class="lineNum">    1844 </span>            :         overal_prob = 256 * mv_mode_cts[i][0] / count;
<span class="lineNum">    1845 </span>            :       else
<span class="lineNum">    1846 </span>            :         overal_prob = 128;
<span class="lineNum">    1847 </span>            : 
<span class="lineNum">    1848 </span>            :       if (overal_prob == 0) overal_prob = 1;
<span class="lineNum">    1849 </span>            : 
<span class="lineNum">    1850 </span>            :       /* context probs */
<span class="lineNum">    1851 </span>            :       count = mv_ref_ct[j][i][0] + mv_ref_ct[j][i][1];
<span class="lineNum">    1852 </span>            : 
<span class="lineNum">    1853 </span>            :       if (count)
<span class="lineNum">    1854 </span>            :         this_prob = 256 * mv_ref_ct[j][i][0] / count;
<span class="lineNum">    1855 </span>            :       else
<span class="lineNum">    1856 </span>            :         this_prob = 128;
<span class="lineNum">    1857 </span>            : 
<span class="lineNum">    1858 </span>            :       if (this_prob == 0) this_prob = 1;
<span class="lineNum">    1859 </span>            : 
<span class="lineNum">    1860 </span>            :       fprintf(f, &quot;%5d, &quot;, this_prob);
<span class="lineNum">    1861 </span>            :     }
<span class="lineNum">    1862 </span>            : 
<span class="lineNum">    1863 </span>            :     fprintf(f, &quot;  },\n&quot;);
<span class="lineNum">    1864 </span>            :   }
<span class="lineNum">    1865 </span>            : 
<span class="lineNum">    1866 </span>            :   fprintf(f, &quot;};\n&quot;);
<span class="lineNum">    1867 </span>            :   fclose(f);
<span class="lineNum">    1868 </span>            : }
<span class="lineNum">    1869 </span>            : 
<span class="lineNum">    1870 </span>            : /* MV ref count VP8_ENTROPY_STATS stats code */
<span class="lineNum">    1871 </span>            : #ifdef VP8_ENTROPY_STATS
<span class="lineNum">    1872 </span>            : void init_mv_ref_counts() {
<span class="lineNum">    1873 </span>            :   memset(mv_ref_ct, 0, sizeof(mv_ref_ct));
<span class="lineNum">    1874 </span>            :   memset(mv_mode_cts, 0, sizeof(mv_mode_cts));
<span class="lineNum">    1875 </span>            : }
<span class="lineNum">    1876 </span>            : 
<span class="lineNum">    1877 </span>            : void accum_mv_refs(MB_PREDICTION_MODE m, const int ct[4]) {
<span class="lineNum">    1878 </span>            :   if (m == ZEROMV) {
<span class="lineNum">    1879 </span>            :     ++mv_ref_ct[ct[0]][0][0];
<span class="lineNum">    1880 </span>            :     ++mv_mode_cts[0][0];
<span class="lineNum">    1881 </span>            :   } else {
<span class="lineNum">    1882 </span>            :     ++mv_ref_ct[ct[0]][0][1];
<span class="lineNum">    1883 </span>            :     ++mv_mode_cts[0][1];
<span class="lineNum">    1884 </span>            : 
<span class="lineNum">    1885 </span>            :     if (m == NEARESTMV) {
<span class="lineNum">    1886 </span>            :       ++mv_ref_ct[ct[1]][1][0];
<span class="lineNum">    1887 </span>            :       ++mv_mode_cts[1][0];
<span class="lineNum">    1888 </span>            :     } else {
<span class="lineNum">    1889 </span>            :       ++mv_ref_ct[ct[1]][1][1];
<span class="lineNum">    1890 </span>            :       ++mv_mode_cts[1][1];
<span class="lineNum">    1891 </span>            : 
<span class="lineNum">    1892 </span>            :       if (m == NEARMV) {
<span class="lineNum">    1893 </span>            :         ++mv_ref_ct[ct[2]][2][0];
<span class="lineNum">    1894 </span>            :         ++mv_mode_cts[2][0];
<span class="lineNum">    1895 </span>            :       } else {
<span class="lineNum">    1896 </span>            :         ++mv_ref_ct[ct[2]][2][1];
<span class="lineNum">    1897 </span>            :         ++mv_mode_cts[2][1];
<span class="lineNum">    1898 </span>            : 
<span class="lineNum">    1899 </span>            :         if (m == NEWMV) {
<span class="lineNum">    1900 </span>            :           ++mv_ref_ct[ct[3]][3][0];
<span class="lineNum">    1901 </span>            :           ++mv_mode_cts[3][0];
<span class="lineNum">    1902 </span>            :         } else {
<span class="lineNum">    1903 </span>            :           ++mv_ref_ct[ct[3]][3][1];
<span class="lineNum">    1904 </span>            :           ++mv_mode_cts[3][1];
<span class="lineNum">    1905 </span>            :         }
<span class="lineNum">    1906 </span>            :       }
<span class="lineNum">    1907 </span>            :     }
<span class="lineNum">    1908 </span>            :   }
<span class="lineNum">    1909 </span>            : }
<span class="lineNum">    1910 </span>            : 
<span class="lineNum">    1911 </span>            : #endif /* END MV ref count VP8_ENTROPY_STATS stats code */
<span class="lineNum">    1912 </span>            : 
<span class="lineNum">    1913 </span>            : #endif
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.13</a></td></tr>
  </table>
  <br>

</body>
</html>

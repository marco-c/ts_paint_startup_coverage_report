<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - output.info - intl/icu/source/i18n/simpletz.cpp</title>
  <link rel="stylesheet" type="text/css" href="../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../../index.html">top level</a> - <a href="index.html">intl/icu/source/i18n</a> - simpletz.cpp<span style="font-size: 80%;"> (source / <a href="simpletz.cpp.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">output.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">519</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2017-07-14 16:53:18</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">43</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Legend:</td>
            <td class="headerValueLeg">            Lines:
            <span class="coverLegendCov">hit</span>
            <span class="coverLegendNoCov">not hit</span>
</td>
            <td></td>
          </tr>
          <tr><td><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : // Â© 2016 and later: Unicode, Inc. and others.</a>
<span class="lineNum">       2 </span>            : // License &amp; terms of use: http://www.unicode.org/copyright.html
<span class="lineNum">       3 </span>            : /*
<span class="lineNum">       4 </span>            :  *******************************************************************************
<span class="lineNum">       5 </span>            :  * Copyright (C) 1997-2013, International Business Machines Corporation and
<span class="lineNum">       6 </span>            :  * others. All Rights Reserved.
<span class="lineNum">       7 </span>            :  *******************************************************************************
<span class="lineNum">       8 </span>            :  *
<span class="lineNum">       9 </span>            :  * File SIMPLETZ.H
<span class="lineNum">      10 </span>            :  *
<span class="lineNum">      11 </span>            :  * Modification History:
<span class="lineNum">      12 </span>            :  *
<span class="lineNum">      13 </span>            :  *   Date        Name        Description
<span class="lineNum">      14 </span>            :  *   12/05/96    clhuang     Creation.
<span class="lineNum">      15 </span>            :  *   04/21/97    aliu        Fixed miscellaneous bugs found by inspection and
<span class="lineNum">      16 </span>            :  *                           testing.
<span class="lineNum">      17 </span>            :  *   07/29/97    aliu        Ported source bodies back from Java version with
<span class="lineNum">      18 </span>            :  *                           numerous feature enhancements and bug fixes.
<span class="lineNum">      19 </span>            :  *   08/10/98    stephen     JDK 1.2 sync.
<span class="lineNum">      20 </span>            :  *   09/17/98    stephen     Fixed getOffset() for last hour of year and DST
<span class="lineNum">      21 </span>            :  *   12/02/99    aliu        Added TimeMode and constructor and setStart/EndRule
<span class="lineNum">      22 </span>            :  *                           methods that take TimeMode. Whitespace cleanup.
<span class="lineNum">      23 </span>            :  ********************************************************************************
<span class="lineNum">      24 </span>            :  */
<span class="lineNum">      25 </span>            : 
<span class="lineNum">      26 </span>            : #include &quot;utypeinfo.h&quot;  // for 'typeid' to work
<span class="lineNum">      27 </span>            : 
<span class="lineNum">      28 </span>            : #include &quot;unicode/utypes.h&quot;
<span class="lineNum">      29 </span>            : 
<span class="lineNum">      30 </span>            : #if !UCONFIG_NO_FORMATTING
<span class="lineNum">      31 </span>            : 
<span class="lineNum">      32 </span>            : #include &quot;unicode/simpletz.h&quot;
<span class="lineNum">      33 </span>            : #include &quot;unicode/gregocal.h&quot;
<span class="lineNum">      34 </span>            : #include &quot;unicode/smpdtfmt.h&quot;
<span class="lineNum">      35 </span>            : 
<span class="lineNum">      36 </span>            : #include &quot;gregoimp.h&quot;
<span class="lineNum">      37 </span>            : #include &quot;umutex.h&quot;
<span class="lineNum">      38 </span>            : 
<a name="39"><span class="lineNum">      39 </span>            : U_NAMESPACE_BEGIN</a>
<span class="lineNum">      40 </span>            : 
<span class="lineNum">      41 </span><span class="lineNoCov">          0 : UOBJECT_DEFINE_RTTI_IMPLEMENTATION(SimpleTimeZone)</span>
<span class="lineNum">      42 </span>            : 
<span class="lineNum">      43 </span>            : // Use only for decodeStartRule() and decodeEndRule() where the year is not
<span class="lineNum">      44 </span>            : // available. Set February to 29 days to accomodate rules with that date
<span class="lineNum">      45 </span>            : // and day-of-week-on-or-before-that-date mode (DOW_LE_DOM_MODE).
<span class="lineNum">      46 </span>            : // The compareToRule() method adjusts to February 28 in non-leap years.
<span class="lineNum">      47 </span>            : //
<span class="lineNum">      48 </span>            : // For actual getOffset() calculations, use Grego::monthLength() and
<span class="lineNum">      49 </span>            : // Grego::previousMonthLength() which take leap years into account.
<span class="lineNum">      50 </span>            : // We handle leap years assuming always
<span class="lineNum">      51 </span>            : // Gregorian, since we know they didn't have daylight time when
<span class="lineNum">      52 </span>            : // Gregorian calendar started.
<span class="lineNum">      53 </span>            : const int8_t SimpleTimeZone::STATICMONTHLENGTH[] = {31,29,31,30,31,30,31,31,30,31,30,31};
<span class="lineNum">      54 </span>            : 
<span class="lineNum">      55 </span>            : static const UChar DST_STR[] = {0x0028,0x0044,0x0053,0x0054,0x0029,0}; // &quot;(DST)&quot;
<span class="lineNum">      56 </span>            : static const UChar STD_STR[] = {0x0028,0x0053,0x0054,0x0044,0x0029,0}; // &quot;(STD)&quot;
<span class="lineNum">      57 </span>            : 
<span class="lineNum">      58 </span>            : 
<span class="lineNum">      59 </span>            : // *****************************************************************************
<span class="lineNum">      60 </span>            : // class SimpleTimeZone
<span class="lineNum">      61 </span>            : // *****************************************************************************
<a name="62"><span class="lineNum">      62 </span>            : </a>
<span class="lineNum">      63 </span>            : 
<span class="lineNum">      64 </span><span class="lineNoCov">          0 : SimpleTimeZone::SimpleTimeZone(int32_t rawOffsetGMT, const UnicodeString&amp; ID)</span>
<span class="lineNum">      65 </span>            : :   BasicTimeZone(ID),
<span class="lineNum">      66 </span>            :     startMonth(0),
<span class="lineNum">      67 </span>            :     startDay(0),
<span class="lineNum">      68 </span>            :     startDayOfWeek(0),
<span class="lineNum">      69 </span>            :     startTime(0),
<span class="lineNum">      70 </span>            :     startTimeMode(WALL_TIME),
<span class="lineNum">      71 </span>            :     endTimeMode(WALL_TIME),
<span class="lineNum">      72 </span>            :     endMonth(0),
<span class="lineNum">      73 </span>            :     endDay(0),
<span class="lineNum">      74 </span>            :     endDayOfWeek(0),
<span class="lineNum">      75 </span>            :     endTime(0),
<span class="lineNum">      76 </span>            :     startYear(0),
<span class="lineNum">      77 </span>            :     rawOffset(rawOffsetGMT),
<span class="lineNum">      78 </span>            :     useDaylight(FALSE),
<span class="lineNum">      79 </span>            :     startMode(DOM_MODE),
<span class="lineNum">      80 </span>            :     endMode(DOM_MODE),
<span class="lineNum">      81 </span><span class="lineNoCov">          0 :     dstSavings(U_MILLIS_PER_HOUR)</span>
<span class="lineNum">      82 </span>            : {
<span class="lineNum">      83 </span><span class="lineNoCov">          0 :     clearTransitionRules();</span>
<span class="lineNum">      84 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">      85 </span>            : 
<a name="86"><span class="lineNum">      86 </span>            : // -------------------------------------</a>
<span class="lineNum">      87 </span>            : 
<span class="lineNum">      88 </span><span class="lineNoCov">          0 : SimpleTimeZone::SimpleTimeZone(int32_t rawOffsetGMT, const UnicodeString&amp; ID,</span>
<span class="lineNum">      89 </span>            :     int8_t savingsStartMonth, int8_t savingsStartDay,
<span class="lineNum">      90 </span>            :     int8_t savingsStartDayOfWeek, int32_t savingsStartTime,
<span class="lineNum">      91 </span>            :     int8_t savingsEndMonth, int8_t savingsEndDay,
<span class="lineNum">      92 </span>            :     int8_t savingsEndDayOfWeek, int32_t savingsEndTime,
<span class="lineNum">      93 </span><span class="lineNoCov">          0 :     UErrorCode&amp; status)</span>
<span class="lineNum">      94 </span><span class="lineNoCov">          0 : :   BasicTimeZone(ID)</span>
<span class="lineNum">      95 </span>            : {
<span class="lineNum">      96 </span><span class="lineNoCov">          0 :     clearTransitionRules();</span>
<span class="lineNum">      97 </span><span class="lineNoCov">          0 :     construct(rawOffsetGMT,</span>
<span class="lineNum">      98 </span>            :               savingsStartMonth, savingsStartDay, savingsStartDayOfWeek,
<span class="lineNum">      99 </span>            :               savingsStartTime, WALL_TIME,
<span class="lineNum">     100 </span>            :               savingsEndMonth, savingsEndDay, savingsEndDayOfWeek,
<span class="lineNum">     101 </span>            :               savingsEndTime, WALL_TIME,
<span class="lineNum">     102 </span><span class="lineNoCov">          0 :               U_MILLIS_PER_HOUR, status);</span>
<span class="lineNum">     103 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     104 </span>            : 
<a name="105"><span class="lineNum">     105 </span>            : // -------------------------------------</a>
<span class="lineNum">     106 </span>            : 
<span class="lineNum">     107 </span><span class="lineNoCov">          0 : SimpleTimeZone::SimpleTimeZone(int32_t rawOffsetGMT, const UnicodeString&amp; ID,</span>
<span class="lineNum">     108 </span>            :     int8_t savingsStartMonth, int8_t savingsStartDay,
<span class="lineNum">     109 </span>            :     int8_t savingsStartDayOfWeek, int32_t savingsStartTime,
<span class="lineNum">     110 </span>            :     int8_t savingsEndMonth, int8_t savingsEndDay,
<span class="lineNum">     111 </span>            :     int8_t savingsEndDayOfWeek, int32_t savingsEndTime,
<span class="lineNum">     112 </span><span class="lineNoCov">          0 :     int32_t savingsDST, UErrorCode&amp; status)</span>
<span class="lineNum">     113 </span><span class="lineNoCov">          0 : :   BasicTimeZone(ID)</span>
<span class="lineNum">     114 </span>            : {
<span class="lineNum">     115 </span><span class="lineNoCov">          0 :     clearTransitionRules();</span>
<span class="lineNum">     116 </span><span class="lineNoCov">          0 :     construct(rawOffsetGMT,</span>
<span class="lineNum">     117 </span>            :               savingsStartMonth, savingsStartDay, savingsStartDayOfWeek,
<span class="lineNum">     118 </span>            :               savingsStartTime, WALL_TIME,
<span class="lineNum">     119 </span>            :               savingsEndMonth, savingsEndDay, savingsEndDayOfWeek,
<span class="lineNum">     120 </span>            :               savingsEndTime, WALL_TIME,
<span class="lineNum">     121 </span><span class="lineNoCov">          0 :               savingsDST, status);</span>
<span class="lineNum">     122 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     123 </span>            : 
<a name="124"><span class="lineNum">     124 </span>            : // -------------------------------------</a>
<span class="lineNum">     125 </span>            : 
<span class="lineNum">     126 </span><span class="lineNoCov">          0 : SimpleTimeZone::SimpleTimeZone(int32_t rawOffsetGMT, const UnicodeString&amp; ID,</span>
<span class="lineNum">     127 </span>            :     int8_t savingsStartMonth, int8_t savingsStartDay,
<span class="lineNum">     128 </span>            :     int8_t savingsStartDayOfWeek, int32_t savingsStartTime,
<span class="lineNum">     129 </span>            :     TimeMode savingsStartTimeMode,
<span class="lineNum">     130 </span>            :     int8_t savingsEndMonth, int8_t savingsEndDay,
<span class="lineNum">     131 </span>            :     int8_t savingsEndDayOfWeek, int32_t savingsEndTime,
<span class="lineNum">     132 </span>            :     TimeMode savingsEndTimeMode,
<span class="lineNum">     133 </span><span class="lineNoCov">          0 :     int32_t savingsDST, UErrorCode&amp; status)</span>
<span class="lineNum">     134 </span><span class="lineNoCov">          0 : :   BasicTimeZone(ID)</span>
<span class="lineNum">     135 </span>            : {
<span class="lineNum">     136 </span><span class="lineNoCov">          0 :     clearTransitionRules();</span>
<span class="lineNum">     137 </span><span class="lineNoCov">          0 :     construct(rawOffsetGMT,</span>
<span class="lineNum">     138 </span>            :               savingsStartMonth, savingsStartDay, savingsStartDayOfWeek,
<span class="lineNum">     139 </span>            :               savingsStartTime, savingsStartTimeMode,
<span class="lineNum">     140 </span>            :               savingsEndMonth, savingsEndDay, savingsEndDayOfWeek,
<span class="lineNum">     141 </span>            :               savingsEndTime, savingsEndTimeMode,
<span class="lineNum">     142 </span><span class="lineNoCov">          0 :               savingsDST, status);</span>
<span class="lineNum">     143 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     144 </span>            : 
<span class="lineNum">     145 </span>            : /**
<a name="146"><span class="lineNum">     146 </span>            :  * Internal construction method.</a>
<span class="lineNum">     147 </span>            :  */
<span class="lineNum">     148 </span><span class="lineNoCov">          0 : void SimpleTimeZone::construct(int32_t rawOffsetGMT,</span>
<span class="lineNum">     149 </span>            :                                int8_t savingsStartMonth,
<span class="lineNum">     150 </span>            :                                int8_t savingsStartDay,
<span class="lineNum">     151 </span>            :                                int8_t savingsStartDayOfWeek,
<span class="lineNum">     152 </span>            :                                int32_t savingsStartTime,
<span class="lineNum">     153 </span>            :                                TimeMode savingsStartTimeMode,
<span class="lineNum">     154 </span>            :                                int8_t savingsEndMonth,
<span class="lineNum">     155 </span>            :                                int8_t savingsEndDay,
<span class="lineNum">     156 </span>            :                                int8_t savingsEndDayOfWeek,
<span class="lineNum">     157 </span>            :                                int32_t savingsEndTime,
<span class="lineNum">     158 </span>            :                                TimeMode savingsEndTimeMode,
<span class="lineNum">     159 </span>            :                                int32_t savingsDST,
<span class="lineNum">     160 </span>            :                                UErrorCode&amp; status)
<span class="lineNum">     161 </span>            : {
<span class="lineNum">     162 </span><span class="lineNoCov">          0 :     this-&gt;rawOffset      = rawOffsetGMT;</span>
<span class="lineNum">     163 </span><span class="lineNoCov">          0 :     this-&gt;startMonth     = savingsStartMonth;</span>
<span class="lineNum">     164 </span><span class="lineNoCov">          0 :     this-&gt;startDay       = savingsStartDay;</span>
<span class="lineNum">     165 </span><span class="lineNoCov">          0 :     this-&gt;startDayOfWeek = savingsStartDayOfWeek;</span>
<span class="lineNum">     166 </span><span class="lineNoCov">          0 :     this-&gt;startTime      = savingsStartTime;</span>
<span class="lineNum">     167 </span><span class="lineNoCov">          0 :     this-&gt;startTimeMode  = savingsStartTimeMode;</span>
<span class="lineNum">     168 </span><span class="lineNoCov">          0 :     this-&gt;endMonth       = savingsEndMonth;</span>
<span class="lineNum">     169 </span><span class="lineNoCov">          0 :     this-&gt;endDay         = savingsEndDay;</span>
<span class="lineNum">     170 </span><span class="lineNoCov">          0 :     this-&gt;endDayOfWeek   = savingsEndDayOfWeek;</span>
<span class="lineNum">     171 </span><span class="lineNoCov">          0 :     this-&gt;endTime        = savingsEndTime;</span>
<span class="lineNum">     172 </span><span class="lineNoCov">          0 :     this-&gt;endTimeMode    = savingsEndTimeMode;</span>
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :     this-&gt;dstSavings     = savingsDST;</span>
<span class="lineNum">     174 </span><span class="lineNoCov">          0 :     this-&gt;startYear      = 0;</span>
<span class="lineNum">     175 </span><span class="lineNoCov">          0 :     this-&gt;startMode      = DOM_MODE;</span>
<span class="lineNum">     176 </span><span class="lineNoCov">          0 :     this-&gt;endMode        = DOM_MODE;</span>
<span class="lineNum">     177 </span>            : 
<span class="lineNum">     178 </span><span class="lineNoCov">          0 :     decodeRules(status);</span>
<span class="lineNum">     179 </span>            : 
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :     if (savingsDST &lt;= 0) {</span>
<span class="lineNum">     181 </span><span class="lineNoCov">          0 :         status = U_ILLEGAL_ARGUMENT_ERROR;</span>
<span class="lineNum">     182 </span>            :     }
<span class="lineNum">     183 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     184 </span>            : 
<a name="185"><span class="lineNum">     185 </span>            : // -------------------------------------</a>
<span class="lineNum">     186 </span>            : 
<span class="lineNum">     187 </span><span class="lineNoCov">          0 : SimpleTimeZone::~SimpleTimeZone()</span>
<span class="lineNum">     188 </span>            : {
<span class="lineNum">     189 </span><span class="lineNoCov">          0 :     deleteTransitionRules();</span>
<span class="lineNum">     190 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     191 </span>            : 
<span class="lineNum">     192 </span>            : // -------------------------------------
<a name="193"><span class="lineNum">     193 </span>            : </a>
<span class="lineNum">     194 </span>            : // Called by TimeZone::createDefault(), then clone() inside a Mutex - be careful.
<span class="lineNum">     195 </span><span class="lineNoCov">          0 : SimpleTimeZone::SimpleTimeZone(const SimpleTimeZone &amp;source)</span>
<span class="lineNum">     196 </span><span class="lineNoCov">          0 : :   BasicTimeZone(source)</span>
<span class="lineNum">     197 </span>            : {
<span class="lineNum">     198 </span><span class="lineNoCov">          0 :     *this = source;</span>
<span class="lineNum">     199 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     200 </span>            : 
<span class="lineNum">     201 </span>            : // -------------------------------------
<span class="lineNum">     202 </span>            : 
<a name="203"><span class="lineNum">     203 </span>            : // Called by TimeZone::createDefault(), then clone() inside a Mutex - be careful.</a>
<span class="lineNum">     204 </span>            : SimpleTimeZone &amp;
<span class="lineNum">     205 </span><span class="lineNoCov">          0 : SimpleTimeZone::operator=(const SimpleTimeZone &amp;right)</span>
<span class="lineNum">     206 </span>            : {
<span class="lineNum">     207 </span><span class="lineNoCov">          0 :     if (this != &amp;right)</span>
<span class="lineNum">     208 </span>            :     {
<span class="lineNum">     209 </span><span class="lineNoCov">          0 :         TimeZone::operator=(right);</span>
<span class="lineNum">     210 </span><span class="lineNoCov">          0 :         rawOffset      = right.rawOffset;</span>
<span class="lineNum">     211 </span><span class="lineNoCov">          0 :         startMonth     = right.startMonth;</span>
<span class="lineNum">     212 </span><span class="lineNoCov">          0 :         startDay       = right.startDay;</span>
<span class="lineNum">     213 </span><span class="lineNoCov">          0 :         startDayOfWeek = right.startDayOfWeek;</span>
<span class="lineNum">     214 </span><span class="lineNoCov">          0 :         startTime      = right.startTime;</span>
<span class="lineNum">     215 </span><span class="lineNoCov">          0 :         startTimeMode  = right.startTimeMode;</span>
<span class="lineNum">     216 </span><span class="lineNoCov">          0 :         startMode      = right.startMode;</span>
<span class="lineNum">     217 </span><span class="lineNoCov">          0 :         endMonth       = right.endMonth;</span>
<span class="lineNum">     218 </span><span class="lineNoCov">          0 :         endDay         = right.endDay;</span>
<span class="lineNum">     219 </span><span class="lineNoCov">          0 :         endDayOfWeek   = right.endDayOfWeek;</span>
<span class="lineNum">     220 </span><span class="lineNoCov">          0 :         endTime        = right.endTime;</span>
<span class="lineNum">     221 </span><span class="lineNoCov">          0 :         endTimeMode    = right.endTimeMode;</span>
<span class="lineNum">     222 </span><span class="lineNoCov">          0 :         endMode        = right.endMode;</span>
<span class="lineNum">     223 </span><span class="lineNoCov">          0 :         startYear      = right.startYear;</span>
<span class="lineNum">     224 </span><span class="lineNoCov">          0 :         dstSavings     = right.dstSavings;</span>
<span class="lineNum">     225 </span><span class="lineNoCov">          0 :         useDaylight    = right.useDaylight;</span>
<span class="lineNum">     226 </span><span class="lineNoCov">          0 :         clearTransitionRules();</span>
<span class="lineNum">     227 </span>            :     }
<span class="lineNum">     228 </span><span class="lineNoCov">          0 :     return *this;</span>
<span class="lineNum">     229 </span>            : }
<span class="lineNum">     230 </span>            : 
<span class="lineNum">     231 </span>            : // -------------------------------------
<a name="232"><span class="lineNum">     232 </span>            : </a>
<span class="lineNum">     233 </span>            : UBool
<span class="lineNum">     234 </span><span class="lineNoCov">          0 : SimpleTimeZone::operator==(const TimeZone&amp; that) const</span>
<span class="lineNum">     235 </span>            : {
<span class="lineNum">     236 </span><span class="lineNoCov">          0 :     return ((this == &amp;that) ||</span>
<span class="lineNum">     237 </span><span class="lineNoCov">          0 :             (typeid(*this) == typeid(that) &amp;&amp;</span>
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :             TimeZone::operator==(that) &amp;&amp;</span>
<span class="lineNum">     239 </span><span class="lineNoCov">          0 :             hasSameRules(that)));</span>
<span class="lineNum">     240 </span>            : }
<span class="lineNum">     241 </span>            : 
<span class="lineNum">     242 </span>            : // -------------------------------------
<span class="lineNum">     243 </span>            : 
<a name="244"><span class="lineNum">     244 </span>            : // Called by TimeZone::createDefault() inside a Mutex - be careful.</a>
<span class="lineNum">     245 </span>            : TimeZone*
<span class="lineNum">     246 </span><span class="lineNoCov">          0 : SimpleTimeZone::clone() const</span>
<span class="lineNum">     247 </span>            : {
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :     return new SimpleTimeZone(*this);</span>
<span class="lineNum">     249 </span>            : }
<span class="lineNum">     250 </span>            : 
<span class="lineNum">     251 </span>            : // -------------------------------------
<span class="lineNum">     252 </span>            : 
<span class="lineNum">     253 </span>            : /**
<span class="lineNum">     254 </span>            :  * Sets the daylight savings starting year, that is, the year this time zone began
<span class="lineNum">     255 </span>            :  * observing its specified daylight savings time rules.  The time zone is considered
<span class="lineNum">     256 </span>            :  * not to observe daylight savings time prior to that year; SimpleTimeZone doesn't
<span class="lineNum">     257 </span>            :  * support historical daylight-savings-time rules.
<span class="lineNum">     258 </span>            :  * @param year the daylight savings starting year.
<a name="259"><span class="lineNum">     259 </span>            :  */</a>
<span class="lineNum">     260 </span>            : void
<span class="lineNum">     261 </span><span class="lineNoCov">          0 : SimpleTimeZone::setStartYear(int32_t year)</span>
<span class="lineNum">     262 </span>            : {
<span class="lineNum">     263 </span><span class="lineNoCov">          0 :     startYear = year;</span>
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :     transitionRulesInitialized = FALSE;</span>
<span class="lineNum">     265 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     266 </span>            : 
<span class="lineNum">     267 </span>            : // -------------------------------------
<span class="lineNum">     268 </span>            : 
<span class="lineNum">     269 </span>            : /**
<span class="lineNum">     270 </span>            :  * Sets the daylight savings starting rule. For example, in the U.S., Daylight Savings
<span class="lineNum">     271 </span>            :  * Time starts at the first Sunday in April, at 2 AM in standard time.
<span class="lineNum">     272 </span>            :  * Therefore, you can set the start rule by calling:
<span class="lineNum">     273 </span>            :  * setStartRule(TimeFields.APRIL, 1, TimeFields.SUNDAY, 2*60*60*1000);
<span class="lineNum">     274 </span>            :  * The dayOfWeekInMonth and dayOfWeek parameters together specify how to calculate
<span class="lineNum">     275 </span>            :  * the exact starting date.  Their exact meaning depend on their respective signs,
<span class="lineNum">     276 </span>            :  * allowing various types of rules to be constructed, as follows:&lt;ul&gt;
<span class="lineNum">     277 </span>            :  *   &lt;li&gt;If both dayOfWeekInMonth and dayOfWeek are positive, they specify the
<span class="lineNum">     278 </span>            :  *       day of week in the month (e.g., (2, WEDNESDAY) is the second Wednesday
<span class="lineNum">     279 </span>            :  *       of the month).
<span class="lineNum">     280 </span>            :  *   &lt;li&gt;If dayOfWeek is positive and dayOfWeekInMonth is negative, they specify
<span class="lineNum">     281 </span>            :  *       the day of week in the month counting backward from the end of the month.
<span class="lineNum">     282 </span>            :  *       (e.g., (-1, MONDAY) is the last Monday in the month)
<span class="lineNum">     283 </span>            :  *   &lt;li&gt;If dayOfWeek is zero and dayOfWeekInMonth is positive, dayOfWeekInMonth
<span class="lineNum">     284 </span>            :  *       specifies the day of the month, regardless of what day of the week it is.
<span class="lineNum">     285 </span>            :  *       (e.g., (10, 0) is the tenth day of the month)
<span class="lineNum">     286 </span>            :  *   &lt;li&gt;If dayOfWeek is zero and dayOfWeekInMonth is negative, dayOfWeekInMonth
<span class="lineNum">     287 </span>            :  *       specifies the day of the month counting backward from the end of the
<span class="lineNum">     288 </span>            :  *       month, regardless of what day of the week it is (e.g., (-2, 0) is the
<span class="lineNum">     289 </span>            :  *       next-to-last day of the month).
<span class="lineNum">     290 </span>            :  *   &lt;li&gt;If dayOfWeek is negative and dayOfWeekInMonth is positive, they specify the
<span class="lineNum">     291 </span>            :  *       first specified day of the week on or after the specfied day of the month.
<span class="lineNum">     292 </span>            :  *       (e.g., (15, -SUNDAY) is the first Sunday after the 15th of the month
<span class="lineNum">     293 </span>            :  *       [or the 15th itself if the 15th is a Sunday].)
<span class="lineNum">     294 </span>            :  *   &lt;li&gt;If dayOfWeek and DayOfWeekInMonth are both negative, they specify the
<span class="lineNum">     295 </span>            :  *       last specified day of the week on or before the specified day of the month.
<span class="lineNum">     296 </span>            :  *       (e.g., (-20, -TUESDAY) is the last Tuesday before the 20th of the month
<span class="lineNum">     297 </span>            :  *       [or the 20th itself if the 20th is a Tuesday].)&lt;/ul&gt;
<span class="lineNum">     298 </span>            :  * @param month the daylight savings starting month. Month is 0-based.
<span class="lineNum">     299 </span>            :  * eg, 0 for January.
<span class="lineNum">     300 </span>            :  * @param dayOfWeekInMonth the daylight savings starting
<span class="lineNum">     301 </span>            :  * day-of-week-in-month. Please see the member description for an example.
<span class="lineNum">     302 </span>            :  * @param dayOfWeek the daylight savings starting day-of-week. Please see
<span class="lineNum">     303 </span>            :  * the member description for an example.
<span class="lineNum">     304 </span>            :  * @param time the daylight savings starting time. Please see the member
<span class="lineNum">     305 </span>            :  * description for an example.
<span class="lineNum">     306 </span>            :  */
<a name="307"><span class="lineNum">     307 </span>            :  </a>
<span class="lineNum">     308 </span>            : void
<span class="lineNum">     309 </span><span class="lineNoCov">          0 : SimpleTimeZone::setStartRule(int32_t month, int32_t dayOfWeekInMonth, int32_t dayOfWeek,</span>
<span class="lineNum">     310 </span>            :                              int32_t time, TimeMode mode, UErrorCode&amp; status)
<span class="lineNum">     311 </span>            : {
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :     startMonth     = (int8_t)month;</span>
<span class="lineNum">     313 </span><span class="lineNoCov">          0 :     startDay       = (int8_t)dayOfWeekInMonth;</span>
<span class="lineNum">     314 </span><span class="lineNoCov">          0 :     startDayOfWeek = (int8_t)dayOfWeek;</span>
<span class="lineNum">     315 </span><span class="lineNoCov">          0 :     startTime      = time;</span>
<span class="lineNum">     316 </span><span class="lineNoCov">          0 :     startTimeMode  = mode;</span>
<span class="lineNum">     317 </span><span class="lineNoCov">          0 :     decodeStartRule(status);</span>
<span class="lineNum">     318 </span><span class="lineNoCov">          0 :     transitionRulesInitialized = FALSE;</span>
<span class="lineNum">     319 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     320 </span>            : 
<span class="lineNum">     321 </span>            : // -------------------------------------
<a name="322"><span class="lineNum">     322 </span>            : </a>
<span class="lineNum">     323 </span>            : void 
<span class="lineNum">     324 </span><span class="lineNoCov">          0 : SimpleTimeZone::setStartRule(int32_t month, int32_t dayOfMonth, </span>
<span class="lineNum">     325 </span>            :                              int32_t time, TimeMode mode, UErrorCode&amp; status) 
<span class="lineNum">     326 </span>            : {
<span class="lineNum">     327 </span><span class="lineNoCov">          0 :     setStartRule(month, dayOfMonth, 0, time, mode, status);</span>
<span class="lineNum">     328 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     329 </span>            : 
<span class="lineNum">     330 </span>            : // -------------------------------------
<a name="331"><span class="lineNum">     331 </span>            : </a>
<span class="lineNum">     332 </span>            : void 
<span class="lineNum">     333 </span><span class="lineNoCov">          0 : SimpleTimeZone::setStartRule(int32_t month, int32_t dayOfMonth, int32_t dayOfWeek, </span>
<span class="lineNum">     334 </span>            :                              int32_t time, TimeMode mode, UBool after, UErrorCode&amp; status)
<span class="lineNum">     335 </span>            : {
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :     setStartRule(month, after ? dayOfMonth : -dayOfMonth,</span>
<span class="lineNum">     337 </span><span class="lineNoCov">          0 :                  -dayOfWeek, time, mode, status);</span>
<span class="lineNum">     338 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     339 </span>            : 
<span class="lineNum">     340 </span>            : // -------------------------------------
<span class="lineNum">     341 </span>            : 
<span class="lineNum">     342 </span>            : /**
<span class="lineNum">     343 </span>            :  * Sets the daylight savings ending rule. For example, in the U.S., Daylight
<span class="lineNum">     344 </span>            :  * Savings Time ends at the last (-1) Sunday in October, at 2 AM in standard time.
<span class="lineNum">     345 </span>            :  * Therefore, you can set the end rule by calling:
<span class="lineNum">     346 </span>            :  * setEndRule(TimeFields.OCTOBER, -1, TimeFields.SUNDAY, 2*60*60*1000);
<span class="lineNum">     347 </span>            :  * Various other types of rules can be specified by manipulating the dayOfWeek
<span class="lineNum">     348 </span>            :  * and dayOfWeekInMonth parameters.  For complete details, see the documentation
<span class="lineNum">     349 </span>            :  * for setStartRule().
<span class="lineNum">     350 </span>            :  * @param month the daylight savings ending month. Month is 0-based.
<span class="lineNum">     351 </span>            :  * eg, 0 for January.
<span class="lineNum">     352 </span>            :  * @param dayOfWeekInMonth the daylight savings ending
<span class="lineNum">     353 </span>            :  * day-of-week-in-month. See setStartRule() for a complete explanation.
<span class="lineNum">     354 </span>            :  * @param dayOfWeek the daylight savings ending day-of-week. See setStartRule()
<span class="lineNum">     355 </span>            :  * for a complete explanation.
<span class="lineNum">     356 </span>            :  * @param time the daylight savings ending time. Please see the member
<span class="lineNum">     357 </span>            :  * description for an example.
<span class="lineNum">     358 </span>            :  */
<a name="359"><span class="lineNum">     359 </span>            : </a>
<span class="lineNum">     360 </span>            : void
<span class="lineNum">     361 </span><span class="lineNoCov">          0 : SimpleTimeZone::setEndRule(int32_t month, int32_t dayOfWeekInMonth, int32_t dayOfWeek,</span>
<span class="lineNum">     362 </span>            :                            int32_t time, TimeMode mode, UErrorCode&amp; status)
<span class="lineNum">     363 </span>            : {
<span class="lineNum">     364 </span><span class="lineNoCov">          0 :     endMonth     = (int8_t)month;</span>
<span class="lineNum">     365 </span><span class="lineNoCov">          0 :     endDay       = (int8_t)dayOfWeekInMonth;</span>
<span class="lineNum">     366 </span><span class="lineNoCov">          0 :     endDayOfWeek = (int8_t)dayOfWeek;</span>
<span class="lineNum">     367 </span><span class="lineNoCov">          0 :     endTime      = time;</span>
<span class="lineNum">     368 </span><span class="lineNoCov">          0 :     endTimeMode  = mode;</span>
<span class="lineNum">     369 </span><span class="lineNoCov">          0 :     decodeEndRule(status);</span>
<span class="lineNum">     370 </span><span class="lineNoCov">          0 :     transitionRulesInitialized = FALSE;</span>
<span class="lineNum">     371 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     372 </span>            : 
<span class="lineNum">     373 </span>            : // -------------------------------------
<a name="374"><span class="lineNum">     374 </span>            : </a>
<span class="lineNum">     375 </span>            : void 
<span class="lineNum">     376 </span><span class="lineNoCov">          0 : SimpleTimeZone::setEndRule(int32_t month, int32_t dayOfMonth, </span>
<span class="lineNum">     377 </span>            :                            int32_t time, TimeMode mode, UErrorCode&amp; status)
<span class="lineNum">     378 </span>            : {
<span class="lineNum">     379 </span><span class="lineNoCov">          0 :     setEndRule(month, dayOfMonth, 0, time, mode, status);</span>
<span class="lineNum">     380 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     381 </span>            : 
<span class="lineNum">     382 </span>            : // -------------------------------------
<a name="383"><span class="lineNum">     383 </span>            : </a>
<span class="lineNum">     384 </span>            : void 
<span class="lineNum">     385 </span><span class="lineNoCov">          0 : SimpleTimeZone::setEndRule(int32_t month, int32_t dayOfMonth, int32_t dayOfWeek, </span>
<span class="lineNum">     386 </span>            :                            int32_t time, TimeMode mode, UBool after, UErrorCode&amp; status)
<span class="lineNum">     387 </span>            : {
<span class="lineNum">     388 </span><span class="lineNoCov">          0 :     setEndRule(month, after ? dayOfMonth : -dayOfMonth,</span>
<span class="lineNum">     389 </span><span class="lineNoCov">          0 :                -dayOfWeek, time, mode, status);</span>
<span class="lineNum">     390 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     391 </span>            : 
<span class="lineNum">     392 </span>            : // -------------------------------------
<a name="393"><span class="lineNum">     393 </span>            : </a>
<span class="lineNum">     394 </span>            : int32_t
<span class="lineNum">     395 </span><span class="lineNoCov">          0 : SimpleTimeZone::getOffset(uint8_t era, int32_t year, int32_t month, int32_t day,</span>
<span class="lineNum">     396 </span>            :                           uint8_t dayOfWeek, int32_t millis, UErrorCode&amp; status) const
<span class="lineNum">     397 </span>            : {
<span class="lineNum">     398 </span>            :     // Check the month before calling Grego::monthLength(). This
<span class="lineNum">     399 </span>            :     // duplicates the test that occurs in the 7-argument getOffset(),
<span class="lineNum">     400 </span>            :     // however, this is unavoidable. We don't mind because this method, in
<span class="lineNum">     401 </span>            :     // fact, should not be called; internal code should always call the
<span class="lineNum">     402 </span>            :     // 7-argument getOffset(), and outside code should use Calendar.get(int
<span class="lineNum">     403 </span>            :     // field) with fields ZONE_OFFSET and DST_OFFSET. We can't get rid of
<span class="lineNum">     404 </span>            :     // this method because it's public API. - liu 8/10/98
<span class="lineNum">     405 </span><span class="lineNoCov">          0 :     if(month &lt; UCAL_JANUARY || month &gt; UCAL_DECEMBER) {</span>
<span class="lineNum">     406 </span><span class="lineNoCov">          0 :         status = U_ILLEGAL_ARGUMENT_ERROR;</span>
<span class="lineNum">     407 </span><span class="lineNoCov">          0 :         return 0;</span>
<span class="lineNum">     408 </span>            :     }
<span class="lineNum">     409 </span>            : 
<span class="lineNum">     410 </span><span class="lineNoCov">          0 :     return getOffset(era, year, month, day, dayOfWeek, millis, Grego::monthLength(year, month), status);</span>
<span class="lineNum">     411 </span>            : }
<a name="412"><span class="lineNum">     412 </span>            : </a>
<span class="lineNum">     413 </span>            : int32_t 
<span class="lineNum">     414 </span><span class="lineNoCov">          0 : SimpleTimeZone::getOffset(uint8_t era, int32_t year, int32_t month, int32_t day,</span>
<span class="lineNum">     415 </span>            :                           uint8_t dayOfWeek, int32_t millis, 
<span class="lineNum">     416 </span>            :                           int32_t /*monthLength*/, UErrorCode&amp; status) const
<span class="lineNum">     417 </span>            : {
<span class="lineNum">     418 </span>            :     // Check the month before calling Grego::monthLength(). This
<span class="lineNum">     419 </span>            :     // duplicates a test that occurs in the 9-argument getOffset(),
<span class="lineNum">     420 </span>            :     // however, this is unavoidable. We don't mind because this method, in
<span class="lineNum">     421 </span>            :     // fact, should not be called; internal code should always call the
<span class="lineNum">     422 </span>            :     // 9-argument getOffset(), and outside code should use Calendar.get(int
<span class="lineNum">     423 </span>            :     // field) with fields ZONE_OFFSET and DST_OFFSET. We can't get rid of
<span class="lineNum">     424 </span>            :     // this method because it's public API. - liu 8/10/98
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :     if (month &lt; UCAL_JANUARY</span>
<span class="lineNum">     426 </span><span class="lineNoCov">          0 :         || month &gt; UCAL_DECEMBER) {</span>
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :         status = U_ILLEGAL_ARGUMENT_ERROR;</span>
<span class="lineNum">     428 </span><span class="lineNoCov">          0 :         return -1;</span>
<span class="lineNum">     429 </span>            :     }
<span class="lineNum">     430 </span>            : 
<span class="lineNum">     431 </span>            :     // We ignore monthLength because it can be derived from year and month.
<span class="lineNum">     432 </span>            :     // This is so that February in leap years is calculated correctly.
<span class="lineNum">     433 </span>            :     // We keep this argument in this function for backwards compatibility.
<span class="lineNum">     434 </span><span class="lineNoCov">          0 :     return getOffset(era, year, month, day, dayOfWeek, millis,</span>
<span class="lineNum">     435 </span><span class="lineNoCov">          0 :                      Grego::monthLength(year, month),</span>
<span class="lineNum">     436 </span><span class="lineNoCov">          0 :                      Grego::previousMonthLength(year, month),</span>
<span class="lineNum">     437 </span><span class="lineNoCov">          0 :                      status);</span>
<span class="lineNum">     438 </span>            : }
<a name="439"><span class="lineNum">     439 </span>            : </a>
<span class="lineNum">     440 </span>            : int32_t 
<span class="lineNum">     441 </span><span class="lineNoCov">          0 : SimpleTimeZone::getOffset(uint8_t era, int32_t year, int32_t month, int32_t day,</span>
<span class="lineNum">     442 </span>            :                           uint8_t dayOfWeek, int32_t millis, 
<span class="lineNum">     443 </span>            :                           int32_t monthLength, int32_t prevMonthLength,
<span class="lineNum">     444 </span>            :                           UErrorCode&amp; status) const
<span class="lineNum">     445 </span>            : {
<span class="lineNum">     446 </span><span class="lineNoCov">          0 :     if(U_FAILURE(status)) return 0;</span>
<span class="lineNum">     447 </span>            : 
<span class="lineNum">     448 </span><span class="lineNoCov">          0 :     if ((era != GregorianCalendar::AD &amp;&amp; era != GregorianCalendar::BC)</span>
<span class="lineNum">     449 </span><span class="lineNoCov">          0 :         || month &lt; UCAL_JANUARY</span>
<span class="lineNum">     450 </span><span class="lineNoCov">          0 :         || month &gt; UCAL_DECEMBER</span>
<span class="lineNum">     451 </span><span class="lineNoCov">          0 :         || day &lt; 1</span>
<span class="lineNum">     452 </span><span class="lineNoCov">          0 :         || day &gt; monthLength</span>
<span class="lineNum">     453 </span><span class="lineNoCov">          0 :         || dayOfWeek &lt; UCAL_SUNDAY</span>
<span class="lineNum">     454 </span><span class="lineNoCov">          0 :         || dayOfWeek &gt; UCAL_SATURDAY</span>
<span class="lineNum">     455 </span><span class="lineNoCov">          0 :         || millis &lt; 0</span>
<span class="lineNum">     456 </span><span class="lineNoCov">          0 :         || millis &gt;= U_MILLIS_PER_DAY</span>
<span class="lineNum">     457 </span><span class="lineNoCov">          0 :         || monthLength &lt; 28</span>
<span class="lineNum">     458 </span><span class="lineNoCov">          0 :         || monthLength &gt; 31</span>
<span class="lineNum">     459 </span><span class="lineNoCov">          0 :         || prevMonthLength &lt; 28</span>
<span class="lineNum">     460 </span><span class="lineNoCov">          0 :         || prevMonthLength &gt; 31) {</span>
<span class="lineNum">     461 </span><span class="lineNoCov">          0 :         status = U_ILLEGAL_ARGUMENT_ERROR;</span>
<span class="lineNum">     462 </span><span class="lineNoCov">          0 :         return -1;</span>
<span class="lineNum">     463 </span>            :     }
<span class="lineNum">     464 </span>            : 
<span class="lineNum">     465 </span><span class="lineNoCov">          0 :     int32_t result = rawOffset;</span>
<span class="lineNum">     466 </span>            : 
<span class="lineNum">     467 </span>            :     // Bail out if we are before the onset of daylight savings time
<span class="lineNum">     468 </span><span class="lineNoCov">          0 :     if(!useDaylight || year &lt; startYear || era != GregorianCalendar::AD) </span>
<span class="lineNum">     469 </span><span class="lineNoCov">          0 :         return result;</span>
<span class="lineNum">     470 </span>            : 
<span class="lineNum">     471 </span>            :     // Check for southern hemisphere.  We assume that the start and end
<span class="lineNum">     472 </span>            :     // month are different.
<span class="lineNum">     473 </span><span class="lineNoCov">          0 :     UBool southern = (startMonth &gt; endMonth);</span>
<span class="lineNum">     474 </span>            : 
<span class="lineNum">     475 </span>            :     // Compare the date to the starting and ending rules.+1 = date&gt;rule, -1
<span class="lineNum">     476 </span>            :     // = date&lt;rule, 0 = date==rule.
<span class="lineNum">     477 </span><span class="lineNoCov">          0 :     int32_t startCompare = compareToRule((int8_t)month, (int8_t)monthLength, (int8_t)prevMonthLength,</span>
<span class="lineNum">     478 </span><span class="lineNoCov">          0 :                                          (int8_t)day, (int8_t)dayOfWeek, millis,</span>
<span class="lineNum">     479 </span><span class="lineNoCov">          0 :                                          startTimeMode == UTC_TIME ? -rawOffset : 0,</span>
<span class="lineNum">     480 </span><span class="lineNoCov">          0 :                                          startMode, (int8_t)startMonth, (int8_t)startDayOfWeek,</span>
<span class="lineNum">     481 </span><span class="lineNoCov">          0 :                                          (int8_t)startDay, startTime);</span>
<span class="lineNum">     482 </span><span class="lineNoCov">          0 :     int32_t endCompare = 0;</span>
<span class="lineNum">     483 </span>            : 
<span class="lineNum">     484 </span>            :     /* We don't always have to compute endCompare.  For many instances,
<span class="lineNum">     485 </span>            :      * startCompare is enough to determine if we are in DST or not.  In the
<span class="lineNum">     486 </span>            :      * northern hemisphere, if we are before the start rule, we can't have
<span class="lineNum">     487 </span>            :      * DST.  In the southern hemisphere, if we are after the start rule, we
<span class="lineNum">     488 </span>            :      * must have DST.  This is reflected in the way the next if statement
<span class="lineNum">     489 </span>            :      * (not the one immediately following) short circuits. */
<span class="lineNum">     490 </span><span class="lineNoCov">          0 :     if(southern != (startCompare &gt;= 0)) {</span>
<span class="lineNum">     491 </span><span class="lineNoCov">          0 :         endCompare = compareToRule((int8_t)month, (int8_t)monthLength, (int8_t)prevMonthLength,</span>
<span class="lineNum">     492 </span><span class="lineNoCov">          0 :                                    (int8_t)day, (int8_t)dayOfWeek, millis,</span>
<span class="lineNum">     493 </span><span class="lineNoCov">          0 :                                    endTimeMode == WALL_TIME ? dstSavings :</span>
<span class="lineNum">     494 </span><span class="lineNoCov">          0 :                                     (endTimeMode == UTC_TIME ? -rawOffset : 0),</span>
<span class="lineNum">     495 </span><span class="lineNoCov">          0 :                                    endMode, (int8_t)endMonth, (int8_t)endDayOfWeek,</span>
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :                                    (int8_t)endDay, endTime);</span>
<span class="lineNum">     497 </span>            :     }
<span class="lineNum">     498 </span>            : 
<span class="lineNum">     499 </span>            :     // Check for both the northern and southern hemisphere cases.  We
<span class="lineNum">     500 </span>            :     // assume that in the northern hemisphere, the start rule is before the
<span class="lineNum">     501 </span>            :     // end rule within the calendar year, and vice versa for the southern
<span class="lineNum">     502 </span>            :     // hemisphere.
<span class="lineNum">     503 </span><span class="lineNoCov">          0 :     if ((!southern &amp;&amp; (startCompare &gt;= 0 &amp;&amp; endCompare &lt; 0)) ||</span>
<span class="lineNum">     504 </span><span class="lineNoCov">          0 :         (southern &amp;&amp; (startCompare &gt;= 0 || endCompare &lt; 0)))</span>
<span class="lineNum">     505 </span><span class="lineNoCov">          0 :         result += dstSavings;</span>
<span class="lineNum">     506 </span>            : 
<span class="lineNum">     507 </span><span class="lineNoCov">          0 :     return result;</span>
<span class="lineNum">     508 </span>            : }
<a name="509"><span class="lineNum">     509 </span>            : </a>
<span class="lineNum">     510 </span>            : void
<span class="lineNum">     511 </span><span class="lineNoCov">          0 : SimpleTimeZone::getOffsetFromLocal(UDate date, int32_t nonExistingTimeOpt, int32_t duplicatedTimeOpt,</span>
<span class="lineNum">     512 </span>            :                                    int32_t&amp; rawOffsetGMT, int32_t&amp; savingsDST, UErrorCode&amp; status) const {
<span class="lineNum">     513 </span><span class="lineNoCov">          0 :     if (U_FAILURE(status)) {</span>
<span class="lineNum">     514 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">     515 </span>            :     }
<span class="lineNum">     516 </span>            : 
<span class="lineNum">     517 </span><span class="lineNoCov">          0 :     rawOffsetGMT = getRawOffset();</span>
<span class="lineNum">     518 </span>            :     int32_t year, month, dom, dow;
<span class="lineNum">     519 </span><span class="lineNoCov">          0 :     double day = uprv_floor(date / U_MILLIS_PER_DAY);</span>
<span class="lineNum">     520 </span><span class="lineNoCov">          0 :     int32_t millis = (int32_t) (date - day * U_MILLIS_PER_DAY);</span>
<span class="lineNum">     521 </span>            : 
<span class="lineNum">     522 </span><span class="lineNoCov">          0 :     Grego::dayToFields(day, year, month, dom, dow);</span>
<span class="lineNum">     523 </span>            : 
<span class="lineNum">     524 </span><span class="lineNoCov">          0 :     savingsDST = getOffset(GregorianCalendar::AD, year, month, dom,</span>
<span class="lineNum">     525 </span>            :                           (uint8_t) dow, millis,
<span class="lineNum">     526 </span><span class="lineNoCov">          0 :                           Grego::monthLength(year, month),</span>
<span class="lineNum">     527 </span><span class="lineNoCov">          0 :                           status) - rawOffsetGMT;</span>
<span class="lineNum">     528 </span><span class="lineNoCov">          0 :     if (U_FAILURE(status)) {</span>
<span class="lineNum">     529 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">     530 </span>            :     }
<span class="lineNum">     531 </span>            : 
<span class="lineNum">     532 </span><span class="lineNoCov">          0 :     UBool recalc = FALSE;</span>
<span class="lineNum">     533 </span>            : 
<span class="lineNum">     534 </span>            :     // Now we need some adjustment
<span class="lineNum">     535 </span><span class="lineNoCov">          0 :     if (savingsDST &gt; 0) {</span>
<span class="lineNum">     536 </span><span class="lineNoCov">          0 :         if ((nonExistingTimeOpt &amp; kStdDstMask) == kStandard</span>
<span class="lineNum">     537 </span><span class="lineNoCov">          0 :             || ((nonExistingTimeOpt &amp; kStdDstMask) != kDaylight &amp;&amp; (nonExistingTimeOpt &amp; kFormerLatterMask) != kLatter)) {</span>
<span class="lineNum">     538 </span><span class="lineNoCov">          0 :             date -= getDSTSavings();</span>
<span class="lineNum">     539 </span><span class="lineNoCov">          0 :             recalc = TRUE;</span>
<span class="lineNum">     540 </span>            :         }
<span class="lineNum">     541 </span>            :     } else {
<span class="lineNum">     542 </span><span class="lineNoCov">          0 :         if ((duplicatedTimeOpt &amp; kStdDstMask) == kDaylight</span>
<span class="lineNum">     543 </span><span class="lineNoCov">          0 :                 || ((duplicatedTimeOpt &amp; kStdDstMask) != kStandard &amp;&amp; (duplicatedTimeOpt &amp; kFormerLatterMask) == kFormer)) {</span>
<span class="lineNum">     544 </span><span class="lineNoCov">          0 :             date -= getDSTSavings();</span>
<span class="lineNum">     545 </span><span class="lineNoCov">          0 :             recalc = TRUE;</span>
<span class="lineNum">     546 </span>            :         }
<span class="lineNum">     547 </span>            :     }
<span class="lineNum">     548 </span><span class="lineNoCov">          0 :     if (recalc) {</span>
<span class="lineNum">     549 </span><span class="lineNoCov">          0 :         day = uprv_floor(date / U_MILLIS_PER_DAY);</span>
<span class="lineNum">     550 </span><span class="lineNoCov">          0 :         millis = (int32_t) (date - day * U_MILLIS_PER_DAY);</span>
<span class="lineNum">     551 </span><span class="lineNoCov">          0 :         Grego::dayToFields(day, year, month, dom, dow);</span>
<span class="lineNum">     552 </span><span class="lineNoCov">          0 :         savingsDST = getOffset(GregorianCalendar::AD, year, month, dom,</span>
<span class="lineNum">     553 </span>            :                           (uint8_t) dow, millis,
<span class="lineNum">     554 </span><span class="lineNoCov">          0 :                           Grego::monthLength(year, month),</span>
<span class="lineNum">     555 </span><span class="lineNoCov">          0 :                           status) - rawOffsetGMT;</span>
<span class="lineNum">     556 </span>            :     }
<span class="lineNum">     557 </span>            : }
<span class="lineNum">     558 </span>            : 
<span class="lineNum">     559 </span>            : // -------------------------------------
<span class="lineNum">     560 </span>            : 
<span class="lineNum">     561 </span>            : /**
<span class="lineNum">     562 </span>            :  * Compare a given date in the year to a rule. Return 1, 0, or -1, depending
<span class="lineNum">     563 </span>            :  * on whether the date is after, equal to, or before the rule date. The
<span class="lineNum">     564 </span>            :  * millis are compared directly against the ruleMillis, so any
<span class="lineNum">     565 </span>            :  * standard-daylight adjustments must be handled by the caller.
<span class="lineNum">     566 </span>            :  *
<span class="lineNum">     567 </span>            :  * @return  1 if the date is after the rule date, -1 if the date is before
<span class="lineNum">     568 </span>            :  *          the rule date, or 0 if the date is equal to the rule date.
<a name="569"><span class="lineNum">     569 </span>            :  */</a>
<span class="lineNum">     570 </span>            : int32_t 
<span class="lineNum">     571 </span><span class="lineNoCov">          0 : SimpleTimeZone::compareToRule(int8_t month, int8_t monthLen, int8_t prevMonthLen,</span>
<span class="lineNum">     572 </span>            :                               int8_t dayOfMonth,
<span class="lineNum">     573 </span>            :                               int8_t dayOfWeek, int32_t millis, int32_t millisDelta,
<span class="lineNum">     574 </span>            :                               EMode ruleMode, int8_t ruleMonth, int8_t ruleDayOfWeek,
<span class="lineNum">     575 </span>            :                               int8_t ruleDay, int32_t ruleMillis)
<span class="lineNum">     576 </span>            : {
<span class="lineNum">     577 </span>            :     // Make adjustments for startTimeMode and endTimeMode
<span class="lineNum">     578 </span><span class="lineNoCov">          0 :     millis += millisDelta;</span>
<span class="lineNum">     579 </span><span class="lineNoCov">          0 :     while (millis &gt;= U_MILLIS_PER_DAY) {</span>
<span class="lineNum">     580 </span><span class="lineNoCov">          0 :         millis -= U_MILLIS_PER_DAY;</span>
<span class="lineNum">     581 </span><span class="lineNoCov">          0 :         ++dayOfMonth;</span>
<span class="lineNum">     582 </span><span class="lineNoCov">          0 :         dayOfWeek = (int8_t)(1 + (dayOfWeek % 7)); // dayOfWeek is one-based</span>
<span class="lineNum">     583 </span><span class="lineNoCov">          0 :         if (dayOfMonth &gt; monthLen) {</span>
<span class="lineNum">     584 </span><span class="lineNoCov">          0 :             dayOfMonth = 1;</span>
<span class="lineNum">     585 </span>            :             /* When incrementing the month, it is desirible to overflow
<span class="lineNum">     586 </span>            :              * from DECEMBER to DECEMBER+1, since we use the result to
<span class="lineNum">     587 </span>            :              * compare against a real month. Wraparound of the value
<span class="lineNum">     588 </span>            :              * leads to bug 4173604. */
<span class="lineNum">     589 </span><span class="lineNoCov">          0 :             ++month;</span>
<span class="lineNum">     590 </span>            :         }
<span class="lineNum">     591 </span>            :     }
<span class="lineNum">     592 </span><span class="lineNoCov">          0 :     while (millis &lt; 0) {</span>
<span class="lineNum">     593 </span><span class="lineNoCov">          0 :         millis += U_MILLIS_PER_DAY;</span>
<span class="lineNum">     594 </span><span class="lineNoCov">          0 :         --dayOfMonth;</span>
<span class="lineNum">     595 </span><span class="lineNoCov">          0 :         dayOfWeek = (int8_t)(1 + ((dayOfWeek+5) % 7)); // dayOfWeek is one-based</span>
<span class="lineNum">     596 </span><span class="lineNoCov">          0 :         if (dayOfMonth &lt; 1) {</span>
<span class="lineNum">     597 </span><span class="lineNoCov">          0 :             dayOfMonth = prevMonthLen;</span>
<span class="lineNum">     598 </span><span class="lineNoCov">          0 :             --month;</span>
<span class="lineNum">     599 </span>            :         }
<span class="lineNum">     600 </span>            :     }
<span class="lineNum">     601 </span>            : 
<span class="lineNum">     602 </span>            :     // first compare months.  If they're different, we don't have to worry about days
<span class="lineNum">     603 </span>            :     // and times
<span class="lineNum">     604 </span><span class="lineNoCov">          0 :     if (month &lt; ruleMonth) return -1;</span>
<span class="lineNum">     605 </span><span class="lineNoCov">          0 :     else if (month &gt; ruleMonth) return 1;</span>
<span class="lineNum">     606 </span>            : 
<span class="lineNum">     607 </span>            :     // calculate the actual day of month for the rule
<span class="lineNum">     608 </span><span class="lineNoCov">          0 :     int32_t ruleDayOfMonth = 0;</span>
<span class="lineNum">     609 </span>            : 
<span class="lineNum">     610 </span>            :     // Adjust the ruleDay to the monthLen, for non-leap year February 29 rule days.
<span class="lineNum">     611 </span><span class="lineNoCov">          0 :     if (ruleDay &gt; monthLen) {</span>
<span class="lineNum">     612 </span><span class="lineNoCov">          0 :         ruleDay = monthLen;</span>
<span class="lineNum">     613 </span>            :     }
<span class="lineNum">     614 </span>            : 
<span class="lineNum">     615 </span><span class="lineNoCov">          0 :     switch (ruleMode)</span>
<span class="lineNum">     616 </span>            :     {
<span class="lineNum">     617 </span>            :     // if the mode is day-of-month, the day of month is given
<span class="lineNum">     618 </span>            :     case DOM_MODE:
<span class="lineNum">     619 </span><span class="lineNoCov">          0 :         ruleDayOfMonth = ruleDay;</span>
<span class="lineNum">     620 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     621 </span>            : 
<span class="lineNum">     622 </span>            :     // if the mode is day-of-week-in-month, calculate the day-of-month from it
<span class="lineNum">     623 </span>            :     case DOW_IN_MONTH_MODE:
<span class="lineNum">     624 </span>            :         // In this case ruleDay is the day-of-week-in-month (this code is using
<span class="lineNum">     625 </span>            :         // the dayOfWeek and dayOfMonth parameters to figure out the day-of-week
<span class="lineNum">     626 </span>            :         // of the first day of the month, so it's trusting that they're really
<span class="lineNum">     627 </span>            :         // consistent with each other)
<span class="lineNum">     628 </span><span class="lineNoCov">          0 :         if (ruleDay &gt; 0)</span>
<span class="lineNum">     629 </span><span class="lineNoCov">          0 :             ruleDayOfMonth = 1 + (ruleDay - 1) * 7 +</span>
<span class="lineNum">     630 </span><span class="lineNoCov">          0 :                 (7 + ruleDayOfWeek - (dayOfWeek - dayOfMonth + 1)) % 7;</span>
<span class="lineNum">     631 </span>            :         
<span class="lineNum">     632 </span>            :         // if ruleDay is negative (we assume it's not zero here), we have to do
<span class="lineNum">     633 </span>            :         // the same calculation figuring backward from the last day of the month.
<span class="lineNum">     634 </span>            :         else
<span class="lineNum">     635 </span>            :         {
<span class="lineNum">     636 </span>            :             // (again, this code is trusting that dayOfWeek and dayOfMonth are
<span class="lineNum">     637 </span>            :             // consistent with each other here, since we're using them to figure
<span class="lineNum">     638 </span>            :             // the day of week of the first of the month)
<span class="lineNum">     639 </span><span class="lineNoCov">          0 :             ruleDayOfMonth = monthLen + (ruleDay + 1) * 7 -</span>
<span class="lineNum">     640 </span><span class="lineNoCov">          0 :                 (7 + (dayOfWeek + monthLen - dayOfMonth) - ruleDayOfWeek) % 7;</span>
<span class="lineNum">     641 </span>            :         }
<span class="lineNum">     642 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     643 </span>            : 
<span class="lineNum">     644 </span>            :     case DOW_GE_DOM_MODE:
<span class="lineNum">     645 </span><span class="lineNoCov">          0 :         ruleDayOfMonth = ruleDay +</span>
<span class="lineNum">     646 </span><span class="lineNoCov">          0 :             (49 + ruleDayOfWeek - ruleDay - dayOfWeek + dayOfMonth) % 7;</span>
<span class="lineNum">     647 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     648 </span>            : 
<span class="lineNum">     649 </span>            :     case DOW_LE_DOM_MODE:
<span class="lineNum">     650 </span><span class="lineNoCov">          0 :         ruleDayOfMonth = ruleDay -</span>
<span class="lineNum">     651 </span><span class="lineNoCov">          0 :             (49 - ruleDayOfWeek + ruleDay + dayOfWeek - dayOfMonth) % 7;</span>
<span class="lineNum">     652 </span>            :         // Note at this point ruleDayOfMonth may be &lt;1, although it will
<span class="lineNum">     653 </span>            :         // be &gt;=1 for well-formed rules.
<span class="lineNum">     654 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     655 </span>            :     }
<span class="lineNum">     656 </span>            : 
<span class="lineNum">     657 </span>            :     // now that we have a real day-in-month for the rule, we can compare days...
<span class="lineNum">     658 </span><span class="lineNoCov">          0 :     if (dayOfMonth &lt; ruleDayOfMonth) return -1;</span>
<span class="lineNum">     659 </span><span class="lineNoCov">          0 :     else if (dayOfMonth &gt; ruleDayOfMonth) return 1;</span>
<span class="lineNum">     660 </span>            : 
<span class="lineNum">     661 </span>            :     // ...and if they're equal, we compare times
<span class="lineNum">     662 </span><span class="lineNoCov">          0 :     if (millis &lt; ruleMillis) return -1;</span>
<span class="lineNum">     663 </span><span class="lineNoCov">          0 :     else if (millis &gt; ruleMillis) return 1;</span>
<span class="lineNum">     664 </span><span class="lineNoCov">          0 :     else return 0;</span>
<span class="lineNum">     665 </span>            : }
<span class="lineNum">     666 </span>            : 
<span class="lineNum">     667 </span>            : // -------------------------------------
<a name="668"><span class="lineNum">     668 </span>            : </a>
<span class="lineNum">     669 </span>            : int32_t
<span class="lineNum">     670 </span><span class="lineNoCov">          0 : SimpleTimeZone::getRawOffset() const</span>
<span class="lineNum">     671 </span>            : {
<span class="lineNum">     672 </span><span class="lineNoCov">          0 :     return rawOffset;</span>
<span class="lineNum">     673 </span>            : }
<span class="lineNum">     674 </span>            : 
<span class="lineNum">     675 </span>            : // -------------------------------------
<a name="676"><span class="lineNum">     676 </span>            : </a>
<span class="lineNum">     677 </span>            : void
<span class="lineNum">     678 </span><span class="lineNoCov">          0 : SimpleTimeZone::setRawOffset(int32_t offsetMillis)</span>
<span class="lineNum">     679 </span>            : {
<span class="lineNum">     680 </span><span class="lineNoCov">          0 :     rawOffset = offsetMillis;</span>
<span class="lineNum">     681 </span><span class="lineNoCov">          0 :     transitionRulesInitialized = FALSE;</span>
<span class="lineNum">     682 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     683 </span>            : 
<span class="lineNum">     684 </span>            : // -------------------------------------
<a name="685"><span class="lineNum">     685 </span>            : </a>
<span class="lineNum">     686 </span>            : void 
<span class="lineNum">     687 </span><span class="lineNoCov">          0 : SimpleTimeZone::setDSTSavings(int32_t millisSavedDuringDST, UErrorCode&amp; status) </span>
<span class="lineNum">     688 </span>            : {
<span class="lineNum">     689 </span><span class="lineNoCov">          0 :     if (millisSavedDuringDST &lt;= 0) {</span>
<span class="lineNum">     690 </span><span class="lineNoCov">          0 :         status = U_ILLEGAL_ARGUMENT_ERROR;</span>
<span class="lineNum">     691 </span>            :     }
<span class="lineNum">     692 </span>            :     else {
<span class="lineNum">     693 </span><span class="lineNoCov">          0 :         dstSavings = millisSavedDuringDST;</span>
<span class="lineNum">     694 </span>            :     }
<span class="lineNum">     695 </span><span class="lineNoCov">          0 :     transitionRulesInitialized = FALSE;</span>
<span class="lineNum">     696 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     697 </span>            : 
<span class="lineNum">     698 </span>            : // -------------------------------------
<a name="699"><span class="lineNum">     699 </span>            : </a>
<span class="lineNum">     700 </span>            : int32_t 
<span class="lineNum">     701 </span><span class="lineNoCov">          0 : SimpleTimeZone::getDSTSavings() const</span>
<span class="lineNum">     702 </span>            : {
<span class="lineNum">     703 </span><span class="lineNoCov">          0 :     return dstSavings;</span>
<span class="lineNum">     704 </span>            : }
<span class="lineNum">     705 </span>            : 
<span class="lineNum">     706 </span>            : // -------------------------------------
<a name="707"><span class="lineNum">     707 </span>            : </a>
<span class="lineNum">     708 </span>            : UBool
<span class="lineNum">     709 </span><span class="lineNoCov">          0 : SimpleTimeZone::useDaylightTime() const</span>
<span class="lineNum">     710 </span>            : {
<span class="lineNum">     711 </span><span class="lineNoCov">          0 :     return useDaylight;</span>
<span class="lineNum">     712 </span>            : }
<span class="lineNum">     713 </span>            : 
<span class="lineNum">     714 </span>            : // -------------------------------------
<span class="lineNum">     715 </span>            : 
<span class="lineNum">     716 </span>            : /**
<span class="lineNum">     717 </span>            :  * Overrides TimeZone
<a name="718"><span class="lineNum">     718 </span>            :  * Queries if the given date is in Daylight Savings Time.</a>
<span class="lineNum">     719 </span>            :  */
<span class="lineNum">     720 </span><span class="lineNoCov">          0 : UBool SimpleTimeZone::inDaylightTime(UDate date, UErrorCode&amp; status) const</span>
<span class="lineNum">     721 </span>            : {
<span class="lineNum">     722 </span>            :     // This method is wasteful since it creates a new GregorianCalendar and
<span class="lineNum">     723 </span>            :     // deletes it each time it is called.  However, this is a deprecated method
<span class="lineNum">     724 </span>            :     // and provided only for Java compatibility as of 8/6/97 [LIU].
<span class="lineNum">     725 </span><span class="lineNoCov">          0 :     if (U_FAILURE(status)) return FALSE;</span>
<span class="lineNum">     726 </span><span class="lineNoCov">          0 :     GregorianCalendar *gc = new GregorianCalendar(*this, status);</span>
<span class="lineNum">     727 </span>            :     /* test for NULL */
<span class="lineNum">     728 </span><span class="lineNoCov">          0 :     if (gc == 0) {</span>
<span class="lineNum">     729 </span><span class="lineNoCov">          0 :         status = U_MEMORY_ALLOCATION_ERROR;</span>
<span class="lineNum">     730 </span><span class="lineNoCov">          0 :         return FALSE;</span>
<span class="lineNum">     731 </span>            :     }
<span class="lineNum">     732 </span><span class="lineNoCov">          0 :     gc-&gt;setTime(date, status);</span>
<span class="lineNum">     733 </span><span class="lineNoCov">          0 :     UBool result = gc-&gt;inDaylightTime(status);</span>
<span class="lineNum">     734 </span><span class="lineNoCov">          0 :     delete gc;</span>
<span class="lineNum">     735 </span><span class="lineNoCov">          0 :     return result;</span>
<span class="lineNum">     736 </span>            : }
<span class="lineNum">     737 </span>            : 
<span class="lineNum">     738 </span>            : // -------------------------------------
<span class="lineNum">     739 </span>            : 
<span class="lineNum">     740 </span>            : /**
<span class="lineNum">     741 </span>            :  * Return true if this zone has the same rules and offset as another zone.
<span class="lineNum">     742 </span>            :  * @param other the TimeZone object to be compared with
<span class="lineNum">     743 </span>            :  * @return true if the given zone has the same rules and offset as this one
<a name="744"><span class="lineNum">     744 </span>            :  */</a>
<span class="lineNum">     745 </span>            : UBool 
<span class="lineNum">     746 </span><span class="lineNoCov">          0 : SimpleTimeZone::hasSameRules(const TimeZone&amp; other) const</span>
<span class="lineNum">     747 </span>            : {
<span class="lineNum">     748 </span><span class="lineNoCov">          0 :     if (this == &amp;other) return TRUE;</span>
<span class="lineNum">     749 </span><span class="lineNoCov">          0 :     if (typeid(*this) != typeid(other)) return FALSE;</span>
<span class="lineNum">     750 </span><span class="lineNoCov">          0 :     SimpleTimeZone *that = (SimpleTimeZone*)&amp;other;</span>
<span class="lineNum">     751 </span><span class="lineNoCov">          0 :     return rawOffset     == that-&gt;rawOffset &amp;&amp;</span>
<span class="lineNum">     752 </span><span class="lineNoCov">          0 :         useDaylight     == that-&gt;useDaylight &amp;&amp;</span>
<span class="lineNum">     753 </span><span class="lineNoCov">          0 :         (!useDaylight</span>
<span class="lineNum">     754 </span>            :          // Only check rules if using DST
<span class="lineNum">     755 </span><span class="lineNoCov">          0 :          || (dstSavings     == that-&gt;dstSavings &amp;&amp;</span>
<span class="lineNum">     756 </span><span class="lineNoCov">          0 :              startMode      == that-&gt;startMode &amp;&amp;</span>
<span class="lineNum">     757 </span><span class="lineNoCov">          0 :              startMonth     == that-&gt;startMonth &amp;&amp;</span>
<span class="lineNum">     758 </span><span class="lineNoCov">          0 :              startDay       == that-&gt;startDay &amp;&amp;</span>
<span class="lineNum">     759 </span><span class="lineNoCov">          0 :              startDayOfWeek == that-&gt;startDayOfWeek &amp;&amp;</span>
<span class="lineNum">     760 </span><span class="lineNoCov">          0 :              startTime      == that-&gt;startTime &amp;&amp;</span>
<span class="lineNum">     761 </span><span class="lineNoCov">          0 :              startTimeMode  == that-&gt;startTimeMode &amp;&amp;</span>
<span class="lineNum">     762 </span><span class="lineNoCov">          0 :              endMode        == that-&gt;endMode &amp;&amp;</span>
<span class="lineNum">     763 </span><span class="lineNoCov">          0 :              endMonth       == that-&gt;endMonth &amp;&amp;</span>
<span class="lineNum">     764 </span><span class="lineNoCov">          0 :              endDay         == that-&gt;endDay &amp;&amp;</span>
<span class="lineNum">     765 </span><span class="lineNoCov">          0 :              endDayOfWeek   == that-&gt;endDayOfWeek &amp;&amp;</span>
<span class="lineNum">     766 </span><span class="lineNoCov">          0 :              endTime        == that-&gt;endTime &amp;&amp;</span>
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :              endTimeMode    == that-&gt;endTimeMode &amp;&amp;</span>
<span class="lineNum">     768 </span><span class="lineNoCov">          0 :              startYear      == that-&gt;startYear));</span>
<span class="lineNum">     769 </span>            : }
<span class="lineNum">     770 </span>            : 
<span class="lineNum">     771 </span>            : // -------------------------------------
<span class="lineNum">     772 </span>            : 
<span class="lineNum">     773 </span>            : //----------------------------------------------------------------------
<span class="lineNum">     774 </span>            : // Rule representation
<span class="lineNum">     775 </span>            : //
<span class="lineNum">     776 </span>            : // We represent the following flavors of rules:
<span class="lineNum">     777 </span>            : //       5        the fifth of the month
<span class="lineNum">     778 </span>            : //       lastSun  the last Sunday in the month
<span class="lineNum">     779 </span>            : //       lastMon  the last Monday in the month
<span class="lineNum">     780 </span>            : //       Sun&gt;=8   first Sunday on or after the eighth
<span class="lineNum">     781 </span>            : //       Sun&lt;=25  last Sunday on or before the 25th
<span class="lineNum">     782 </span>            : // This is further complicated by the fact that we need to remain
<span class="lineNum">     783 </span>            : // backward compatible with the 1.1 FCS.  Finally, we need to minimize
<span class="lineNum">     784 </span>            : // API changes.  In order to satisfy these requirements, we support
<span class="lineNum">     785 </span>            : // three representation systems, and we translate between them.
<span class="lineNum">     786 </span>            : //
<span class="lineNum">     787 </span>            : // INTERNAL REPRESENTATION
<span class="lineNum">     788 </span>            : // This is the format SimpleTimeZone objects take after construction or
<span class="lineNum">     789 </span>            : // streaming in is complete.  Rules are represented directly, using an
<span class="lineNum">     790 </span>            : // unencoded format.  We will discuss the start rule only below; the end
<span class="lineNum">     791 </span>            : // rule is analogous.
<span class="lineNum">     792 </span>            : //   startMode      Takes on enumerated values DAY_OF_MONTH,
<span class="lineNum">     793 </span>            : //                  DOW_IN_MONTH, DOW_AFTER_DOM, or DOW_BEFORE_DOM.
<span class="lineNum">     794 </span>            : //   startDay       The day of the month, or for DOW_IN_MONTH mode, a
<span class="lineNum">     795 </span>            : //                  value indicating which DOW, such as +1 for first,
<span class="lineNum">     796 </span>            : //                  +2 for second, -1 for last, etc.
<span class="lineNum">     797 </span>            : //   startDayOfWeek The day of the week.  Ignored for DAY_OF_MONTH.
<span class="lineNum">     798 </span>            : //
<span class="lineNum">     799 </span>            : // ENCODED REPRESENTATION
<span class="lineNum">     800 </span>            : // This is the format accepted by the constructor and by setStartRule()
<span class="lineNum">     801 </span>            : // and setEndRule().  It uses various combinations of positive, negative,
<span class="lineNum">     802 </span>            : // and zero values to encode the different rules.  This representation
<span class="lineNum">     803 </span>            : // allows us to specify all the different rule flavors without altering
<span class="lineNum">     804 </span>            : // the API.
<span class="lineNum">     805 </span>            : //   MODE              startMonth    startDay    startDayOfWeek
<span class="lineNum">     806 </span>            : //   DOW_IN_MONTH_MODE &gt;=0           !=0         &gt;0
<span class="lineNum">     807 </span>            : //   DOM_MODE          &gt;=0           &gt;0          ==0
<span class="lineNum">     808 </span>            : //   DOW_GE_DOM_MODE   &gt;=0           &gt;0          &lt;0
<span class="lineNum">     809 </span>            : //   DOW_LE_DOM_MODE   &gt;=0           &lt;0          &lt;0
<span class="lineNum">     810 </span>            : //   (no DST)          don't care    ==0         don't care
<span class="lineNum">     811 </span>            : //
<span class="lineNum">     812 </span>            : // STREAMED REPRESENTATION
<span class="lineNum">     813 </span>            : // We must retain binary compatibility with the 1.1 FCS.  The 1.1 code only
<span class="lineNum">     814 </span>            : // handles DOW_IN_MONTH_MODE and non-DST mode, the latter indicated by the
<span class="lineNum">     815 </span>            : // flag useDaylight.  When we stream an object out, we translate into an
<span class="lineNum">     816 </span>            : // approximate DOW_IN_MONTH_MODE representation so the object can be parsed
<span class="lineNum">     817 </span>            : // and used by 1.1 code.  Following that, we write out the full
<span class="lineNum">     818 </span>            : // representation separately so that contemporary code can recognize and
<span class="lineNum">     819 </span>            : // parse it.  The full representation is written in a &quot;packed&quot; format,
<span class="lineNum">     820 </span>            : // consisting of a version number, a length, and an array of bytes.  Future
<span class="lineNum">     821 </span>            : // versions of this class may specify different versions.  If they wish to
<span class="lineNum">     822 </span>            : // include additional data, they should do so by storing them after the
<span class="lineNum">     823 </span>            : // packed representation below.
<span class="lineNum">     824 </span>            : //----------------------------------------------------------------------
<span class="lineNum">     825 </span>            : 
<span class="lineNum">     826 </span>            : /**
<span class="lineNum">     827 </span>            :  * Given a set of encoded rules in startDay and startDayOfMonth, decode
<span class="lineNum">     828 </span>            :  * them and set the startMode appropriately.  Do the same for endDay and
<span class="lineNum">     829 </span>            :  * endDayOfMonth.  Upon entry, the day of week variables may be zero or
<span class="lineNum">     830 </span>            :  * negative, in order to indicate special modes.  The day of month
<span class="lineNum">     831 </span>            :  * variables may also be negative.  Upon exit, the mode variables will be
<span class="lineNum">     832 </span>            :  * set, and the day of week and day of month variables will be positive.
<span class="lineNum">     833 </span>            :  * This method also recognizes a startDay or endDay of zero as indicating
<span class="lineNum">     834 </span>            :  * no DST.
<a name="835"><span class="lineNum">     835 </span>            :  */</a>
<span class="lineNum">     836 </span>            : void 
<span class="lineNum">     837 </span><span class="lineNoCov">          0 : SimpleTimeZone::decodeRules(UErrorCode&amp; status)</span>
<span class="lineNum">     838 </span>            : {
<span class="lineNum">     839 </span><span class="lineNoCov">          0 :     decodeStartRule(status);</span>
<span class="lineNum">     840 </span><span class="lineNoCov">          0 :     decodeEndRule(status);</span>
<span class="lineNum">     841 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     842 </span>            : 
<span class="lineNum">     843 </span>            : /**
<span class="lineNum">     844 </span>            :  * Decode the start rule and validate the parameters.  The parameters are
<span class="lineNum">     845 </span>            :  * expected to be in encoded form, which represents the various rule modes
<span class="lineNum">     846 </span>            :  * by negating or zeroing certain values.  Representation formats are:
<span class="lineNum">     847 </span>            :  * &lt;p&gt;
<span class="lineNum">     848 </span>            :  * &lt;pre&gt;
<span class="lineNum">     849 </span>            :  *            DOW_IN_MONTH  DOM    DOW&gt;=DOM  DOW&lt;=DOM  no DST
<span class="lineNum">     850 </span>            :  *            ------------  -----  --------  --------  ----------
<span class="lineNum">     851 </span>            :  * month       0..11        same    same      same     don't care
<span class="lineNum">     852 </span>            :  * day        -5..5         1..31   1..31    -1..-31   0
<span class="lineNum">     853 </span>            :  * dayOfWeek   1..7         0      -1..-7    -1..-7    don't care
<span class="lineNum">     854 </span>            :  * time        0..ONEDAY    same    same      same     don't care
<span class="lineNum">     855 </span>            :  * &lt;/pre&gt;
<span class="lineNum">     856 </span>            :  * The range for month does not include UNDECIMBER since this class is
<span class="lineNum">     857 </span>            :  * really specific to GregorianCalendar, which does not use that month.
<span class="lineNum">     858 </span>            :  * The range for time includes ONEDAY (vs. ending at ONEDAY-1) because the
<span class="lineNum">     859 </span>            :  * end rule is an exclusive limit point.  That is, the range of times that
<span class="lineNum">     860 </span>            :  * are in DST include those &gt;= the start and &lt; the end.  For this reason,
<span class="lineNum">     861 </span>            :  * it should be possible to specify an end of ONEDAY in order to include the
<span class="lineNum">     862 </span>            :  * entire day.  Although this is equivalent to time 0 of the following day,
<span class="lineNum">     863 </span>            :  * it's not always possible to specify that, for example, on December 31.
<span class="lineNum">     864 </span>            :  * While arguably the start range should still be 0..ONEDAY-1, we keep
<span class="lineNum">     865 </span>            :  * the start and end ranges the same for consistency.
<a name="866"><span class="lineNum">     866 </span>            :  */</a>
<span class="lineNum">     867 </span>            : void 
<span class="lineNum">     868 </span><span class="lineNoCov">          0 : SimpleTimeZone::decodeStartRule(UErrorCode&amp; status) </span>
<span class="lineNum">     869 </span>            : {
<span class="lineNum">     870 </span><span class="lineNoCov">          0 :     if(U_FAILURE(status)) return;</span>
<span class="lineNum">     871 </span>            : 
<span class="lineNum">     872 </span><span class="lineNoCov">          0 :     useDaylight = (UBool)((startDay != 0) &amp;&amp; (endDay != 0) ? TRUE : FALSE);</span>
<span class="lineNum">     873 </span><span class="lineNoCov">          0 :     if (useDaylight &amp;&amp; dstSavings == 0) {</span>
<span class="lineNum">     874 </span><span class="lineNoCov">          0 :         dstSavings = U_MILLIS_PER_HOUR;</span>
<span class="lineNum">     875 </span>            :     }
<span class="lineNum">     876 </span><span class="lineNoCov">          0 :     if (startDay != 0) {</span>
<span class="lineNum">     877 </span><span class="lineNoCov">          0 :         if (startMonth &lt; UCAL_JANUARY || startMonth &gt; UCAL_DECEMBER) {</span>
<span class="lineNum">     878 </span><span class="lineNoCov">          0 :             status = U_ILLEGAL_ARGUMENT_ERROR;</span>
<span class="lineNum">     879 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">     880 </span>            :         }
<span class="lineNum">     881 </span><span class="lineNoCov">          0 :         if (startTime &lt; 0 || startTime &gt; U_MILLIS_PER_DAY ||</span>
<span class="lineNum">     882 </span><span class="lineNoCov">          0 :             startTimeMode &lt; WALL_TIME || startTimeMode &gt; UTC_TIME) {</span>
<span class="lineNum">     883 </span><span class="lineNoCov">          0 :             status = U_ILLEGAL_ARGUMENT_ERROR;</span>
<span class="lineNum">     884 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">     885 </span>            :         }
<span class="lineNum">     886 </span><span class="lineNoCov">          0 :         if (startDayOfWeek == 0) {</span>
<span class="lineNum">     887 </span><span class="lineNoCov">          0 :             startMode = DOM_MODE;</span>
<span class="lineNum">     888 </span>            :         } else {
<span class="lineNum">     889 </span><span class="lineNoCov">          0 :             if (startDayOfWeek &gt; 0) {</span>
<span class="lineNum">     890 </span><span class="lineNoCov">          0 :                 startMode = DOW_IN_MONTH_MODE;</span>
<span class="lineNum">     891 </span>            :             } else {
<span class="lineNum">     892 </span><span class="lineNoCov">          0 :                 startDayOfWeek = (int8_t)-startDayOfWeek;</span>
<span class="lineNum">     893 </span><span class="lineNoCov">          0 :                 if (startDay &gt; 0) {</span>
<span class="lineNum">     894 </span><span class="lineNoCov">          0 :                     startMode = DOW_GE_DOM_MODE;</span>
<span class="lineNum">     895 </span>            :                 } else {
<span class="lineNum">     896 </span><span class="lineNoCov">          0 :                     startDay = (int8_t)-startDay;</span>
<span class="lineNum">     897 </span><span class="lineNoCov">          0 :                     startMode = DOW_LE_DOM_MODE;</span>
<span class="lineNum">     898 </span>            :                 }
<span class="lineNum">     899 </span>            :             }
<span class="lineNum">     900 </span><span class="lineNoCov">          0 :             if (startDayOfWeek &gt; UCAL_SATURDAY) {</span>
<span class="lineNum">     901 </span><span class="lineNoCov">          0 :                 status = U_ILLEGAL_ARGUMENT_ERROR;</span>
<span class="lineNum">     902 </span><span class="lineNoCov">          0 :                 return;</span>
<span class="lineNum">     903 </span>            :             }
<span class="lineNum">     904 </span>            :         }
<span class="lineNum">     905 </span><span class="lineNoCov">          0 :         if (startMode == DOW_IN_MONTH_MODE) {</span>
<span class="lineNum">     906 </span><span class="lineNoCov">          0 :             if (startDay &lt; -5 || startDay &gt; 5) {</span>
<span class="lineNum">     907 </span><span class="lineNoCov">          0 :                 status = U_ILLEGAL_ARGUMENT_ERROR;</span>
<span class="lineNum">     908 </span><span class="lineNoCov">          0 :                 return;</span>
<span class="lineNum">     909 </span>            :             }
<span class="lineNum">     910 </span><span class="lineNoCov">          0 :         } else if (startDay&lt;1 || startDay &gt; STATICMONTHLENGTH[startMonth]) {</span>
<span class="lineNum">     911 </span><span class="lineNoCov">          0 :             status = U_ILLEGAL_ARGUMENT_ERROR;</span>
<span class="lineNum">     912 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">     913 </span>            :         }
<span class="lineNum">     914 </span>            :     }
<span class="lineNum">     915 </span>            : }
<span class="lineNum">     916 </span>            : 
<span class="lineNum">     917 </span>            : /**
<span class="lineNum">     918 </span>            :  * Decode the end rule and validate the parameters.  This method is exactly
<span class="lineNum">     919 </span>            :  * analogous to decodeStartRule().
<span class="lineNum">     920 </span>            :  * @see decodeStartRule
<a name="921"><span class="lineNum">     921 </span>            :  */</a>
<span class="lineNum">     922 </span>            : void 
<span class="lineNum">     923 </span><span class="lineNoCov">          0 : SimpleTimeZone::decodeEndRule(UErrorCode&amp; status) </span>
<span class="lineNum">     924 </span>            : {
<span class="lineNum">     925 </span><span class="lineNoCov">          0 :     if(U_FAILURE(status)) return;</span>
<span class="lineNum">     926 </span>            : 
<span class="lineNum">     927 </span><span class="lineNoCov">          0 :     useDaylight = (UBool)((startDay != 0) &amp;&amp; (endDay != 0) ? TRUE : FALSE);</span>
<span class="lineNum">     928 </span><span class="lineNoCov">          0 :     if (useDaylight &amp;&amp; dstSavings == 0) {</span>
<span class="lineNum">     929 </span><span class="lineNoCov">          0 :         dstSavings = U_MILLIS_PER_HOUR;</span>
<span class="lineNum">     930 </span>            :     }
<span class="lineNum">     931 </span><span class="lineNoCov">          0 :     if (endDay != 0) {</span>
<span class="lineNum">     932 </span><span class="lineNoCov">          0 :         if (endMonth &lt; UCAL_JANUARY || endMonth &gt; UCAL_DECEMBER) {</span>
<span class="lineNum">     933 </span><span class="lineNoCov">          0 :             status = U_ILLEGAL_ARGUMENT_ERROR;</span>
<span class="lineNum">     934 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">     935 </span>            :         }
<span class="lineNum">     936 </span><span class="lineNoCov">          0 :         if (endTime &lt; 0 || endTime &gt; U_MILLIS_PER_DAY ||</span>
<span class="lineNum">     937 </span><span class="lineNoCov">          0 :             endTimeMode &lt; WALL_TIME || endTimeMode &gt; UTC_TIME) {</span>
<span class="lineNum">     938 </span><span class="lineNoCov">          0 :             status = U_ILLEGAL_ARGUMENT_ERROR;</span>
<span class="lineNum">     939 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">     940 </span>            :         }
<span class="lineNum">     941 </span><span class="lineNoCov">          0 :         if (endDayOfWeek == 0) {</span>
<span class="lineNum">     942 </span><span class="lineNoCov">          0 :             endMode = DOM_MODE;</span>
<span class="lineNum">     943 </span>            :         } else {
<span class="lineNum">     944 </span><span class="lineNoCov">          0 :             if (endDayOfWeek &gt; 0) {</span>
<span class="lineNum">     945 </span><span class="lineNoCov">          0 :                 endMode = DOW_IN_MONTH_MODE;</span>
<span class="lineNum">     946 </span>            :             } else {
<span class="lineNum">     947 </span><span class="lineNoCov">          0 :                 endDayOfWeek = (int8_t)-endDayOfWeek;</span>
<span class="lineNum">     948 </span><span class="lineNoCov">          0 :                 if (endDay &gt; 0) {</span>
<span class="lineNum">     949 </span><span class="lineNoCov">          0 :                     endMode = DOW_GE_DOM_MODE;</span>
<span class="lineNum">     950 </span>            :                 } else {
<span class="lineNum">     951 </span><span class="lineNoCov">          0 :                     endDay = (int8_t)-endDay;</span>
<span class="lineNum">     952 </span><span class="lineNoCov">          0 :                     endMode = DOW_LE_DOM_MODE;</span>
<span class="lineNum">     953 </span>            :                 }
<span class="lineNum">     954 </span>            :             }
<span class="lineNum">     955 </span><span class="lineNoCov">          0 :             if (endDayOfWeek &gt; UCAL_SATURDAY) {</span>
<span class="lineNum">     956 </span><span class="lineNoCov">          0 :                 status = U_ILLEGAL_ARGUMENT_ERROR;</span>
<span class="lineNum">     957 </span><span class="lineNoCov">          0 :                 return;</span>
<span class="lineNum">     958 </span>            :             }
<span class="lineNum">     959 </span>            :         }
<span class="lineNum">     960 </span><span class="lineNoCov">          0 :         if (endMode == DOW_IN_MONTH_MODE) {</span>
<span class="lineNum">     961 </span><span class="lineNoCov">          0 :             if (endDay &lt; -5 || endDay &gt; 5) {</span>
<span class="lineNum">     962 </span><span class="lineNoCov">          0 :                 status = U_ILLEGAL_ARGUMENT_ERROR;</span>
<span class="lineNum">     963 </span><span class="lineNoCov">          0 :                 return;</span>
<span class="lineNum">     964 </span>            :             }
<span class="lineNum">     965 </span><span class="lineNoCov">          0 :         } else if (endDay&lt;1 || endDay &gt; STATICMONTHLENGTH[endMonth]) {</span>
<span class="lineNum">     966 </span><span class="lineNoCov">          0 :             status = U_ILLEGAL_ARGUMENT_ERROR;</span>
<span class="lineNum">     967 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">     968 </span>            :         }
<span class="lineNum">     969 </span>            :     }
<span class="lineNum">     970 </span>            : }
<a name="971"><span class="lineNum">     971 </span>            : </a>
<span class="lineNum">     972 </span>            : UBool
<span class="lineNum">     973 </span><span class="lineNoCov">          0 : SimpleTimeZone::getNextTransition(UDate base, UBool inclusive, TimeZoneTransition&amp; result) const {</span>
<span class="lineNum">     974 </span><span class="lineNoCov">          0 :     if (!useDaylight) {</span>
<span class="lineNum">     975 </span><span class="lineNoCov">          0 :         return FALSE;</span>
<span class="lineNum">     976 </span>            :     }
<span class="lineNum">     977 </span>            : 
<span class="lineNum">     978 </span><span class="lineNoCov">          0 :     UErrorCode status = U_ZERO_ERROR;</span>
<span class="lineNum">     979 </span><span class="lineNoCov">          0 :     checkTransitionRules(status);</span>
<span class="lineNum">     980 </span><span class="lineNoCov">          0 :     if (U_FAILURE(status)) {</span>
<span class="lineNum">     981 </span><span class="lineNoCov">          0 :         return FALSE;</span>
<span class="lineNum">     982 </span>            :     }
<span class="lineNum">     983 </span>            : 
<span class="lineNum">     984 </span><span class="lineNoCov">          0 :     UDate firstTransitionTime = firstTransition-&gt;getTime();</span>
<span class="lineNum">     985 </span><span class="lineNoCov">          0 :     if (base &lt; firstTransitionTime || (inclusive &amp;&amp; base == firstTransitionTime)) {</span>
<span class="lineNum">     986 </span><span class="lineNoCov">          0 :         result = *firstTransition;</span>
<span class="lineNum">     987 </span>            :     }
<span class="lineNum">     988 </span>            :     UDate stdDate, dstDate;
<span class="lineNum">     989 </span><span class="lineNoCov">          0 :     UBool stdAvail = stdRule-&gt;getNextStart(base, dstRule-&gt;getRawOffset(), dstRule-&gt;getDSTSavings(), inclusive, stdDate);</span>
<span class="lineNum">     990 </span><span class="lineNoCov">          0 :     UBool dstAvail = dstRule-&gt;getNextStart(base, stdRule-&gt;getRawOffset(), stdRule-&gt;getDSTSavings(), inclusive, dstDate);</span>
<span class="lineNum">     991 </span><span class="lineNoCov">          0 :     if (stdAvail &amp;&amp; (!dstAvail || stdDate &lt; dstDate)) {</span>
<span class="lineNum">     992 </span><span class="lineNoCov">          0 :         result.setTime(stdDate);</span>
<span class="lineNum">     993 </span><span class="lineNoCov">          0 :         result.setFrom((const TimeZoneRule&amp;)*dstRule);</span>
<span class="lineNum">     994 </span><span class="lineNoCov">          0 :         result.setTo((const TimeZoneRule&amp;)*stdRule);</span>
<span class="lineNum">     995 </span><span class="lineNoCov">          0 :         return TRUE;</span>
<span class="lineNum">     996 </span>            :     }
<span class="lineNum">     997 </span><span class="lineNoCov">          0 :     if (dstAvail &amp;&amp; (!stdAvail || dstDate &lt; stdDate)) {</span>
<span class="lineNum">     998 </span><span class="lineNoCov">          0 :         result.setTime(dstDate);</span>
<span class="lineNum">     999 </span><span class="lineNoCov">          0 :         result.setFrom((const TimeZoneRule&amp;)*stdRule);</span>
<span class="lineNum">    1000 </span><span class="lineNoCov">          0 :         result.setTo((const TimeZoneRule&amp;)*dstRule);</span>
<span class="lineNum">    1001 </span><span class="lineNoCov">          0 :         return TRUE;</span>
<span class="lineNum">    1002 </span>            :     }
<span class="lineNum">    1003 </span><span class="lineNoCov">          0 :     return FALSE;</span>
<span class="lineNum">    1004 </span>            : }
<a name="1005"><span class="lineNum">    1005 </span>            : </a>
<span class="lineNum">    1006 </span>            : UBool
<span class="lineNum">    1007 </span><span class="lineNoCov">          0 : SimpleTimeZone::getPreviousTransition(UDate base, UBool inclusive, TimeZoneTransition&amp; result) const {</span>
<span class="lineNum">    1008 </span><span class="lineNoCov">          0 :     if (!useDaylight) {</span>
<span class="lineNum">    1009 </span><span class="lineNoCov">          0 :         return FALSE;</span>
<span class="lineNum">    1010 </span>            :     }
<span class="lineNum">    1011 </span>            : 
<span class="lineNum">    1012 </span><span class="lineNoCov">          0 :     UErrorCode status = U_ZERO_ERROR;</span>
<span class="lineNum">    1013 </span><span class="lineNoCov">          0 :     checkTransitionRules(status);</span>
<span class="lineNum">    1014 </span><span class="lineNoCov">          0 :     if (U_FAILURE(status)) {</span>
<span class="lineNum">    1015 </span><span class="lineNoCov">          0 :         return FALSE;</span>
<span class="lineNum">    1016 </span>            :     }
<span class="lineNum">    1017 </span>            : 
<span class="lineNum">    1018 </span><span class="lineNoCov">          0 :     UDate firstTransitionTime = firstTransition-&gt;getTime();</span>
<span class="lineNum">    1019 </span><span class="lineNoCov">          0 :     if (base &lt; firstTransitionTime || (!inclusive &amp;&amp; base == firstTransitionTime)) {</span>
<span class="lineNum">    1020 </span><span class="lineNoCov">          0 :         return FALSE;</span>
<span class="lineNum">    1021 </span>            :     }
<span class="lineNum">    1022 </span>            :     UDate stdDate, dstDate;
<span class="lineNum">    1023 </span><span class="lineNoCov">          0 :     UBool stdAvail = stdRule-&gt;getPreviousStart(base, dstRule-&gt;getRawOffset(), dstRule-&gt;getDSTSavings(), inclusive, stdDate);</span>
<span class="lineNum">    1024 </span><span class="lineNoCov">          0 :     UBool dstAvail = dstRule-&gt;getPreviousStart(base, stdRule-&gt;getRawOffset(), stdRule-&gt;getDSTSavings(), inclusive, dstDate);</span>
<span class="lineNum">    1025 </span><span class="lineNoCov">          0 :     if (stdAvail &amp;&amp; (!dstAvail || stdDate &gt; dstDate)) {</span>
<span class="lineNum">    1026 </span><span class="lineNoCov">          0 :         result.setTime(stdDate);</span>
<span class="lineNum">    1027 </span><span class="lineNoCov">          0 :         result.setFrom((const TimeZoneRule&amp;)*dstRule);</span>
<span class="lineNum">    1028 </span><span class="lineNoCov">          0 :         result.setTo((const TimeZoneRule&amp;)*stdRule);</span>
<span class="lineNum">    1029 </span><span class="lineNoCov">          0 :         return TRUE;</span>
<span class="lineNum">    1030 </span>            :     }
<span class="lineNum">    1031 </span><span class="lineNoCov">          0 :     if (dstAvail &amp;&amp; (!stdAvail || dstDate &gt; stdDate)) {</span>
<span class="lineNum">    1032 </span><span class="lineNoCov">          0 :         result.setTime(dstDate);</span>
<span class="lineNum">    1033 </span><span class="lineNoCov">          0 :         result.setFrom((const TimeZoneRule&amp;)*stdRule);</span>
<span class="lineNum">    1034 </span><span class="lineNoCov">          0 :         result.setTo((const TimeZoneRule&amp;)*dstRule);</span>
<span class="lineNum">    1035 </span><span class="lineNoCov">          0 :         return TRUE;</span>
<span class="lineNum">    1036 </span>            :     }
<span class="lineNum">    1037 </span><span class="lineNoCov">          0 :     return FALSE;</span>
<span class="lineNum">    1038 </span>            : }
<a name="1039"><span class="lineNum">    1039 </span>            : </a>
<span class="lineNum">    1040 </span>            : void
<span class="lineNum">    1041 </span><span class="lineNoCov">          0 : SimpleTimeZone::clearTransitionRules(void) {</span>
<span class="lineNum">    1042 </span><span class="lineNoCov">          0 :     initialRule = NULL;</span>
<span class="lineNum">    1043 </span><span class="lineNoCov">          0 :     firstTransition = NULL;</span>
<span class="lineNum">    1044 </span><span class="lineNoCov">          0 :     stdRule = NULL;</span>
<span class="lineNum">    1045 </span><span class="lineNoCov">          0 :     dstRule = NULL;</span>
<span class="lineNum">    1046 </span><span class="lineNoCov">          0 :     transitionRulesInitialized = FALSE;</span>
<span class="lineNum">    1047 </span><span class="lineNoCov">          0 : }</span>
<a name="1048"><span class="lineNum">    1048 </span>            : </a>
<span class="lineNum">    1049 </span>            : void
<span class="lineNum">    1050 </span><span class="lineNoCov">          0 : SimpleTimeZone::deleteTransitionRules(void) {</span>
<span class="lineNum">    1051 </span><span class="lineNoCov">          0 :     if (initialRule != NULL) {</span>
<span class="lineNum">    1052 </span><span class="lineNoCov">          0 :         delete initialRule;</span>
<span class="lineNum">    1053 </span>            :     }
<span class="lineNum">    1054 </span><span class="lineNoCov">          0 :     if (firstTransition != NULL) {</span>
<span class="lineNum">    1055 </span><span class="lineNoCov">          0 :         delete firstTransition;</span>
<span class="lineNum">    1056 </span>            :     }
<span class="lineNum">    1057 </span><span class="lineNoCov">          0 :     if (stdRule != NULL) {</span>
<span class="lineNum">    1058 </span><span class="lineNoCov">          0 :         delete stdRule;</span>
<span class="lineNum">    1059 </span>            :     }
<span class="lineNum">    1060 </span><span class="lineNoCov">          0 :     if (dstRule != NULL) {</span>
<span class="lineNum">    1061 </span><span class="lineNoCov">          0 :         delete dstRule;</span>
<span class="lineNum">    1062 </span>            :     }
<span class="lineNum">    1063 </span><span class="lineNoCov">          0 :     clearTransitionRules();</span>
<span class="lineNum">    1064 </span><span class="lineNoCov">          0 :  }</span>
<span class="lineNum">    1065 </span>            : 
<span class="lineNum">    1066 </span>            : /*
<span class="lineNum">    1067 </span>            :  * Lazy transition rules initializer
<span class="lineNum">    1068 </span>            :  *
<span class="lineNum">    1069 </span>            :  *    Note On the removal of UMTX_CHECK from checkTransitionRules():
<span class="lineNum">    1070 </span>            :  *
<span class="lineNum">    1071 </span>            :  *         It would be faster to have a UInitOnce as part of a SimpleTimeZone object,
<span class="lineNum">    1072 </span>            :  *         which would avoid needing to lock a mutex to check the initialization state.
<span class="lineNum">    1073 </span>            :  *         But we can't easily because simpletz.h is a public header, and including
<span class="lineNum">    1074 </span>            :  *         a UInitOnce as a member of SimpleTimeZone would publicly expose internal ICU headers.
<span class="lineNum">    1075 </span>            :  *
<span class="lineNum">    1076 </span>            :  *         Alternatively we could have a pointer to a UInitOnce in the SimpleTimeZone object,
<span class="lineNum">    1077 </span>            :  *         allocate it in the constructors. This would be a more intrusive change, but doable
<span class="lineNum">    1078 </span>            :  *         if performance turns out to be an issue.
<span class="lineNum">    1079 </span>            :  */
<span class="lineNum">    1080 </span>            : static UMutex gLock = U_MUTEX_INITIALIZER;
<a name="1081"><span class="lineNum">    1081 </span>            : </a>
<span class="lineNum">    1082 </span>            : void
<span class="lineNum">    1083 </span><span class="lineNoCov">          0 : SimpleTimeZone::checkTransitionRules(UErrorCode&amp; status) const {</span>
<span class="lineNum">    1084 </span><span class="lineNoCov">          0 :     if (U_FAILURE(status)) {</span>
<span class="lineNum">    1085 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    1086 </span>            :     }
<span class="lineNum">    1087 </span><span class="lineNoCov">          0 :     umtx_lock(&amp;gLock);</span>
<span class="lineNum">    1088 </span><span class="lineNoCov">          0 :     if (!transitionRulesInitialized) {</span>
<span class="lineNum">    1089 </span><span class="lineNoCov">          0 :         SimpleTimeZone *ncThis = const_cast&lt;SimpleTimeZone*&gt;(this);</span>
<span class="lineNum">    1090 </span><span class="lineNoCov">          0 :         ncThis-&gt;initTransitionRules(status);</span>
<span class="lineNum">    1091 </span>            :     }
<span class="lineNum">    1092 </span><span class="lineNoCov">          0 :     umtx_unlock(&amp;gLock);</span>
<span class="lineNum">    1093 </span>            : }
<a name="1094"><span class="lineNum">    1094 </span>            : </a>
<span class="lineNum">    1095 </span>            : void
<span class="lineNum">    1096 </span><span class="lineNoCov">          0 : SimpleTimeZone::initTransitionRules(UErrorCode&amp; status) {</span>
<span class="lineNum">    1097 </span><span class="lineNoCov">          0 :     if (U_FAILURE(status)) {</span>
<span class="lineNum">    1098 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    1099 </span>            :     }
<span class="lineNum">    1100 </span><span class="lineNoCov">          0 :     if (transitionRulesInitialized) {</span>
<span class="lineNum">    1101 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    1102 </span>            :     }
<span class="lineNum">    1103 </span><span class="lineNoCov">          0 :     deleteTransitionRules();</span>
<span class="lineNum">    1104 </span><span class="lineNoCov">          0 :     UnicodeString tzid;</span>
<span class="lineNum">    1105 </span><span class="lineNoCov">          0 :     getID(tzid);</span>
<span class="lineNum">    1106 </span>            : 
<span class="lineNum">    1107 </span><span class="lineNoCov">          0 :     if (useDaylight) {</span>
<span class="lineNum">    1108 </span>            :         DateTimeRule* dtRule;
<span class="lineNum">    1109 </span>            :         DateTimeRule::TimeRuleType timeRuleType;
<span class="lineNum">    1110 </span>            :         UDate firstStdStart, firstDstStart;
<span class="lineNum">    1111 </span>            : 
<span class="lineNum">    1112 </span>            :         // Create a TimeZoneRule for daylight saving time
<span class="lineNum">    1113 </span><span class="lineNoCov">          0 :         timeRuleType = (startTimeMode == STANDARD_TIME) ? DateTimeRule::STANDARD_TIME :</span>
<span class="lineNum">    1114 </span><span class="lineNoCov">          0 :             ((startTimeMode == UTC_TIME) ? DateTimeRule::UTC_TIME : DateTimeRule::WALL_TIME);</span>
<span class="lineNum">    1115 </span><span class="lineNoCov">          0 :         switch (startMode) {</span>
<span class="lineNum">    1116 </span>            :         case DOM_MODE:
<span class="lineNum">    1117 </span><span class="lineNoCov">          0 :             dtRule = new DateTimeRule(startMonth, startDay, startTime, timeRuleType);</span>
<span class="lineNum">    1118 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1119 </span>            :         case DOW_IN_MONTH_MODE:
<span class="lineNum">    1120 </span><span class="lineNoCov">          0 :             dtRule = new DateTimeRule(startMonth, startDay, startDayOfWeek, startTime, timeRuleType);</span>
<span class="lineNum">    1121 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1122 </span>            :         case DOW_GE_DOM_MODE:
<span class="lineNum">    1123 </span><span class="lineNoCov">          0 :             dtRule = new DateTimeRule(startMonth, startDay, startDayOfWeek, true, startTime, timeRuleType);</span>
<span class="lineNum">    1124 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1125 </span>            :         case DOW_LE_DOM_MODE:
<span class="lineNum">    1126 </span><span class="lineNoCov">          0 :             dtRule = new DateTimeRule(startMonth, startDay, startDayOfWeek, false, startTime, timeRuleType);</span>
<span class="lineNum">    1127 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1128 </span>            :         default:
<span class="lineNum">    1129 </span><span class="lineNoCov">          0 :             status = U_INVALID_STATE_ERROR;</span>
<span class="lineNum">    1130 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    1131 </span>            :         }
<span class="lineNum">    1132 </span>            :         // Check for Null pointer
<span class="lineNum">    1133 </span><span class="lineNoCov">          0 :         if (dtRule == NULL) {</span>
<span class="lineNum">    1134 </span><span class="lineNoCov">          0 :             status = U_MEMORY_ALLOCATION_ERROR;</span>
<span class="lineNum">    1135 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    1136 </span>            :         }
<span class="lineNum">    1137 </span>            :         // For now, use ID + &quot;(DST)&quot; as the name
<span class="lineNum">    1138 </span><span class="lineNoCov">          0 :         dstRule = new AnnualTimeZoneRule(tzid+UnicodeString(DST_STR), getRawOffset(), getDSTSavings(),</span>
<span class="lineNum">    1139 </span><span class="lineNoCov">          0 :             dtRule, startYear, AnnualTimeZoneRule::MAX_YEAR);</span>
<span class="lineNum">    1140 </span>            :         
<span class="lineNum">    1141 </span>            :         // Check for Null pointer
<span class="lineNum">    1142 </span><span class="lineNoCov">          0 :         if (dstRule == NULL) {</span>
<span class="lineNum">    1143 </span><span class="lineNoCov">          0 :             status = U_MEMORY_ALLOCATION_ERROR;</span>
<span class="lineNum">    1144 </span><span class="lineNoCov">          0 :             deleteTransitionRules();</span>
<span class="lineNum">    1145 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    1146 </span>            :         }
<span class="lineNum">    1147 </span>            :  
<span class="lineNum">    1148 </span>            :         // Calculate the first DST start time
<span class="lineNum">    1149 </span><span class="lineNoCov">          0 :         dstRule-&gt;getFirstStart(getRawOffset(), 0, firstDstStart);</span>
<span class="lineNum">    1150 </span>            : 
<span class="lineNum">    1151 </span>            :         // Create a TimeZoneRule for standard time
<span class="lineNum">    1152 </span><span class="lineNoCov">          0 :         timeRuleType = (endTimeMode == STANDARD_TIME) ? DateTimeRule::STANDARD_TIME :</span>
<span class="lineNum">    1153 </span><span class="lineNoCov">          0 :             ((endTimeMode == UTC_TIME) ? DateTimeRule::UTC_TIME : DateTimeRule::WALL_TIME);</span>
<span class="lineNum">    1154 </span><span class="lineNoCov">          0 :         switch (endMode) {</span>
<span class="lineNum">    1155 </span>            :         case DOM_MODE:
<span class="lineNum">    1156 </span><span class="lineNoCov">          0 :             dtRule = new DateTimeRule(endMonth, endDay, endTime, timeRuleType);</span>
<span class="lineNum">    1157 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1158 </span>            :         case DOW_IN_MONTH_MODE:
<span class="lineNum">    1159 </span><span class="lineNoCov">          0 :             dtRule = new DateTimeRule(endMonth, endDay, endDayOfWeek, endTime, timeRuleType);</span>
<span class="lineNum">    1160 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1161 </span>            :         case DOW_GE_DOM_MODE:
<span class="lineNum">    1162 </span><span class="lineNoCov">          0 :             dtRule = new DateTimeRule(endMonth, endDay, endDayOfWeek, true, endTime, timeRuleType);</span>
<span class="lineNum">    1163 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1164 </span>            :         case DOW_LE_DOM_MODE:
<span class="lineNum">    1165 </span><span class="lineNoCov">          0 :             dtRule = new DateTimeRule(endMonth, endDay, endDayOfWeek, false, endTime, timeRuleType);</span>
<span class="lineNum">    1166 </span><span class="lineNoCov">          0 :             break;</span>
<span class="lineNum">    1167 </span>            :         }
<span class="lineNum">    1168 </span>            :         
<span class="lineNum">    1169 </span>            :         // Check for Null pointer
<span class="lineNum">    1170 </span><span class="lineNoCov">          0 :         if (dtRule == NULL) {</span>
<span class="lineNum">    1171 </span><span class="lineNoCov">          0 :             status = U_MEMORY_ALLOCATION_ERROR;</span>
<span class="lineNum">    1172 </span><span class="lineNoCov">          0 :             deleteTransitionRules();</span>
<span class="lineNum">    1173 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    1174 </span>            :         }
<span class="lineNum">    1175 </span>            :         // For now, use ID + &quot;(STD)&quot; as the name
<span class="lineNum">    1176 </span><span class="lineNoCov">          0 :         stdRule = new AnnualTimeZoneRule(tzid+UnicodeString(STD_STR), getRawOffset(), 0,</span>
<span class="lineNum">    1177 </span><span class="lineNoCov">          0 :             dtRule, startYear, AnnualTimeZoneRule::MAX_YEAR);</span>
<span class="lineNum">    1178 </span>            :         
<span class="lineNum">    1179 </span>            :         //Check for Null pointer
<span class="lineNum">    1180 </span><span class="lineNoCov">          0 :         if (stdRule == NULL) {</span>
<span class="lineNum">    1181 </span><span class="lineNoCov">          0 :             status = U_MEMORY_ALLOCATION_ERROR;</span>
<span class="lineNum">    1182 </span><span class="lineNoCov">          0 :             deleteTransitionRules();</span>
<span class="lineNum">    1183 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    1184 </span>            :         }
<span class="lineNum">    1185 </span>            : 
<span class="lineNum">    1186 </span>            :         // Calculate the first STD start time
<span class="lineNum">    1187 </span><span class="lineNoCov">          0 :         stdRule-&gt;getFirstStart(getRawOffset(), dstRule-&gt;getDSTSavings(), firstStdStart);</span>
<span class="lineNum">    1188 </span>            : 
<span class="lineNum">    1189 </span>            :         // Create a TimeZoneRule for initial time
<span class="lineNum">    1190 </span><span class="lineNoCov">          0 :         if (firstStdStart &lt; firstDstStart) {</span>
<span class="lineNum">    1191 </span><span class="lineNoCov">          0 :             initialRule = new InitialTimeZoneRule(tzid+UnicodeString(DST_STR), getRawOffset(), dstRule-&gt;getDSTSavings());</span>
<span class="lineNum">    1192 </span><span class="lineNoCov">          0 :             if (initialRule == NULL) {</span>
<span class="lineNum">    1193 </span><span class="lineNoCov">          0 :                 status = U_MEMORY_ALLOCATION_ERROR;</span>
<span class="lineNum">    1194 </span><span class="lineNoCov">          0 :                 deleteTransitionRules();</span>
<span class="lineNum">    1195 </span><span class="lineNoCov">          0 :                 return;</span>
<span class="lineNum">    1196 </span>            :             }
<span class="lineNum">    1197 </span><span class="lineNoCov">          0 :             firstTransition = new TimeZoneTransition(firstStdStart, *initialRule, *stdRule);</span>
<span class="lineNum">    1198 </span>            :         } else {
<span class="lineNum">    1199 </span><span class="lineNoCov">          0 :             initialRule = new InitialTimeZoneRule(tzid+UnicodeString(STD_STR), getRawOffset(), 0);</span>
<span class="lineNum">    1200 </span><span class="lineNoCov">          0 :             if (initialRule == NULL) {</span>
<span class="lineNum">    1201 </span><span class="lineNoCov">          0 :                 status = U_MEMORY_ALLOCATION_ERROR;</span>
<span class="lineNum">    1202 </span><span class="lineNoCov">          0 :                 deleteTransitionRules();</span>
<span class="lineNum">    1203 </span><span class="lineNoCov">          0 :                 return;</span>
<span class="lineNum">    1204 </span>            :             }
<span class="lineNum">    1205 </span><span class="lineNoCov">          0 :             firstTransition = new TimeZoneTransition(firstDstStart, *initialRule, *dstRule);</span>
<span class="lineNum">    1206 </span>            :         }
<span class="lineNum">    1207 </span><span class="lineNoCov">          0 :         if (firstTransition == NULL) {</span>
<span class="lineNum">    1208 </span><span class="lineNoCov">          0 :             status = U_MEMORY_ALLOCATION_ERROR;</span>
<span class="lineNum">    1209 </span><span class="lineNoCov">          0 :             deleteTransitionRules();</span>
<span class="lineNum">    1210 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    1211 </span>            :         }
<span class="lineNum">    1212 </span>            :         
<span class="lineNum">    1213 </span>            :     } else {
<span class="lineNum">    1214 </span>            :         // Create a TimeZoneRule for initial time
<span class="lineNum">    1215 </span><span class="lineNoCov">          0 :         initialRule = new InitialTimeZoneRule(tzid, getRawOffset(), 0);</span>
<span class="lineNum">    1216 </span>            :         // Check for null pointer.
<span class="lineNum">    1217 </span><span class="lineNoCov">          0 :         if (initialRule == NULL) {</span>
<span class="lineNum">    1218 </span><span class="lineNoCov">          0 :             status = U_MEMORY_ALLOCATION_ERROR;</span>
<span class="lineNum">    1219 </span><span class="lineNoCov">          0 :             deleteTransitionRules();</span>
<span class="lineNum">    1220 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">    1221 </span>            :         }
<span class="lineNum">    1222 </span>            :     }
<span class="lineNum">    1223 </span>            : 
<span class="lineNum">    1224 </span><span class="lineNoCov">          0 :     transitionRulesInitialized = TRUE;</span>
<span class="lineNum">    1225 </span>            : }
<a name="1226"><span class="lineNum">    1226 </span>            : </a>
<span class="lineNum">    1227 </span>            : int32_t
<span class="lineNum">    1228 </span><span class="lineNoCov">          0 : SimpleTimeZone::countTransitionRules(UErrorCode&amp; /*status*/) const {</span>
<span class="lineNum">    1229 </span><span class="lineNoCov">          0 :     return (useDaylight) ? 2 : 0;</span>
<span class="lineNum">    1230 </span>            : }
<a name="1231"><span class="lineNum">    1231 </span>            : </a>
<span class="lineNum">    1232 </span>            : void
<span class="lineNum">    1233 </span><span class="lineNoCov">          0 : SimpleTimeZone::getTimeZoneRules(const InitialTimeZoneRule*&amp; initial,</span>
<span class="lineNum">    1234 </span>            :                                  const TimeZoneRule* trsrules[],
<span class="lineNum">    1235 </span>            :                                  int32_t&amp; trscount,
<span class="lineNum">    1236 </span>            :                                  UErrorCode&amp; status) const {
<span class="lineNum">    1237 </span><span class="lineNoCov">          0 :     if (U_FAILURE(status)) {</span>
<span class="lineNum">    1238 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    1239 </span>            :     }
<span class="lineNum">    1240 </span><span class="lineNoCov">          0 :     checkTransitionRules(status);</span>
<span class="lineNum">    1241 </span><span class="lineNoCov">          0 :     if (U_FAILURE(status)) {</span>
<span class="lineNum">    1242 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">    1243 </span>            :     }
<span class="lineNum">    1244 </span><span class="lineNoCov">          0 :     initial = initialRule;</span>
<span class="lineNum">    1245 </span><span class="lineNoCov">          0 :     int32_t cnt = 0;</span>
<span class="lineNum">    1246 </span><span class="lineNoCov">          0 :     if (stdRule != NULL) {</span>
<span class="lineNum">    1247 </span><span class="lineNoCov">          0 :         if (cnt &lt; trscount) {</span>
<span class="lineNum">    1248 </span><span class="lineNoCov">          0 :             trsrules[cnt++] = stdRule;</span>
<span class="lineNum">    1249 </span>            :         }
<span class="lineNum">    1250 </span><span class="lineNoCov">          0 :         if (cnt &lt; trscount) {</span>
<span class="lineNum">    1251 </span><span class="lineNoCov">          0 :             trsrules[cnt++] = dstRule;</span>
<span class="lineNum">    1252 </span>            :         }
<span class="lineNum">    1253 </span>            :     }
<span class="lineNum">    1254 </span><span class="lineNoCov">          0 :     trscount = cnt;</span>
<span class="lineNum">    1255 </span>            : }
<span class="lineNum">    1256 </span>            : 
<span class="lineNum">    1257 </span>            : 
<span class="lineNum">    1258 </span>            : U_NAMESPACE_END
<span class="lineNum">    1259 </span>            : 
<span class="lineNum">    1260 </span>            : #endif /* #if !UCONFIG_NO_FORMATTING */
<span class="lineNum">    1261 </span>            : 
<span class="lineNum">    1262 </span>            : //eof
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.13</a></td></tr>
  </table>
  <br>

</body>
</html>
